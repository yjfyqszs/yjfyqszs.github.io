<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="V" href="http://yjfyqfzs.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="V" href="http://yjfyqfzs.github.io/atom.xml"><link rel="alternate" type="application/json" title="V" href="http://yjfyqfzs.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><link rel="canonical" href="http://yjfyqfzs.github.io/2022/12/02/DNAimg/"><title>MetahumanDNA校准库 | Archive of yh = V</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">MetahumanDNA校准库</h1><div class="meta"><span class="item" title="创建时间：2022-12-02 10:43:03"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2022-12-02T10:43:03+08:00">2022-12-02</time></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">Archive of yh</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipet4bz0yj20zk0m8e81.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclflwv2aj20zk0m84qp.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gipeybxm1pj20zk0m8niv.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gicljitigmj20zk0m87fp.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1giclil3m4ej20zk0m8tn8.jpg"></li><li class="item" data-background-image="https://tva2.sinaimg.cn/large/6833939bly1gicmnywqgpj20zk0m8dwx.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://yjfyqfzs.github.io/2022/12/02/DNAimg/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="yihanW"><meta itemprop="description" content=", "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="V"></span><div class="body md" itemprop="articleBody"><h2 id="dna文件描述"><a class="anchor" href="#dna文件描述">#</a> DNA 文件描述</h2><div align="center"><img data-src="/2022/12/02/DNAimg/img1.png"></div><center>图1</center><p>具体描述可参考<span class="exturl" data-url="aHR0cHM6Ly9jZG4yLnVucmVhbGVuZ2luZS5jb20vcmlnLWxvZ2ljLXdoaXRlcGFwZXItdjItemhjbi01ODYwZDgwZjgzNTcucGRm"> RigLogic 白皮书</span></p><p><strong>metahuman 面部驱动逻辑：</strong> 控制器 GUI 数值 -&gt;RigLogic（存储在 DNA 文件中）-&gt; 关节等数据<br>Maya 中，采用以下方式查看 DNA 文件路径:</p><div align="center"><img data-src="/2022/12/02/DNAimg/img2.png"></div><center>图2</center><div align="center"><img data-src="/2022/12/02/DNAimg/img3.png"></div><center>图3</center><div align="center"><img data-src="/2022/12/02/DNAimg/img4.png"></div><center>图4</center><p>Unreal 中，DNAAsset 参数在 Skeletal Mesh 中查找</p><div align="center"><img data-src="/2022/12/02/DNAimg/img5.png"></div><center>图5</center><p>Epic Games 官方提供的 python 示例在 <code>...\MetaHuman-DNA-Calibration-main\examples</code> 中，全部 api 可在 <code>...\MetaHuman-DNA-Calibration-main\dnacalib\DNACalib\include</code> 的 <code>C++</code> 头文件中查找，python api 名称与 <code>C++</code> api 名称相同。</p><h2 id="dnaviewer"><a class="anchor" href="#dnaviewer">#</a> DNAViewer</h2><p>DNAViewer 模块用于在 Maya 中从 DNA 文件创建几何体与绑定，只适用于 python3.7，因此只能在 Maya2022 或更高版本中使用。</p><p><strong>在 Maya 中获取 DNA 文件数据并显示</strong><br>在 Maya Script editor 里运行 <code>...\MetaHuman-DNA-Calibration-main\examples\dna_viewer_run_in_maya.py</code> （其中，ROOT_DIR 要修改为绝对路径），显示图 6 所示界面：</p><div align="center"><img data-src="/2022/12/02/DNAimg/img6.png"></div><center>图6</center><p>图 6 中，Path 选择 DNA 路径，点击 Load DNA，Meshes 中会出现相应组件，选择 Build options 中的选项，点击 Process，即可将关节等数据导入 Maya 场景。若要导入控制器驱动逻辑 (rig logic)，还需设置 gui path 等，相关文件在 <code>...\MetaHuman-DNA-Calibration-main\data\</code> 中，如图 7 所示，其中，gui.ma 和 analog_gui.ma 中为控制器的 UI 界面。</p><div align="center"><img data-src="/2022/12/02/DNAimg/img7.png"></div><center>图7</center><p><strong>将 Maya 场景中的数据保存至 DNA 文件中</strong><br>修改了有 DNA 文件的 Maya 场景后，将原始 DNA 文件放置路径 <code>...\MetaHuman-DNA-Calibration-main\data\</code> 中。修改 <code>...\MetaHuman-DNA-Calibration-main\examples\dna_viewer_grab_changes_from_scene_and_propagate_to_dna.py</code> 中的 ROOT_DIR 为 <code>...\MetaHuman-DNA-Calibration-main\</code> ，CHARACTER_NAME 为源 DNA 文件名，在 Maya Script editor 里运行该 py 脚本，即可生成新的 DNA 文件。</p><h2 id="dnacalib"><a class="anchor" href="#dnacalib">#</a> DNACalib</h2><p>DNACalib 模块用于查看和修改 DNA 文件数据，包含 <code>C++</code> api 和转换的 python api，既能使用 Maya 中的 Script Editor，也能在外部 python 编辑器中运行。该模块只适用于 python3.7，若要使用其他 python3 版本，需要用 SWIG 重新封装 <code>C++</code> 库。</p><p>使用 DNACalib 时，必须导入以下模块</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> dna <span class="keyword">import</span> DataLayer_All, FileStream, Status, BinaryStreamReader, BinaryStreamWriter<span class="comment">#主要用于读写</span></span><br><span class="line"><span class="keyword">from</span> dnacalib <span class="keyword">import</span> (</span><br><span class="line">    DNACalibDNAReader</span><br><span class="line">)<span class="comment">#括号中按需添加模块如RenameJointCommand等</span></span><br></pre></td></tr></table></figure><p><strong>读取和写入 DNA 文件</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#读DNA文件</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">load_dna</span>(<span class="params">path</span>):</span><br><span class="line">    stream = FileStream(path, FileStream.AccessMode_Read, FileStream.OpenMode_Binary)</span><br><span class="line">    reader = BinaryStreamReader(stream, DataLayer_All)</span><br><span class="line">    reader.read()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> Status.isOk():</span><br><span class="line">        status = Status.get()</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">f&quot;Error loading DNA: <span class="subst">&#123;status.message&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> reader</span><br><span class="line"></span><br><span class="line"><span class="comment">#写DNA文件</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">save_dna</span>(<span class="params">reader, path</span>):</span><br><span class="line">    stream = FileStream(path, FileStream.AccessMode_Write, FileStream.OpenMode_Binary)</span><br><span class="line">    writer = BinaryStreamWriter(stream)</span><br><span class="line">    writer.setFrom(reader)</span><br><span class="line">    writer.write()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> Status.isOk():</span><br><span class="line">        status = Status.get()</span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">f&quot;Error saving DNA: <span class="subst">&#123;status.message&#125;</span>&quot;</span>)  </span><br><span class="line"></span><br><span class="line"><span class="comment">#读文件示例</span></span><br><span class="line">dna = load_dna(input_path)</span><br><span class="line">calibrated = DNACalibDNAReader(dna)<span class="comment">#calibrated作为后续命令模块的输入参数</span></span><br></pre></td></tr></table></figure><p><strong>获取 DNA 文件中的组件</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#获取全部关节名称</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_joints</span>(<span class="params">dna</span>):</span><br><span class="line">    joints = []</span><br><span class="line">    <span class="keyword">for</span> jointIndex <span class="keyword">in</span> <span class="built_in">range</span>(dna.getJointCount()):</span><br><span class="line">        joints.append(dna.getJointName(jointIndex))</span><br><span class="line">    <span class="keyword">return</span> joints</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取全部网格体名称</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_mesh</span>(<span class="params">dna</span>):</span><br><span class="line">    mesh = []</span><br><span class="line">    <span class="keyword">for</span> meshIndex <span class="keyword">in</span> <span class="built_in">range</span>(dna.getMeshCount()):</span><br><span class="line">        mesh.append(dna.getMeshName(meshIndex))</span><br><span class="line">    <span class="keyword">return</span> mesh</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取全部动画贴图名称</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_animap</span>(<span class="params">dna</span>):</span><br><span class="line">    animap = []</span><br><span class="line">    <span class="keyword">for</span> ani_index <span class="keyword">in</span> <span class="built_in">range</span>(dna.getAnimatedMapCount()):</span><br><span class="line">        animap.append(dna.getAnimatedMapName(ani_index))</span><br><span class="line">    <span class="keyword">return</span> animap</span><br><span class="line"></span><br><span class="line"><span class="comment">#涉及获取Metahuman的静态数据(如关节，网格体的名称，数量，层级关系等)的api，可在DefinitionReader.h中查找</span></span><br><span class="line">all_joint=get_joints(calibrated)<span class="comment">#Metahuman头部有865根骨骼</span></span><br><span class="line">father_joint=calibrated.getJointParentIndex(joint_index)<span class="comment">#获取父节点索引</span></span><br><span class="line">joint_position=calibrated.getNeutralJointTranslation(joint_index)<span class="comment">#获取关节相对父关节偏移,保存在列表中，单位为cm</span></span><br><span class="line">joint_rotation=calibrated.getNeutralJointRotation(joint_index)<span class="comment">#获取关节相对父节点旋转,单位为°</span></span><br><span class="line">all_joint_x=calibrated.getNeutralJointTranslationXs()<span class="comment">#获取所有关节的偏移x值</span></span><br><span class="line">all_mesh=get_mesh(calibrated)<span class="comment">#LOD0~LOD7，LOD0包括head,teeth,saliva,eyeLeft,eyeRight,eyeshell,eyelashes,eyeEdge,cartilage</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#涉及控制器绑定相关动态数据的api，可在BehaviorReader.h中查找</span></span><br><span class="line">bs_channel_lods = calibrated.getBlendShapeChannelLODs()<span class="comment">#每个LOD通道的Blendshape数量，只有LOD0有Blendshape，共687个</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#涉及获取几何信息的api，可在GeometryReader.h中查找</span></span><br><span class="line">bs_tgt_count = calibrated.getBlendShapeTargetCount(mesh_index)<span class="comment">#Mesh的Blendshape数量，其中head_lod0_mesh有681个Blendshape</span></span><br><span class="line">bs_tgt_delta_count = calibrated.getBlendShapeTargetDeltaCount(mesh_index,bs_tgt_index)<span class="comment">#Blendshape中变形了的顶点数量？？？但没有找到获取这些受影响顶点索引的api</span></span><br><span class="line">v_position=calibrated.getVertexPosition(mesh_index,vertex_index)<span class="comment">#获取顶点世界位置</span></span><br><span class="line">v_j=calibrated.getSkinWeightsJointIndices(mesh_index,vertex_index)<span class="comment">#影响顶点位置的关节索引</span></span><br><span class="line">v_w=calibrated.getSkinWeightsValues(mesh_index,vertex_index)<span class="comment">#获取权重值</span></span><br></pre></td></tr></table></figure><p><strong>删除 DNA 文件中的组件</strong><br>该部分包括删除关节动画，关节 (Joint)，网格体 (Mesh)，混合变形 (Blend shape)，程序中需要导入相应的命令模块</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> dnacalib <span class="keyword">import</span> (    </span><br><span class="line">    DNACalibDNAReader,</span><br><span class="line">    RemoveJointAnimationCommand,</span><br><span class="line">    RemoveJointCommand,</span><br><span class="line">    RemoveMeshCommand,</span><br><span class="line">    ClearBlendShapesCommand</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除关节</span></span><br><span class="line">command = RemoveJointCommand(joint_index)</span><br><span class="line">command.run(calibrated)<span class="comment">#注意删除关节后相关顶点权重不会自动删除，需要手动修改</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#清空Blendshape</span></span><br><span class="line">command = ClearBlendShapesCommand(joint_index)</span><br><span class="line">command.run(calibrated)</span><br></pre></td></tr></table></figure><p><strong>重命名 DNA 文件中的组件</strong><br>该部分包括重命名动画贴图，关节，网格体，混合变形</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> dnacalib <span class="keyword">import</span> (    </span><br><span class="line">    DNACalibDNAReader,</span><br><span class="line">    RenameAnimatedMapCommand,</span><br><span class="line">    RenameBlendShapeCommand,</span><br><span class="line">    RenameJointCommand,</span><br><span class="line">    RenameMeshCommand</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">#关节重命名</span></span><br><span class="line">command = RenameJointCommand(<span class="number">10</span>, <span class="string">&quot;NewJointA&quot;</span>)<span class="comment">#将索引为10的关节重命名为&quot;NewJointA&quot;</span></span><br><span class="line">command.run(calibrated)</span><br></pre></td></tr></table></figure><p><strong>设置静态的关节和顶点</strong><br>该部分设置静态的关节位姿和顶点位置</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> dnacalib <span class="keyword">import</span> (    </span><br><span class="line">    DNACalibDNAReader,</span><br><span class="line">    SetNeutralJointRotationsCommand,</span><br><span class="line">    SetNeutralJointTranslationsCommand,</span><br><span class="line">    SetVertexPositionsCommand,</span><br><span class="line">    VectorOperation_Subtract<span class="comment">#向量差，除了Subtract外还有Add,Multiply,Interpolate方法</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置关节位置,只能整体设置数值，使用前需要先设置关节层级，设置关节层级相关api在DefinitionWriter.h中</span></span><br><span class="line">command=SetNeutralJointTranslationsCommand([[x1,y1,z1],...,[xn,yn,zn]])</span><br><span class="line">command.run(calibrated)</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置顶点位置，只能整体设置，在原始数据的基础上增加或减小，若要直接设置位置值需要使用DefinitionWriter.h中的api</span></span><br><span class="line"><span class="comment">#new_x=origin_x+pos_x,new_y=origin_y+pos_y,new_z=origin_z+pos_z</span></span><br><span class="line">command = SetVertexPositionsCommand(mesh_index,pos_x=[x1,...,xn],pos_y=[y1,...,yn],pos_z=[y1,...,yn],VectorOperation_Subtract)</span><br><span class="line">command.run(calibrated)</span><br></pre></td></tr></table></figure><p><strong>变换静态的关节和顶点</strong><br>该部分对所有关节和顶点进行整体变换</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> dnacalib <span class="keyword">import</span> (    </span><br><span class="line">    DNACalibDNAReader,</span><br><span class="line">    RotateCommand,</span><br><span class="line">    ScaleCommand,</span><br><span class="line">    TranslateCommand</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">#整体相对origin旋转ro</span></span><br><span class="line">command = RotateCommand(ro=[<span class="number">10</span>,<span class="number">20</span>,<span class="number">30</span>],origin=[<span class="number">0</span>,<span class="number">90</span>,<span class="number">0</span>])</span><br><span class="line">command.run(calibrated)</span><br></pre></td></tr></table></figure><p><strong>修正混合变形</strong><br>该部分修改混合变形中的增量值</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> dnacalib <span class="keyword">import</span> (    </span><br><span class="line">    DNACalibDNAReader,</span><br><span class="line">    SetBlendShapeTargetDeltasCommand,</span><br><span class="line">    PruneBlendShapeTargetsCommand,</span><br><span class="line">    VectorOperation_Interpolate</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#blend_shape_target_deltas=[[x1,y1,z1],[x2,y2,z2],...,[xn,yn,zn]]表示目标增量</span></span><br><span class="line"><span class="comment">#mask=[w1,w2,...,wn]表示叠加增量的权重,w=0表示保持顶点原始位置</span></span><br><span class="line"><span class="comment">#但函数中没有输入顶点索引,如何设置修改哪些顶点???</span></span><br><span class="line">command =  SetBlendShapeTargetDeltasCommand(</span><br><span class="line">        mesh_index</span><br><span class="line">        blend_shape_target_index</span><br><span class="line">        blend_shape_target_deltas,</span><br><span class="line">        masks,</span><br><span class="line">        VectorOperation_Interpolate,</span><br><span class="line">    )</span><br><span class="line">command.run(calibrated)</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置混合变形增量的阈值,当增量绝对值超过阈值时设置为阈值</span></span><br><span class="line">command=PruneBlendShapeTargetsCommand(threshold)</span><br><span class="line">command.run(calibrated)</span><br></pre></td></tr></table></figure><p><strong>所有的命令可以放在一个命令序列中，最终执行一次</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">commands = CommandSequence()</span><br><span class="line">com1=SetLODsCommand(lods)</span><br><span class="line">commands.add(com1)</span><br><span class="line">com2=CalculateMeshLowerLODsCommand(mesh_index)</span><br><span class="line">commands.add(com2)</span><br><span class="line">commands.run(calibrated)</span><br></pre></td></tr></table></figure><p>修改后的 DNA 文件不能通过图 4 的方法来更新 Maya 场景，需要使用图 7 所示 DNAViewer 来新建场景。<br><strong>（未验证，不一定对）</strong> 若要将修改后的 DNA 文件导入 UE，首先需要按图 7 方法新建 Maya 场景，并将骨骼和网格体导出至 UE, 修改后的 DNA 文件拖入 UE，选择对应骨骼。</p><div align="center"><img data-src="/2022/12/02/DNAimg/img8.png"></div><center>图8</center><p>打开 Skeletal mesh，Animation Rig 沿用 Metahuman 通用资源即可。</p><div align="center"><img data-src="/2022/12/02/DNAimg/img9.png"></div><center>图9</center></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2023-02-23 06:51:40" itemprop="dateModified" datetime="2023-02-23T06:51:40+08:00">2023-02-23</time> </span><span id="2022/12/02/DNAimg/" class="item leancloud_visitors" data-flag-title="MetahumanDNA校准库" title="阅读次数"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">阅读次数</span> <span class="leancloud-visitors-count"></span> <span class="text">次</span></span></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>yihanW <i class="ic i-at"><em>@</em></i>V</li><li class="link"><strong>本文链接：</strong> <a href="http://yjfyqfzs.github.io/2022/12/02/DNAimg/" title="MetahumanDNA校准库">http://yjfyqfzs.github.io/2022/12/02/DNAimg/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"></div><div class="item right"><a href="/2022/12/09/Ue%E8%93%9D%E5%9B%BE%E4%BF%AE%E6%94%B9Sequence/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;tva2.sinaimg.cn&#x2F;mw690&#x2F;6833939bly1giclh0m9pdj20zk0m8hdt.jpg" title="Ue蓝图修改Sequence"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i></span><h3>Ue蓝图修改Sequence</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#dna%E6%96%87%E4%BB%B6%E6%8F%8F%E8%BF%B0"><span class="toc-number">1.</span> <span class="toc-text">DNA 文件描述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dnaviewer"><span class="toc-number">2.</span> <span class="toc-text">DNAViewer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dnacalib"><span class="toc-number">3.</span> <span class="toc-text">DNACalib</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="yihanW" data-src="/images/avatar.jpg"><p class="name" itemprop="name">yihanW</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">6</span> <span class="name">文章</span></a></div></nav><div class="social"></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li></ul></li></ul></div></div></div><ul id="quick"><li class="prev pjax"></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"></div><span><a href="/2022/12/02/DNAimg/" title="MetahumanDNA校准库">MetahumanDNA校准库</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/01/18/ueplug/" title="ue插件">ue插件</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/12/15/MayaApi/" title="Maya Api笔记">Maya Api笔记</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/12/09/Ue%E8%93%9D%E5%9B%BE%E4%BF%AE%E6%94%B9Sequence/" title="Ue蓝图修改Sequence">Ue蓝图修改Sequence</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/03/04/UeMayaControlRig/" title="Python实现Unreal和Maya传输Metahuman面部控制器数据">Python实现Unreal和Maya传输Metahuman面部控制器数据</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2023/01/05/GithubHexo/" title="Hexo+Github博客搭建">Hexo+Github博客搭建</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2010 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">yihanW @ Archive of yh</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2022/12/02/DNAimg/",favicon:{show:"Good",hide:"Boom"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html>