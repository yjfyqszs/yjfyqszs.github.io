{
    "version": "https://jsonfeed.org/version/1",
    "title": "V",
    "subtitle": "",
    "icon": "http://yjfyqfzs.github.io/images/favicon.ico",
    "description": "",
    "home_page_url": "http://yjfyqfzs.github.io",
    "items": [
        {
            "id": "http://yjfyqfzs.github.io/2024/02/23/UE%E5%AF%BC%E5%85%A5%E8%BF%9E%E6%8E%A5%E5%A4%96%E9%83%A8%E6%95%B0%E6%8D%AE/",
            "url": "http://yjfyqfzs.github.io/2024/02/23/UE%E5%AF%BC%E5%85%A5%E8%BF%9E%E6%8E%A5%E5%A4%96%E9%83%A8%E6%95%B0%E6%8D%AE/",
            "title": "ue读取或连接外部数据",
            "date_published": "2024-02-23T02:33:40.000Z",
            "content_html": "<p>本文总结了 UE 读取 CSV/TXT/JSON 数据和连接 MySQL 数据库的方法。</p>\n<p><strong>1. 直接导入 CSV 文件</strong><br>\n UE 中可以直接导入 <code>.csv</code>  格式的文件。<br>\n新建结构体，在结构体中设置字段，再将 <code>.csv</code>  文件直接拖入资源管理器，导入为 <code>DataTable</code>  即可。<br>\n注意，若结构体中有 <code>Vector</code>  类型，对应的 <code>.csv</code>  文件数据需要写为 <code>(X=...,Y=...,Z=...)</code>  才能正确导入。</p>\n<div align=\"center\"> <img data-src=\"/2024/02/23/UE%E5%AF%BC%E5%85%A5%E8%BF%9E%E6%8E%A5%E5%A4%96%E9%83%A8%E6%95%B0%E6%8D%AE/img1.png\" width=\"600\"> </div>\n<p><strong>2. 插件动态读写 CSV/TXT/JSON 文件</strong><br>\n新建 UE 蓝图函数库插件，创建过程参考<span class=\"exturl\" data-url=\"aHR0cHM6Ly95amZ5cXN6cy5naXRodWIuaW8vMjAyMy8wMS8xOC91ZXBsdWcv\">之前的文章</span>。</p>\n<p><code>CSV</code>  和 <code>JSON</code>  文件读写参考<span class=\"exturl\" data-url=\"aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8xNTg3MTQ0OTU=\">文章</span>， <code>DataTable</code>  相关函数在引擎源码的 <code>DataTable.h</code>  和 <code>DataTableFunctionLibrary.h</code>  中找， <code>AddRow</code>  函数定义如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"type\">void</span> <span class=\"title\">UMyDataFuncBPLibrary::AddRow</span><span class=\"params\">(UDataTable* DataTable, <span class=\"type\">const</span> FName&amp; RowName, <span class=\"type\">const</span> FMycppstruc&amp; Rowdata)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (!DataTable)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">UE_LOG</span>(LogDataTable, Error, <span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;AddRow DataTable error&quot;</span>));</span><br><span class=\"line\">\t\t<span class=\"keyword\">return</span>;</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\tDataTable-&gt;<span class=\"built_in\">AddRow</span>(RowName, Rowdata);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>其中由于 UE C++ 中无法使用模板函数，需要先自定义结构体 <code>Mycppstruc</code></p>\n<p><strong>3. 插件连接 MySQL</strong><br>\n 安装配置 MySQL 步骤参考<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzQyMzQ4NC9hcnRpY2xlL2RldGFpbHMvMTI0NDA4NTY1\"> Windows 配置 MySQL</span></p>\n<p>连接 MySQL 用 <code>MySQL Connector/c++</code>  实现，将其作为第三方库引入 UE，创建第三方库插件流程参考<span class=\"exturl\" data-url=\"aHR0cHM6Ly95amZ5cXN6cy5naXRodWIuaW8vMjAyMy8wMS8xOC91ZXBsdWcv\">之前的文章</span></p>\n<p>把 <code>MySQL Connector/c++</code>  安装后解压文件夹里的 <code>include\\jdbc</code>  和 <code>libcrypto-1_1-x64.dll</code> , <code>libssl-1_1-x64.dll</code> , <code>mysqlcppconn-static.lib</code>  拷贝至新建的插件第三方库目录。</p>\n<p>去掉 <code>\\include\\cppconn\\driver.h</code>  中的宏声明：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">undef</span> check</span></span><br><span class=\"line\"><span class=\"function\">CPPCONN_PUBLIC_FUNC <span class=\"type\">void</span> <span class=\"title\">check</span><span class=\"params\">(<span class=\"type\">const</span> std::string &amp;)</span></span>;</span><br><span class=\"line\"><span class=\"function\">CPPCONN_PUBLIC_FUNC <span class=\"type\">void</span> <span class=\"title\">check</span><span class=\"params\">(<span class=\"type\">const</span> std::map&lt;std::string,std::string&gt; &amp;)</span></span>;</span><br></pre></td></tr></table></figure>\n<p>并在该头文件结尾添加：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">ifndef</span> check</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> check(expr)\t\t\t\tUE_CHECK_IMPL(expr)</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">endif</span></span></span><br></pre></td></tr></table></figure>\n<p>使用该库时，头文件如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">define</span> STATIC_CONCPP</span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;mysql_driver.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;cppconn/prepared_statement.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;cppconn/driver.h&quot;</span></span></span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">include</span> <span class=\"string\">&quot;cppconn/exception.h&quot;</span></span></span><br></pre></td></tr></table></figure>\n<p>自定义蓝图可调用函数时，涉及 <code>FString</code>  和 <code>string</code>  格式的转换，参考文章<span class=\"exturl\" data-url=\"aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC80NDg3MTM3Mzc=\"> UE4_最全 FString 字符串与各格式转换输出</span></p>\n",
            "tags": []
        },
        {
            "id": "http://yjfyqfzs.github.io/2023/12/22/BP_Fly/",
            "url": "http://yjfyqfzs.github.io/2023/12/22/BP_Fly/",
            "title": "蓝图实现蝴蝶随机选择固定路径飞行",
            "date_published": "2023-12-22T11:52:33.000Z",
            "content_html": "<p><strong>整体目标</strong><br>\n目前已有资产为多个单独蝴蝶粒子，需要使这些蝴蝶随机且均匀地出现，并在固定的多条路径中随机选择一条路径，沿该路径飞行。</p>\n<p><strong>设置路径</strong><br>\n新建 <code>Actor</code>  类为 <code>BP_Spline</code>  存放所有路径。在蓝图中新建多条 <code>Spline</code> ，并保存在数组变量中。</p>\n<div align=\"center\"> <img data-src=\"/2023/12/22/BP_Fly/img1.png\"> </div>\n<p><strong>设置蝴蝶类</strong><br>\n新建结构体 <code>Allpara</code> ，用来保存蝴蝶粒子类型，蝴蝶大小，飞行速度。</p>\n<div align=\"center\"> <img data-src=\"/2023/12/22/BP_Fly/img2.png\"> </div>\n<p>新建 <code>Actor</code>  类为 <code>BP_FlySingle</code>  表示单个飞行的蝴蝶，也可用于表示其他按路径运动的粒子。<br>\n新建样条线和粒子组件，外部输入的参数如下。</p>\n<div align=\"center\"> <img data-src=\"/2023/12/22/BP_Fly/img3.png\" width=\"300\"> </div>\n<p>蝴蝶类中添加以下事件，注意，所有事件都需要勾选 <code>Call in Editor</code> ，在 <code>Sequencer</code>  中添加事件关键帧后，也需要右键勾线 <code>Call inE ditor</code> <br>\n 在生成事件中，外部获取的 <code>inputpara</code>  用来设置粒子类型，飞行速度等。 <code>path</code>  为外部获取的路径，赋值给 <code>Spline</code> ，但 <code>Spline</code>  与根节点之间仍无相对变换。当飞行粒子的正前方与路径不同时，用 <code>rotationOffset</code>  来设置两者之间的旋转。</p>\n<div align=\"center\"> <img data-src=\"/2023/12/22/BP_Fly/img4.png\"> </div>\n<div align=\"center\"> <img data-src=\"/2023/12/22/BP_Fly/img5.png\"> </div>\n<p><strong>设置随机生成事件</strong><br>\n新建 <code>Actor</code>  类为 <code>MyEventActor</code> , 实现随机生成蝴蝶，选择路径和更新。<br>\n初始位置，路径选择等参数取随机数即可。不同类型的蝴蝶需要尽可能都出现，且避免某一种类型出现过多，此时不能每次遍历时都抽取随机索引，采用随机选择起始索引，顺序生成各类型蝴蝶。<br>\n此外，由于相应事件在 <code>sequencer</code>  中调用，蓝图中不能使用 <code>TimeLine</code> ，应当使用 <code>SetTimer</code>  来实现随时间更新。</p>\n<div align=\"center\"> <img data-src=\"/2023/12/22/BP_Fly/img7.png\" width=\"200\"> </div>\n<div align=\"center\"> <img data-src=\"/2023/12/22/BP_Fly/img8.png\" width=\"200\"> </div>\n<div align=\"center\"> <img data-src=\"/2023/12/22/BP_Fly/img9.png\" width=\"300\"> </div>\n<div align=\"center\"> <img data-src=\"/2023/12/22/BP_Fly/img10.png\" width=\"200\"> </div>\n<div align=\"center\"> <img data-src=\"/2023/12/22/BP_Fly/img11.png\"> </div>",
            "tags": []
        },
        {
            "id": "http://yjfyqfzs.github.io/2023/10/20/Oculus/",
            "url": "http://yjfyqfzs.github.io/2023/10/20/Oculus/",
            "title": "Oculus恢复出厂设置与联网激活",
            "date_published": "2023-10-20T14:37:11.000Z",
            "content_html": "<p>近期因不明原因无法在收的二手 quest2 里切换自己的账号，恢复出厂设置重新激活。</p>\n<p><strong>恢复出厂设置</strong></p>\n<p>关机后长按电源和音量减键 5 秒左右，按音量键上下选择 <code>Factory reset</code> 。重新启动后需要使用手机 Oculus App 进行配对，按头盔中的提示操作即可。</p>\n<p><strong>联网</strong><br>\n由于 quest2 需要科学上网，此处使用电脑开启热点，quest2 连接电脑热点。</p>\n<p>点击 <code>Manage</code>  后安装组件至 <code>Service Mode</code>  旁的图标为绿色，打开 <code>TUN Mode</code> 。</p>\n<div align=\"center\"> <img data-src=\"/2023/10/20/Oculus/img1.png\"> </div>\n此时在电脑搜索框中搜 “网络连接”，出现clash虚拟网卡。\n<p>以管理员身份运行 <code>cmd</code> ，输入命令 <code>netsh wlan set hostednetwork mode=allow</code>  和 <code>netsh wlan set hostednetwork ssid=*wifi名称* key=*wifi密码*</code>  设置热点密码，输入 <code>netsh wlan start hostednetwork</code>  开启热点。此外也可以直接在<strong>网络和 Internet - 移动热点</strong>中开启。</p>\n<p>此时出现虚拟连接</p>\n<div align=\"center\"> <img data-src=\"/2023/10/20/Oculus/img2.png\"> </div>\n<p>右键 <code>clash</code>  选择 <code>属性</code> ，设置共享，即可用 quest2 连接电脑热点。</p>\n<div align=\"center\"> <img data-src=\"/2023/10/20/Oculus/img3.png\"> </div>\n<p><strong>其他 tips</strong></p>\n<p><strong>Oculus 电脑端软件界面卡住不动：</strong> 改 Host 文件。<br>\n<strong>头盔连接电脑找不到盘符：</strong> 在头盔的 <code>通知</code> 中查找 <code>USB</code>  相关通知并开启。<br>\n<strong>开启开发者模式：</strong> <span class=\"exturl\" data-url=\"aHR0cHM6Ly9kZXZlbG9wZXIub2N1bHVzLmNvbS9tYW5hZ2UvdmVyaWZ5Lw==\">https://developer.oculus.com/manage/verify/</span> 选择双重认证，移动手机号可用。</p>\n",
            "tags": []
        },
        {
            "id": "http://yjfyqfzs.github.io/2023/08/23/StreamlitGradio/",
            "url": "http://yjfyqfzs.github.io/2023/08/23/StreamlitGradio/",
            "title": "streamlit与gradio使用对比",
            "date_published": "2023-08-23T05:43:00.000Z",
            "content_html": "<p>近期分别使用 streamlit 和 gradio 搭建界面，这两者均用于使开发者快速制作演示 demo，避免使用复杂的前端框架。其中，streamlit 常用于数据分析，内置组件多，gradio 作为 hugging face 的一部分，模型加载简单，常用于深度学习相关领域。</p>\n<h3 id=\"运行方式\"><a class=\"anchor\" href=\"#运行方式\">#</a> 运行方式</h3>\n<p>streamlit 运行时，需要在 cmd 中运行 <code>streamlit run xxx.py</code> ，此时 streamlit 会在本地启动一个 web 服务器，并自动打开 web 浏览器，代码更新时无需重新运行，刷新浏览器即可更新界面。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> streamlit <span class=\"keyword\">as</span> st</span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">run_st</span>():</span><br><span class=\"line\">    <span class=\"comment\">###streamlit界面定义写在函数里</span></span><br><span class=\"line\"></span><br><span class=\"line\">run_st()</span><br></pre></td></tr></table></figure>\n<p>如需更改界面颜色配置，在项目目录中新建 <code>.streamlit</code>  文件夹，新建文件 <code>config.toml</code> , 设置主题</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[theme]</span><br><span class=\"line\">primaryColor=<span class=\"string\">&quot;#F63366&quot;</span></span><br><span class=\"line\">backgroundColor=<span class=\"string\">&quot;#0E1117&quot;</span></span><br><span class=\"line\">secondaryBackgroundColor=<span class=\"string\">&quot;#262730&quot;</span></span><br><span class=\"line\">textColor=<span class=\"string\">&quot;#FAFAFA&quot;</span></span><br><span class=\"line\">font=<span class=\"string\">&quot;sans serif&quot;</span></span><br></pre></td></tr></table></figure>\n<p>gradio 可以在 IDE 中运行，开发者在浏览器中输入本地地址和端口号显示界面，代码更新时需要在 IDE 中运行才能更新界面。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> gradio <span class=\"keyword\">as</span> gr</span><br><span class=\"line\"><span class=\"keyword\">with</span> gr.Blocks(title=<span class=\"string\">&quot;XXX&quot;</span>) <span class=\"keyword\">as</span> demo:</span><br><span class=\"line\">    <span class=\"comment\">###gradio界面定义写在此处</span></span><br><span class=\"line\">demo.launch()</span><br></pre></td></tr></table></figure>\n<h3 id=\"基本组件\"><a class=\"anchor\" href=\"#基本组件\">#</a> 基本组件</h3>\n<p>streamlit 和 gradio 都默认按行排列，若需要排成列，则分别使用以下语句：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">col1,col2,col3=st.columns(<span class=\"number\">3</span>)</span><br><span class=\"line\"><span class=\"comment\">##col1.write(&quot;xxx&quot;)</span></span><br><span class=\"line\"><span class=\"comment\">##col2.write(&quot;xxx&quot;)</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">with</span> gr.Row():</span><br><span class=\"line\">    <span class=\"comment\">#排成列的组件</span></span><br><span class=\"line\">    sub_btn=gr.Button(<span class=\"string\">&quot;Submit&quot;</span>)</span><br><span class=\"line\">    clc_btn=gr.Button(<span class=\"string\">&quot;Clear&quot;</span>)</span><br></pre></td></tr></table></figure>\n<p>streamlit 和 gradio 均包含 <code>button</code> , <code>radio</code> , <code>checkbox</code>  等基本组件，但 streamlit 使用 <code>file_uploader</code>  上传的文件存储在缓存中，无法获取文件在本地的原始路径！！，如需再次保存可采用以下方法</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">save_uploaded_file</span>(<span class=\"params\">uploaded_file, save_path</span>):</span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(save_path, <span class=\"string\">&quot;wb&quot;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        f.write(uploaded_file.getbuffer())</span><br><span class=\"line\"></span><br><span class=\"line\">image=st.file_uploader(<span class=\"string\">&quot;Upload Image&quot;</span>, <span class=\"built_in\">type</span>=[<span class=\"string\">&quot;jpg&quot;</span>, <span class=\"string\">&quot;png&quot;</span>])</span><br><span class=\"line\"><span class=\"keyword\">if</span> image <span class=\"keyword\">is</span> <span class=\"keyword\">not</span> <span class=\"literal\">None</span>:</span><br><span class=\"line\">    img_path=image.name</span><br><span class=\"line\">    save_uploaded_file(image, img_path)</span><br></pre></td></tr></table></figure>\n<p>streamlit 每次修改组件内容后会从头到尾运行所有代码，用 <code>text_area</code>  时无法直接在文本框内更新文字，只能文本框消失后又重新显示，要保存中间数据时可使用 <code>@st.cache</code>  装饰器来装饰函数，或使用 <code>session_state</code> 。gradio 可以通过 <code>update</code>  函数更新文本框内容。</p>\n<p>gradio 个性化定制程度低，在定义 <code>button</code>  的回调函数时，输入参数必须为 gradio 组件，在函数调用时会自动提取组件的内容如字符串等。</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">pro_box=gr.CheckboxGroup(pro_lis,label=<span class=\"string\">&quot;xxx&quot;</span>)</span><br><span class=\"line\">add_box=gr.Textbox(label=<span class=\"string\">&quot;add_tag&quot;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">add_new=gr.Button(<span class=\"string\">&quot;add&quot;</span>)</span><br><span class=\"line\"><span class=\"comment\">#定义update_tag函数时，输入为str类型，输出为pro_box.update(choices=pro_lis,value=[]),若输出非pro_box则组件不会更新</span></span><br><span class=\"line\">add_new.click(fn=update_tag,inputs=[add_box],outputs=[pro_box])</span><br></pre></td></tr></table></figure>\n",
            "tags": []
        },
        {
            "id": "http://yjfyqfzs.github.io/2023/07/13/Langchain%E7%9B%B8%E5%85%B3%E5%BA%93%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0/",
            "url": "http://yjfyqfzs.github.io/2023/07/13/Langchain%E7%9B%B8%E5%85%B3%E5%BA%93%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0/",
            "title": "Langchain相关库使用笔记",
            "date_published": "2023-07-12T23:43:03.000Z",
            "content_html": "<h2 id=\"chatgpt-api基本调用\"><a class=\"anchor\" href=\"#chatgpt-api基本调用\">#</a> ChatGPT API 基本调用</h2>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_completion</span>(<span class=\"params\">prompt, model=<span class=\"string\">&quot;gpt-3.5-turbo&quot;</span></span>):</span><br><span class=\"line\">    messages = [&#123;<span class=\"string\">&quot;role&quot;</span>: <span class=\"string\">&quot;user&quot;</span>, <span class=\"string\">&quot;content&quot;</span>: prompt&#125;]</span><br><span class=\"line\">    response = openai.ChatCompletion.create(</span><br><span class=\"line\">        model=model,</span><br><span class=\"line\">        messages=messages,</span><br><span class=\"line\">        temperature=<span class=\"number\">0</span>,</span><br><span class=\"line\">    )</span><br><span class=\"line\">    <span class=\"keyword\">return</span> response.choices[<span class=\"number\">0</span>].message[<span class=\"string\">&quot;content&quot;</span>]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#token相关</span></span><br><span class=\"line\">    token_dict = &#123;</span><br><span class=\"line\"><span class=\"string\">&#x27;prompt_tokens&#x27;</span>:response[<span class=\"string\">&#x27;usage&#x27;</span>][<span class=\"string\">&#x27;prompt_tokens&#x27;</span>],</span><br><span class=\"line\"><span class=\"string\">&#x27;completion_tokens&#x27;</span>:response[<span class=\"string\">&#x27;usage&#x27;</span>][<span class=\"string\">&#x27;completion_tokens&#x27;</span>],</span><br><span class=\"line\"><span class=\"string\">&#x27;total_tokens&#x27;</span>:response[<span class=\"string\">&#x27;usage&#x27;</span>][<span class=\"string\">&#x27;total_tokens&#x27;</span>],</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#moderation相关:https://platform.openai.com/docs/guides/moderation/overview，用于辨别有害信息</span></span><br><span class=\"line\">response = openai.Moderation.create(</span><br><span class=\"line\">    <span class=\"built_in\">input</span>=<span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">Here&#x27;s the plan.  We get the warhead, </span></span><br><span class=\"line\"><span class=\"string\">and we hold the world ransom...</span></span><br><span class=\"line\"><span class=\"string\">...FOR ONE MILLION DOLLARS!</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\">)</span><br><span class=\"line\">moderation_output = response[<span class=\"string\">&quot;results&quot;</span>][<span class=\"number\">0</span>]</span><br><span class=\"line\"><span class=\"built_in\">print</span>(moderation_output)</span><br></pre></td></tr></table></figure>\n<h2 id=\"langchain使用\"><a class=\"anchor\" href=\"#langchain使用\">#</a> Langchain 使用</h2>\n<p>Langchain 是一个能够连接外部数据源与 LLM 模型的库，目前几乎所有需要结合本地数据库调用 LLM 模型接口的应用都基于 Langchain 实现。其调用流程如下图，本地数据导入后经过分割存储在向量库中，在提问时先从向量库中搜索相似的片段，作为描述词的上下文与用户自定义的描述词拼接作为 LLM 模型的输入。</p>\n<div align=\"center\"> <img data-src=\"/2023/07/13/Langchain%E7%9B%B8%E5%85%B3%E5%BA%93%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0/img1.png\" width=\"800\"> </div>\n<h3 id=\"常用格式文件的加载方式\"><a class=\"anchor\" href=\"#常用格式文件的加载方式\">#</a> 常用格式文件的加载方式</h3>\n<p><strong>PDF</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> langchain.document_loaders <span class=\"keyword\">import</span> PyPDFLoader<span class=\"comment\">#需要先下载pypdf模块</span></span><br><span class=\"line\">loader = PyPDFLoader(<span class=\"string\">&quot;test.pdf&quot;</span>)</span><br><span class=\"line\">pages = loader.load()</span><br></pre></td></tr></table></figure>\n<p><code>pages</code>  为列表，每一页是一个 <code>Document</code> ，注意页数不一定与 pdf 页数相同。每个 <code>Document</code>  包括 <code>page_content</code>  (该页所有文本) 和 <code>metadata</code>  (该页信息)，如下图所示</p>\n<div align=\"center\"> <img data-src=\"/2023/07/13/Langchain%E7%9B%B8%E5%85%B3%E5%BA%93%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0/img2.png\" width=\"400\"> </div>\n<p><strong>txt 或 md</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> langchain.document_loaders <span class=\"keyword\">import</span> TextLoader</span><br><span class=\"line\">loader = TextLoader(<span class=\"string\">&quot;test.txt&quot;</span>,encoding=<span class=\"string\">&#x27;utf8&#x27;</span>)</span><br><span class=\"line\"><span class=\"comment\">#loader = TextLoader(&quot;test.md&quot;,encoding=&#x27;utf8&#x27;)</span></span><br><span class=\"line\">documents = loader.load()</span><br></pre></td></tr></table></figure>\n<p>此时 <code>documents</code>  中只包含一个 <code>Document</code></p>\n<p>除了以上几种格式加载外，Langchain 还有 <code>DirectoryLoader</code> , <code>CSVLoader</code> , <code>JSONLoader</code>  等模块。</p>\n<h3 id=\"文本分割\"><a class=\"anchor\" href=\"#文本分割\">#</a> 文本分割</h3>\n<p>Langchain 中对于一般文本使用 <code>RecursiveCharacterTextSplitter</code>  或 <code>CharacterTextSplitter</code>  分割，推荐使用 <code>RecursiveCharacterTextSplitter</code> ，使用方式如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> langchain.text_splitter <span class=\"keyword\">import</span> RecursiveCharacterTextSplitter</span><br><span class=\"line\">chunk_size =<span class=\"number\">26</span> <span class=\"comment\">#分割每块的大小</span></span><br><span class=\"line\">chunk_overlap = <span class=\"number\">4</span> <span class=\"comment\">#与上文重叠的大小</span></span><br><span class=\"line\"></span><br><span class=\"line\">r_splitter = RecursiveCharacterTextSplitter(</span><br><span class=\"line\">    chunk_size=chunk_size,</span><br><span class=\"line\">    chunk_overlap=chunk_overlap,</span><br><span class=\"line\">    separators=[<span class=\"string\">&quot;\\n\\n&quot;</span>, <span class=\"string\">&quot;\\n&quot;</span>, <span class=\"string\">&quot; &quot;</span>, <span class=\"string\">&quot;&quot;</span>]<span class=\"comment\">#分割符号，可不加此参数</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#分割string类型</span></span><br><span class=\"line\">text1 = <span class=\"string\">&#x27;abcdefghijklmnopqrstuvwxyz&#x27;</span></span><br><span class=\"line\">r_splitter.split_text(text1)<span class=\"comment\">#返回string</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#分割导入的文件</span></span><br><span class=\"line\">docspl=r_splitter.split_documents(documents)<span class=\"comment\">#返回Document类型</span></span><br></pre></td></tr></table></figure>\n<p>此外还可以使用 <code>TokenTextSplitter</code>  拆分，将以上代码中 <code>RecursiveCharacterTextSplitter</code>  替换为 <code>TokenTextSplitter</code>  即可。对于具有特定头结构的文件，可使用 <code>MarkdownHeaderTextSplitter</code>  拆分。</p>\n<p>对于中文文本，可以使用阿里达摩院的<span class=\"exturl\" data-url=\"aHR0cHM6Ly9tb2RlbHNjb3BlLmNuL21vZGVscy9kYW1vL25scF9iZXJ0X2RvY3VtZW50LXNlZ21lbnRhdGlvbl9jaGluZXNlLWJhc2UvcXVpY2tzdGFydA==\">通用语义分割模型</span>进行文本分割。</p>\n<h3 id=\"构建向量库\"><a class=\"anchor\" href=\"#构建向量库\">#</a> 构建向量库</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#创建embedding</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> langchain.embeddings.openai <span class=\"keyword\">import</span> OpenAIEmbeddings</span><br><span class=\"line\">embeddings = OpenAIEmbeddings()</span><br><span class=\"line\"><span class=\"comment\">#embedding1 = embeddings.embed_query(sentence1)#对string类型构建embedding</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#创建vectorstore，需要先安装chromadb</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> langchain.vectorstores <span class=\"keyword\">import</span> Chroma</span><br><span class=\"line\">persist_directory = <span class=\"string\">&#x27;db&#x27;</span></span><br><span class=\"line\">vectorstore = Chroma.from_documents(documents, embedding=embeddings,persist_directory=persist_directory)<span class=\"comment\">#若直接从string列表中读取，用from_texts</span></span><br><span class=\"line\"><span class=\"comment\">#vectorstore.persist()#保存</span></span><br><span class=\"line\"><span class=\"comment\">#vectorstore = Chroma(persist_directory=persist_directory, embedding_function=embeddings)#读入</span></span><br><span class=\"line\"><span class=\"comment\">#docs = vectordb.similarity_search(question_str,k=3)#相似性搜索</span></span><br><span class=\"line\"><span class=\"comment\">#docs.max_marginal_relevance_search(question_str,k=2, fetch_k=3)</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>若要从 <code>query</code>  中搜索相似数据，可采用以下方式</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> langchain.llms <span class=\"keyword\">import</span> OpenAI</span><br><span class=\"line\"><span class=\"keyword\">from</span> langchain.retrievers.self_query.base <span class=\"keyword\">import</span> SelfQueryRetriever</span><br><span class=\"line\"><span class=\"keyword\">from</span> langchain.chains.query_constructor.base <span class=\"keyword\">import</span> AttributeInfo</span><br><span class=\"line\"></span><br><span class=\"line\">metadata_field_info = [</span><br><span class=\"line\">    AttributeInfo(</span><br><span class=\"line\">        name=<span class=\"string\">&quot;source&quot;</span>,</span><br><span class=\"line\">        description=<span class=\"string\">&quot;The lecture the chunk is from, should be one of `docs/cs229_lectures/MachineLearning-Lecture01.pdf`, `docs/cs229_lectures/MachineLearning-Lecture02.pdf`, or `docs/cs229_lectures/MachineLearning-Lecture03.pdf`&quot;</span>,</span><br><span class=\"line\">        <span class=\"built_in\">type</span>=<span class=\"string\">&quot;string&quot;</span>,</span><br><span class=\"line\">    ),</span><br><span class=\"line\">    AttributeInfo(</span><br><span class=\"line\">        name=<span class=\"string\">&quot;page&quot;</span>,</span><br><span class=\"line\">        description=<span class=\"string\">&quot;The page from the lecture&quot;</span>,</span><br><span class=\"line\">        <span class=\"built_in\">type</span>=<span class=\"string\">&quot;integer&quot;</span>,</span><br><span class=\"line\">    ),</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\">document_content_description = <span class=\"string\">&quot;Lecture notes&quot;</span></span><br><span class=\"line\">llm = OpenAI(temperature=<span class=\"number\">0</span>)</span><br><span class=\"line\">retriever = SelfQueryRetriever.from_llm(</span><br><span class=\"line\">    llm,</span><br><span class=\"line\">    vectordb,</span><br><span class=\"line\">    document_content_description,</span><br><span class=\"line\">    metadata_field_info,</span><br><span class=\"line\">    verbose=<span class=\"literal\">True</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\">question = <span class=\"string\">&quot;what did they say about regression in the third lecture?&quot;</span></span><br><span class=\"line\">docs = retriever.get_relevant_documents(question)</span><br></pre></td></tr></table></figure>\n<p>当文本过长时，可以使用 <code>ContextualCompressionRetriever</code>  模块来压缩，使用方法如下:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> langchain.retrievers <span class=\"keyword\">import</span> ContextualCompressionRetriever</span><br><span class=\"line\"><span class=\"keyword\">from</span> langchain.retrievers.document_compressors <span class=\"keyword\">import</span> LLMChainExtractor</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">pretty_print_docs</span>(<span class=\"params\">docs</span>):</span><br><span class=\"line\">    <span class=\"built_in\">print</span>(<span class=\"string\">f&quot;\\n<span class=\"subst\">&#123;<span class=\"string\">&#x27;-&#x27;</span> * <span class=\"number\">100</span>&#125;</span>\\n&quot;</span>.join([<span class=\"string\">f&quot;Document <span class=\"subst\">&#123;i+<span class=\"number\">1</span>&#125;</span>:\\n\\n&quot;</span> + d.page_content <span class=\"keyword\">for</span> i, d <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(docs)]))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Wrap our vectorstore</span></span><br><span class=\"line\">llm = OpenAI(temperature=<span class=\"number\">0</span>)</span><br><span class=\"line\">compressor = LLMChainExtractor.from_llm(llm)</span><br><span class=\"line\"></span><br><span class=\"line\">compression_retriever = ContextualCompressionRetriever(</span><br><span class=\"line\">    base_compressor=compressor,</span><br><span class=\"line\">    base_retriever=vectordb.as_retriever()</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\">question = <span class=\"string\">&quot;what did they say about matlab?&quot;</span></span><br><span class=\"line\">compressed_docs = compression_retriever.get_relevant_documents(question)</span><br><span class=\"line\">pretty_print_docs(compressed_docs)</span><br></pre></td></tr></table></figure>\n<h3 id=\"调用llm模型\"><a class=\"anchor\" href=\"#调用llm模型\">#</a> 调用 LLM 模型</h3>\n<p>简单调用方式:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> langchain.chat_models <span class=\"keyword\">import</span> ChatOpenAI</span><br><span class=\"line\">llm = ChatOpenAI(model_name=<span class=\"string\">&quot;gpt-3.5-turbo&quot;</span>, temperature=<span class=\"number\">0</span>)</span><br><span class=\"line\">llm.predict(<span class=\"string\">&quot;Hello world!&quot;</span>)</span><br></pre></td></tr></table></figure>\n<p><strong>设置提示词模板</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> langchain.prompts <span class=\"keyword\">import</span> PromptTemplate</span><br><span class=\"line\"><span class=\"keyword\">from</span> langchain.output_parsers <span class=\"keyword\">import</span> StructuredOutputParser, ResponseSchema</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#定义提取信息的格式</span></span><br><span class=\"line\">response_schemas = [</span><br><span class=\"line\">    ResponseSchema(name=<span class=\"string\">&quot;时间&quot;</span>, description=<span class=\"string\">&quot;事件的时间&quot;</span>),</span><br><span class=\"line\">    ResponseSchema(name=<span class=\"string\">&quot;主体&quot;</span>, description=<span class=\"string\">&quot;执行事件的人&quot;</span>)</span><br><span class=\"line\">]</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 初始化解析器</span></span><br><span class=\"line\">output_parser = StructuredOutputParser.from_response_schemas(response_schemas)</span><br><span class=\"line\">format_instructions = output_parser.get_format_instructions()</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#定义描述词模板</span></span><br><span class=\"line\">template = <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">你是一个数据分析师,你的任务是从用户输入的一段事件中,根据以下要求提取和输出信息</span></span><br><span class=\"line\"><span class=\"string\">&#123;format_instructions&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">% USER INPUT:</span></span><br><span class=\"line\"><span class=\"string\">&#123;user_input&#125;</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">YOUR RESPONSE:</span></span><br><span class=\"line\"><span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#将模板嵌入提示词</span></span><br><span class=\"line\">prompt = PromptTemplate(</span><br><span class=\"line\">    input_variables=[<span class=\"string\">&quot;user_input&quot;</span>],</span><br><span class=\"line\">    partial_variables=&#123;<span class=\"string\">&quot;format_instructions&quot;</span>: format_instructions&#125;,</span><br><span class=\"line\">    template=template</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\">promptValue = prompt.<span class=\"built_in\">format</span>(user_input=<span class=\"string\">&quot;2023年9月1日,小明去上学了&quot;</span>)<span class=\"comment\">#返回string</span></span><br><span class=\"line\">llm_output = llm(promptValue)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 使用解析器进行解析生成的内容</span></span><br><span class=\"line\">output_parser.parse(llm_output)<span class=\"comment\">#返回dic</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>此外还可以创建 <code>chain</code>  来回答，最常用的 chain 为 <code>RetrievalQA</code>  和 <code>ConversationalRetrievalChain</code> , 示例如下:</p>\n<p><code>RetrievalQA</code>  示例</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> langchain.prompts <span class=\"keyword\">import</span> PromptTemplate</span><br><span class=\"line\">template = <span class=\"string\">&quot;&quot;&quot;Use the following pieces of context to answer the question at the end. If you don&#x27;t know the answer, just say that you don&#x27;t know, don&#x27;t try to make up an answer. Use three sentences maximum. Keep the answer as concise as possible. Always say &quot;thanks for asking!&quot; at the end of the answer. </span></span><br><span class=\"line\"><span class=\"string\">&#123;context&#125;</span></span><br><span class=\"line\"><span class=\"string\">Question: &#123;question&#125;</span></span><br><span class=\"line\"><span class=\"string\">Helpful Answer:&quot;&quot;&quot;</span></span><br><span class=\"line\">QA_CHAIN_PROMPT = PromptTemplate(input_variables=[<span class=\"string\">&quot;context&quot;</span>, <span class=\"string\">&quot;question&quot;</span>],template=template)<span class=\"comment\">##使用RetrievalQA必须要有&quot;context&quot;变量,表示向量库搜索的文本,后续不用在input_data指定</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Run chain</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> langchain.chains <span class=\"keyword\">import</span> RetrievalQA</span><br><span class=\"line\">question = <span class=\"string\">&quot;Is probability a class topic?&quot;</span></span><br><span class=\"line\">qa_chain = RetrievalQA.from_chain_type(llm,</span><br><span class=\"line\">                                       retriever=vectordb.as_retriever(),</span><br><span class=\"line\">                                       return_source_documents=<span class=\"literal\">True</span>,</span><br><span class=\"line\">                                       chain_type_kwargs=&#123;<span class=\"string\">&quot;prompt&quot;</span>: QA_CHAIN_PROMPT&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">result = qa_chain(&#123;<span class=\"string\">&quot;question&quot;</span>: question,<span class=\"string\">&quot;context&quot;</span>:context&#125;)</span><br><span class=\"line\">result[<span class=\"string\">&quot;result&quot;</span>]</span><br></pre></td></tr></table></figure>\n<p><code>ConversationalRetrievalChain</code>  示例</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> langchain.memory <span class=\"keyword\">import</span> ConversationBufferMemory</span><br><span class=\"line\">memory = ConversationBufferMemory(</span><br><span class=\"line\">    memory_key=<span class=\"string\">&quot;chat_history&quot;</span>,</span><br><span class=\"line\">    return_messages=<span class=\"literal\">True</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">from</span> langchain.chains <span class=\"keyword\">import</span> ConversationalRetrievalChain</span><br><span class=\"line\">retriever=vectordb.as_retriever()</span><br><span class=\"line\">qa = ConversationalRetrievalChain.from_llm(</span><br><span class=\"line\">    llm,</span><br><span class=\"line\">    retriever=retriever,</span><br><span class=\"line\">    memory=memory</span><br><span class=\"line\">)</span><br><span class=\"line\">question = <span class=\"string\">&quot;Is probability a class topic?&quot;</span></span><br><span class=\"line\">result = qa(&#123;<span class=\"string\">&quot;question&quot;</span>: question&#125;)</span><br><span class=\"line\">result[<span class=\"string\">&#x27;answer&#x27;</span>]</span><br></pre></td></tr></table></figure>\n<p>openai 更新了 GPT 相关 api, 可以以 json 格式输出回答 (<span class=\"exturl\" data-url=\"aHR0cHM6Ly9wbGF0Zm9ybS5vcGVuYWkuY29tL2RvY3MvZ3VpZGVzL2dwdC9jaGF0LWNvbXBsZXRpb25zLWFwaQ==\">https://platform.openai.com/docs/guides/gpt/chat-completions-api</span>), 目前 Langchain 已添加了相关函数调用，具体示例可参考:<span class=\"exturl\" data-url=\"aHR0cHM6Ly9weXRob24ubGFuZ2NoYWluLmNvbS9kb2NzL21vZHVsZXMvY2hhaW5zL2FkZGl0aW9uYWwvb3BlbmFpX2Z1bmN0aW9uc19yZXRyaWV2YWxfcWE=\">https://python.langchain.com/docs/modules/chains/additional/openai_functions_retrieval_qa</span></p>\n<h2 id=\"langchain衍生库使用\"><a class=\"anchor\" href=\"#langchain衍生库使用\">#</a> Langchain 衍生库使用</h2>\n<h3 id=\"llama_index使用\"><a class=\"anchor\" href=\"#llama_index使用\">#</a> llama_index 使用</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2plcnJ5amxpdS9sbGFtYV9pbmRleA==\">llama_index</span> 是一个基于 Langchain 的库，专门用于连接本地数据与 LLM 模型。更新较快，此处以 0.0.65 版为例<br>\n需要导入以下模块</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> llama_index <span class=\"keyword\">import</span> SimpleDirectoryReader,GPTListIndex,GPTSimpleVectorIndex,LLMPredictor,PromptHelper,ServiceContext</span><br><span class=\"line\"><span class=\"keyword\">from</span> langchain <span class=\"keyword\">import</span> OpenAI</span><br><span class=\"line\"><span class=\"keyword\">from</span> langchain.chat_models <span class=\"keyword\">import</span> ChatOpenAI</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">create_index</span>(<span class=\"params\">path</span>):</span><br><span class=\"line\">  docs = SimpleDirectoryReader(path).load_data() <span class=\"comment\">#load data</span></span><br><span class=\"line\">  vectorIndex = GPTSimpleVectorIndex.from_documents(documents=docs) <span class=\"comment\">#create vector index</span></span><br><span class=\"line\">  vectorIndex.save_to_disk(<span class=\"string\">&#x27;vectorIndex.json&#x27;</span>)</span><br><span class=\"line\">  <span class=\"keyword\">return</span> vectorIndex</span><br></pre></td></tr></table></figure>\n<p>以上函数加载指定路径中的文档 (txt,doc 等)，并经过 embedding 将文档表示为向量，存入 json 文件中。<strong>GPTSimpleVectorIndex</strong> 默认使用 &quot;text-davinci-003&quot;, 也可以自行定义 &quot;service_context&quot; 参数，定义方式如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">Getservice_con</span>():</span><br><span class=\"line\">  llm_predictor = LLMPredictor(llm=OpenAI(temperature=<span class=\"number\">0</span>, model_name=<span class=\"string\">&quot;text-davinci-003&quot;</span>))</span><br><span class=\"line\">  <span class=\"comment\">#llm_predictor=LLMPredictor(llm=ChatOpenAI(model_name=&quot;gpt-3.5-turbo&quot;,temperature=0))</span></span><br><span class=\"line\">  <span class=\"comment\"># define prompt helper</span></span><br><span class=\"line\">  <span class=\"comment\"># set maximum input size</span></span><br><span class=\"line\">  max_input_size = <span class=\"number\">4096</span></span><br><span class=\"line\">  <span class=\"comment\"># set number of output tokens</span></span><br><span class=\"line\">  num_output = <span class=\"number\">128</span></span><br><span class=\"line\">  <span class=\"comment\"># set maximum chunk overlap</span></span><br><span class=\"line\">  max_chunk_overlap = <span class=\"number\">20</span></span><br><span class=\"line\">  prompt_helper = PromptHelper(max_input_size, num_output, max_chunk_overlap)    </span><br><span class=\"line\">  service_context = ServiceContext.from_defaults(llm_predictor=llm_predictor, prompt_helper=prompt_helper)  </span><br><span class=\"line\">  <span class=\"comment\">#service_context = ServiceContext.from_defaults(llm_predictor=llm_predictor) </span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> service_context    </span><br></pre></td></tr></table></figure>\n<p>service_context 可作为参数输入 <code>GPTSimpleVectorIndex</code> ，即 <code>GPTSimpleVectorIndex.from_documents(documents=docs,service_context=service_context)</code> 。此外 <code>prompt_helper</code>  中的各项参数可以直接输入 <code>service_context</code> ，例如 <code> service_context = ServiceContext.from_defaults(llm_predictor=llm_predictor, chunk_size_limit=1024)</code></p>\n<p>调用 LLM 模型接口时，从保存的 json 文件中搜索与描述词相近的向量，作为上下文与描述词同时输入 LLM 模型接口</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">answerMe</span>(<span class=\"params\">vectorIndex,service_context</span>):</span><br><span class=\"line\">  vIndex = GPTSimpleVectorIndex.load_from_disk(vectorIndex)</span><br><span class=\"line\">  <span class=\"keyword\">while</span> <span class=\"literal\">True</span>:</span><br><span class=\"line\">    input_data = <span class=\"built_in\">input</span>(<span class=\"string\">&#x27;Please ask: &#x27;</span>)</span><br><span class=\"line\">    response = vIndex.query(input_data,response_mode=<span class=\"string\">&quot;compact&quot;</span>,service_context=ser)<span class=\"comment\">#service_context定义调用的LLM接口参数</span></span><br><span class=\"line\">    <span class=\"built_in\">print</span>(response)</span><br></pre></td></tr></table></figure>\n<h3 id=\"kor库使用\"><a class=\"anchor\" href=\"#kor库使用\">#</a> Kor 库使用</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9leXVydHNldi5naXRodWIuaW8va29yL3R1dG9yaWFsLmh0bWw=\">Kor 库</span> 主要用于从文本中提取结构化数据，使用时一般需要导入以下库并定义 LLM 模型</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> kor.extraction <span class=\"keyword\">import</span> create_extraction_chain</span><br><span class=\"line\"><span class=\"keyword\">from</span> kor.nodes <span class=\"keyword\">import</span> Object, Text,Selection,Option</span><br><span class=\"line\"><span class=\"keyword\">from</span> langchain.chat_models <span class=\"keyword\">import</span> ChatOpenAI</span><br><span class=\"line\"></span><br><span class=\"line\">llm = ChatOpenAI(</span><br><span class=\"line\">    model_name=<span class=\"string\">&quot;gpt-3.5-turbo&quot;</span>,</span><br><span class=\"line\">    temperature=<span class=\"number\">0</span>,</span><br><span class=\"line\">    max_tokens=<span class=\"number\">2000</span>,</span><br><span class=\"line\">    frequency_penalty=<span class=\"number\">0</span>,</span><br><span class=\"line\">    presence_penalty=<span class=\"number\">0</span>,</span><br><span class=\"line\">    top_p=<span class=\"number\">1.0</span>,</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<p><code>Text</code> , <code>Selection</code> , <code>Option</code>  为 <code>Object</code>  的三种常用属性。Text 简单模式示例如下：</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">schema = Object(</span><br><span class=\"line\">    <span class=\"built_in\">id</span>=<span class=\"string\">&quot;person&quot;</span>,</span><br><span class=\"line\">    description=<span class=\"string\">&quot;Personal information&quot;</span>,</span><br><span class=\"line\">    examples=[</span><br><span class=\"line\">        (<span class=\"string\">&quot;Alice and Bob are friends&quot;</span>, [&#123;<span class=\"string\">&quot;first_name&quot;</span>: <span class=\"string\">&quot;Alice&quot;</span>&#125;, &#123;<span class=\"string\">&quot;first_name&quot;</span>: <span class=\"string\">&quot;Bob&quot;</span>&#125;])</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    attributes=[</span><br><span class=\"line\">        Text(</span><br><span class=\"line\">            <span class=\"built_in\">id</span>=<span class=\"string\">&quot;first_name&quot;</span>,</span><br><span class=\"line\">            description=<span class=\"string\">&quot;The first name of a person.&quot;</span>,</span><br><span class=\"line\">        )</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    many=<span class=\"literal\">True</span>,</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<p>注意，<strong> <code>id</code>  只能用英文表示</strong></p>\n<p>创建链并设置新的问题</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">chain = create_extraction_chain(llm, schema)</span><br><span class=\"line\">response=chain.predict_and_parse(text=(<span class=\"string\">&quot;My name is Bobby. My brother&#x27;s name Joe.&quot;</span>))[<span class=\"string\">&quot;data&quot;</span>]</span><br></pre></td></tr></table></figure>\n<p>输出为 <code>&#123;'person': [&#123;'first_name': 'Bobby'&#125;, &#123;'first_name': 'Joe'&#125;]&#125;</code></p>\n<p>使用 <code>print(chain.prompt.format_prompt(text=&quot;[user input]&quot;).to_string())</code>  可获取输入大语言模型的描述词</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Your goal <span class=\"keyword\">is</span> to extract structured information <span class=\"keyword\">from</span> the use<span class=\"string\">r&#x27;s input that matches the form described below. When extracting information please make sure it matches the type information exactly. Do not add any attributes that do not appear in the schema shown below.</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`TypeScript</span></span><br><span class=\"line\"><span class=\"string\">person: Array&lt;&#123; // Personal information</span></span><br><span class=\"line\"><span class=\"string\"> first_name: string // The first name of a person.</span></span><br><span class=\"line\"><span class=\"string\">&#125;&gt;`</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Please output the extracted information in CSV format in Excel dialect. Please use a | as the delimiter. </span></span><br><span class=\"line\"><span class=\"string\">Do NOT add any clarifying information. Output MUST follow the schema above. Do NOT add any additional columns that do not appear in the schema.</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Input: Alice and Bob are friends</span></span><br><span class=\"line\"><span class=\"string\">Output: first_name</span></span><br><span class=\"line\"><span class=\"string\">Alice</span></span><br><span class=\"line\"><span class=\"string\">Bob</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Input: [user input]</span></span><br><span class=\"line\"><span class=\"string\">Output:</span></span><br></pre></td></tr></table></figure>\n<p>当 schema 中有多个 attributes 时，<strong>example 中要包括所有 attributes 中的参数</strong>，以 Selection 类型为例</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">sel = Selection(</span><br><span class=\"line\">    <span class=\"built_in\">id</span>=<span class=\"string\">&quot;name_type&quot;</span>,</span><br><span class=\"line\">    description=<span class=\"string\">&quot;Whether the sentence show the name is of a boy or girl&quot;</span>,</span><br><span class=\"line\">    options=[</span><br><span class=\"line\">        Option(<span class=\"built_in\">id</span>=<span class=\"string\">&quot;boy&quot;</span>, description=<span class=\"string\">&quot;boy&#x27;s name&quot;</span>),</span><br><span class=\"line\">        Option(<span class=\"built_in\">id</span>=<span class=\"string\">&quot;girl&quot;</span>, description=<span class=\"string\">&quot;girl&#x27;s name&quot;</span>),</span><br><span class=\"line\">        Option(<span class=\"built_in\">id</span>=<span class=\"string\">&quot;none&quot;</span>, description=<span class=\"string\">&quot;not sure&quot;</span>),</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    many=<span class=\"literal\">False</span></span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<p>当结构写为以下形式</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">schema = Object(</span><br><span class=\"line\">    <span class=\"built_in\">id</span>=<span class=\"string\">&quot;person&quot;</span>,</span><br><span class=\"line\">    description=<span class=\"string\">&quot;Personal information&quot;</span>,</span><br><span class=\"line\">    attributes=[</span><br><span class=\"line\">        Text(</span><br><span class=\"line\">            <span class=\"built_in\">id</span>=<span class=\"string\">&quot;first_name&quot;</span>,</span><br><span class=\"line\">            description=<span class=\"string\">&quot;The first name of a person.&quot;</span>,</span><br><span class=\"line\">        ),sel</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    examples=[</span><br><span class=\"line\">        (<span class=\"string\">&quot;Alice and Bob are friends&quot;</span>, [&#123;<span class=\"string\">&quot;first_name&quot;</span>: <span class=\"string\">&quot;Alice&quot;</span>&#125;, &#123;<span class=\"string\">&quot;first_name&quot;</span>: <span class=\"string\">&quot;Bob&quot;</span>&#125;,&#123;<span class=\"string\">&quot;name_type&quot;</span>:<span class=\"string\">&quot;none&quot;</span>&#125;])</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    many=<span class=\"literal\">True</span>,</span><br><span class=\"line\">)</span><br></pre></td></tr></table></figure>\n<p>输入大模型的描述词为:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Your goal <span class=\"keyword\">is</span> to extract structured information <span class=\"keyword\">from</span> the use<span class=\"string\">r&#x27;s input that matches the form described below. When extracting information please make sure it matches the type information exactly. Do not add any attributes that do not appear in the schema shown below.</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">`TypeScript</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">person: Array&lt;&#123; // Personal information</span></span><br><span class=\"line\"><span class=\"string\"> first_name: string // The first name of a person.</span></span><br><span class=\"line\"><span class=\"string\"> name_type: &quot;boy&quot; | &quot;girl&quot; | &quot;none&quot; // Whether the sentence show the name is of a boy or girl</span></span><br><span class=\"line\"><span class=\"string\">&#125;&gt;</span></span><br><span class=\"line\"><span class=\"string\">`</span></span><br><span class=\"line\"><span class=\"string\">Please output the extracted information in CSV format in Excel dialect. Please use a | as the delimiter. </span></span><br><span class=\"line\"><span class=\"string\"> Do NOT add any clarifying information. Output MUST follow the schema above. Do NOT add any additional columns that do not appear in the schema.</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Input: Alice and Bob are friends</span></span><br><span class=\"line\"><span class=\"string\">Output: first_name|name_type</span></span><br><span class=\"line\"><span class=\"string\">Alice|</span></span><br><span class=\"line\"><span class=\"string\">Bob|</span></span><br><span class=\"line\"><span class=\"string\">|none</span></span><br><span class=\"line\"><span class=\"string\"></span></span><br><span class=\"line\"><span class=\"string\">Input: [user input]</span></span><br><span class=\"line\"><span class=\"string\">Output:</span></span><br></pre></td></tr></table></figure>\n<p>当 <code>schema</code>  中 <code>examples</code>  的每条属性分批书写，例如以下写法</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">examples=[</span><br><span class=\"line\">    (<span class=\"string\">&quot;Alice and Bob are friends&quot;</span>, [&#123;<span class=\"string\">&quot;first_name&quot;</span>: <span class=\"string\">&quot;Alice&quot;</span>&#125;, &#123;<span class=\"string\">&quot;first_name&quot;</span>: <span class=\"string\">&quot;Bob&quot;</span>&#125;]),</span><br><span class=\"line\">    (<span class=\"string\">&quot;Alice and Bob are friends&quot;</span>, [&#123;<span class=\"string\">&quot;name_type&quot;</span>:<span class=\"string\">&quot;none&quot;</span>&#125;])</span><br><span class=\"line\">]</span><br></pre></td></tr></table></figure>\n<p>则输入大模型的描述词中，示例写为:</p>\n<pre><code>\nInput: Alice and Bob are friends\nOutput: first_name|name_type\nAlice|\nBob|\n\nInput: Alice and Bob are friends\nOutput: first_name|name_type\n|none\n</code></pre>\n<p>不正确</p>\n",
            "tags": []
        },
        {
            "id": "http://yjfyqfzs.github.io/2023/05/25/XiaozhengChat/",
            "url": "http://yjfyqfzs.github.io/2023/05/25/XiaozhengChat/",
            "title": "基于GPT与本地知识库的数字人聊天应用",
            "date_published": "2023-05-25T07:10:51.000Z",
            "content_html": "<div class=\"hbe hbe-container\" id=\"hexo-blog-encrypt\" data-wpm=\"Oh, this is an invalid password. Check and try again, please.\" data-whm=\"OOPS, these decrypted content may changed, but you can still have a look.\">\n  <script id=\"hbeData\" type=\"hbeData\" data-hmacdigest=\"90a48df8e490762febf036ae63cb4601e3933bf026b7ec40a44d271c470428c5\">b4402e99068bc1cbc9e962a428aafa586f2bbf2aec7333b4905cf966945d46cf805bb2303bb2b3a6ad135e5f846ebdc08f2177faa9bcb80568e5d844e3e374a524d050ee82c48626135b517df2222dd2cc3c369235294969d99005a4fc10799604065f72fd9853d723e984d029ae360793c27cb02fbdd3725ceaf49d31aae6c63e248baf1ab443fc4cb6e277418b5fb5378e01dcb5248b189ebb01bc431c31a4a95dcfe9382cd21c2ef48890dfa46cb59da4347b69181d81ca85880ba2e14760aa4e8949c9fe45ac8d388e68a71b5d2fe20936590bcd4598a81b87500109951d8c05dd78150331f9f5d8f7c69102b6af3840b60576f863607cd383c1e52d9e429e4ce473987424308bd4958c63b096cf739edefc5519aa083c9e59fec0a7b2af1ebf61384c06d02a1c2b09e1aa3137b3d03f718f60d316977cc5ad848f1e7bee95b328cccd6fb1345a3da879e9658c0797fd1275323c565ae803d7f0665f6fa3bf681aac9030fbcdd8bdd77af802c0e378f4013b82cbe016130e93ab4b7c02055d24e675a15c7a9acdca53ec14e6bf678ea567c5d339ebfc247279828b4980fdc46024fcfae564c357996921c2173a74b05b3167b36b1958a28738fcc25991e34cc4be29141634f630c2a7e398a3b69c03f1f56674712a51471ecefbb55784d315e381f90ef1adcd043df6a381e1f4e46e14a3ee40221569547c696f3afb0d7d8f53fd36382136633c69b3034e12e99fec0306771a2451ed03096a932e4fcb5aef248e79fc767109a353f832de7994bb59d71dbb715e701ea641709e17b773a47a0cc1ddfc81efaeb5b90119fdfb1c54da025acacd4c24b4de0152bc67b927ca13dc82565e30ca13c1fe8984f62eb94afb53b3d99026bd4b801dc64464297161003cafac6624af6500b84f15f9387aeef3284e55048a32dcbc13c06962cf7ad974435527c4f74ed399045eef6fbe099f628ccdcfeb97ba262fa7af27decfc3b0de32fac8cd5560336abfb2dcb5d5400cdfa399826de0d87dec22171b851f18d2e08bafe22c6f9126bbc0987c53a07aeed936c6889af6d6004e7957fb42c2e0782604adf5364c036d54b30b19c8d771289fec6e19b89db16749f3bb315545b8ffdaed3cc12713209a769d3ffef992f558727a76dc7df6633b9d451786d960f7cf577ce4048c690872cc4a2056661ea53e8f0e77d9687c103bd77c2e55cc4238f343ec35ed6422ce678e868ce22da2ce569ddcc13f396e9fab05068140929d5909438ad39a67056a8e4e3e3b8a4d101d156fa9dfccfd7dff053277cb4c207425f44757bcee8016710b97f71ce824a12b71b1fe55679f843568c58a85de35e009ee4625535d4197d909e7382cc7384dfa138cba2ecf6740296287f006ce13bb77366b739a015971bacf82c60e8260be3dec047a5903298d8ebd502b4add156e8e201c25b09153f26b6e7b3a67e431480026dadb696acc23fcccb3ed9e3a59f6576284d688b4d2a7f9b914b2c609b6dc4341d8f3004a51d69e4abdc6af153bf53ad03a97bc7a50983f2d151e1b85cb80d21d44bd223ce8bc0a55733ecd90f2c75707c0d7ae387376fdecfebfe85d3b7f643066efc5197c7ff145b36f99dee7f9aef88ae8e16da761e283e4020e06acc01b4aa729f189e375709d124858d757cb9c9ae50739a2c2af5bab9d6a9e0b59c800c486a4cccb0998994a602310b7fb66f6920afae4cc1b43e0a25222d7528e463cb6dd1efd9c933008419a5e76bf238faa8a143b8d962b5bff2e23ebcd58299283bef8eb31600f3f3edc492aee8bced6914d12d74ef72f48c4e256fc1d937766f82ed1676d72fa13cbfc1ac9b6f94bc9cb35b5fb3944a9de1cfb8ece7a78d1d17344f17db14bdbf0715b622c05e03c53f85d7e6b3ffffbbb13f9b5223f39149618e507628526f0fd871af5c95c1468a43ab5af4e0c0a1fa58f4e7898ee5adbca256f790d3eeb6fe4c3b49dd5cfa09c51109bdae76059ec2c4f52e7bf6e595c5f26b561e2954fc4db18e7fc020193132ce1eed1d67b964f194e619081908b85590c1133c43485b53a2e34c7a1fbaebf5626edfa105ec8112a781ee464ede385fcc369e63ba5337f171863cc2f6c973e23b38af83701d67253edf33503d5f711a9fea18c44babd3f23320aa45b0df114236112b34256cd7f10cedccbb49cbc1bae3029007108fb2b833fc5e40be30813a8fa02eef9f5f98ae9cb4636b9a04c9f92ca3e34e113728e0bebe4870397019e0bc5983dc6d2984d5fe2d614ccf2de3667266238146ae2e602a0518b6b1d74034c66d17802e5c78d365c4868eb9eeb9bf3e0783c4df32daa9687ff0c6f1c76c16a9b5c70fd171285a97b132132444ced6ddf27ff467710fb6b73af3afa6b7cae4cc484196d2dd669c04a92b627094e76914c1733fb6e66017db916ebe07ad504d6293eb2624fa5ad2ae7a7cb5218391142f4372f8430ac07093f793a4a5756ca2652f34ab8ecd90b39356519160f1db1fa4be56092c81f6f5a41f52d007d6b40a4ef5ba744aaaff950386f36e09e213c201c9b608f4580b17fc496a0e2efe39bc0cd7673d3f3ff25e333c37388c38a93a1725012fbfcd13bc810e5eeb1a2eca82e13486f5f5925bb6416c8c8951ece756b025ccfab1450aaee6c4058ac8acd62e07075dce66ca7ed88c47590e5f5a6f88c1da49d49ba8bc0b6b4d7d9ab6ec691206f2cbeedb8d750998fb3a29345e59dfb5e03c8bbc1e7fe664c5e419053d9a52b58af91e2d37de605fa928e1e0ddefa49ec2bc02f36a202c34ab032238679c84e756734df2fbfc79f395ea73886b1ba477e1cb8fbc2c4eb39f1b74838de7375f8b5c13ede7061e00d79222501021c821c6da6eff2a0f4d557fa38d864c123f83f55f65fb3a7c90e0ddbef6629b049e2efb25821adcf373afca5d04b57149ded2ebff27cf668209dd7b361ef5f835abaf9ee5c4136940bff60db60ac59a3f302d71f2beedfe27313664ee8b478c1f2a28f6ea151c0ca0bd96075662f47ba056986895d411763ffc79da72110ba18a897925c12035ee4c891887e3d4b1c749a0e7af378308d6cf0d3503424a6b2c1975d9a0d5ec138e06a337e9d448f41191359aa07fcdf8b6445ba75d3432c04dd7db540e097cf973a4cae999216eb4712c1901af62e67ac6f876c066b44ecc0c9a52df87eb505699300cb28698d11acb7e2f9bec4c4b251025b9cdced75525fc6410eb3aa1b6fd9503b5e1b9a68b40cff2da744e6a21ed5fcd04e697292457c983aad49a026c9ad874ceac2465fd872f279128e5a13574e1918542fe660ab694399609208d8b4d83f78e97a5adaa838ab0b31cb6f4f1290658374ddd91a4e1c9f16971f840c53bb1e0270bb4449403cb46e6bd9f63e823ed84fd98b0d67e1d999053063d678179a9e6ce4cf5f63632bc1349dd70fcdb3fc66b614a336da6080d196f71108a0a293b64940eb4821f18ed97e192271b202e2086bd73cea412b4978b2b53d162d1ce1bb617e06ead1534a95c3fd0d772fd38c3bfaee06459b2a971360520a913a262f91ee99c2a7469fb1afaf3764440cddd78531edce7eb6c186c2346ea8f8caefd631c946c5cb57a79c01b4d65d74e03e4a5d31c4ca6a74952af8b1494b91dc39c38d23033a3c00053127b892499c53e929a690e2a8815aff6942626859dab8892d876eca6d3b404ea33eefd7ea3bce376700860132076c84ccabb6bffb0d537c7e0781aae50c74b3d61b896e1db4cc86aa03b6df22e16f97f2d194a41806dc13e1ef8ce97849547acea6706f8f726a13f9e29ea3d0973fca8200c02be7dd098d7b4868d773365925087042fd362f3960aed6bfcab4f5746a98204693ed5ce2fa13b2dffa2d9a76545e7a4f0c1f014ffa421e8c4f61e1f05df044bde96c2c4e349e1ba29b18ff88bb976b839f0dacd7138a6b82a3cfa3c8e40c862b5fc4d662bfee8f8e12aa59cef4d66d11c8893ead45fcb4e7f5be19cd84d2c43f46069733d6b7d578e70990747a22a09fdfda0e15cc1c68acab23306b01ac954e3de3762797310c0c5214591b52d9e1dadd036a9a63934f2037981ee21df19f89e15261cc589b974457e473ed936ba5f7ed99ae01e073acd00fbdc3c82bdf3ff87660a5826183ca14224b05aa7f622825f1edb7e2c57aa46fbd6e027b970e0286779ee215359dd2dff59b01bfdd0ebe7e2ad9dffc1801aa06f14e6cf56ef67611812214093349c3d29516443b73460abd470f2af0fb3f8b9cdb66f07a1b23cde877ea44ea5603af199fdd3f3c9e7a98e3976fcfce50f455541d3319826bedbab6f063f3641dd15d731f9596a9ddbdb2be24506631cc56599f31f4ba3755225290354d43a4027ce3baf5266da560f82382db6f8719967ef018f28fcfeae51928c3d427b5df99bb92de00783481b9e0739b0147bdd73bce266c9ae1c301d2f3d935d59561ccfaf961c6b87c8b20c2359d6a8418ced28013be16bf5ad79f28b2b1c4f7b0b330216ebdf001ccc275b35e48e34bd2f11563f024ed6453cd17c31330c64152c92beb8aad1181bfd9fa46e55a79a7b3045a49c7e3842b9ce9e7f9c06ce4fcecf77af94e3d0f93c7a5cf0d73e22d7fa90ae9b3f8eeec3c60817784a1dc36ace8ea95043b3ef83fc551177d919e24a573a3140415c7384a1fb3f528c44e127e503ad1e6d197a23f7b58c2a75c4c93d2d147f7131dfe55d90a62d381d454c88eb3252fd5ef778d353b138aea34bd38242255e789c67c4d9b611e44167427286258c2330b14530f90e02a9a2394513183bb2eea68bf4a20b9d11b509a3a89e3ad561e0de3cd83c776477b7e73f469e7afa2d9381c5500ff456b71f231f1707b672e4795f210ea75b5fe5cf9545ed19726f767b98f52ee6c33290bc3c440101fc14904da2b9134640f21770ecd5070ee1cd2e270eee616592e3ad87be745d96c64f3cb9f3ce436ccebb3d0c02b9da253be47e19d2449903731c48207bf2f171f2070a7e6e8333ee4dc83ef662f025003d409543552405578823def3670ff057e4d57d22e73b0f9b7895a2e006d7f7cdceff2e31503f98b7580759fa4f133955c414cf77ea92f818b90b6b92923f3f29a57ee61240b239e397b46993d3a428ab0c614f2ceca143d526e414897f486d9226f300906811a32586f776ba3ece43e5ae7c89dbdcb8c8a66b9c147b6f46ae561055c2efcee11ee29bb1129fb21ded73743a23c5dd6e6015b48d17f3036ce534a3948de28f756a1fe0a747a5ec1e24e34562327d0457ca9ce83e03cefe5403cfa27e11a3a9f6a41fc473155488ea354ae5274cdbb05d7582a02658c3a294ec8331eb15e97b3b7361baed7bd8e14989cb27ed7526c1969bd3aa049cf2a9e41f8a884e541b96294eb1f7868556ac42167a851140e45493f306aea51ef67839b18d6a0c39556b26e5487bc3f829a4a9a0d8e41a20e9534030dab3334a8ef2120cd39529cf6268f6a2affca5c7cbb226a3f1dd0fb5c3861d20298dbc02d64be4bcb64b309651e0930a01336b067885447e9e84a90ff981ab5e0e66816c08c975f1038df7cb9dc416eda253d40005dc1812440288af1343c3771afa927f4aa64bd4cf6bd2288440b3d4bd3bf42acb0bf0552455aa1116017082ff34cd75331913cc57277dd84bbecea86cd0d6ebd7ecc270898a7d09df41ddc139c87a9620fd012f05e1896e5afd2e991620c8c037e88a642afb2be3a2fd1e24fd944727bdc864e977068a13b0b77d408022f81ff5ae19afba5ad9d92dfba1bf3bb9af4c2615dc97e0085f06e57d297e527bc60bb6fc1af3891ae738fd931d58596bf18f8cd52901c22cfe6d3844831eeba113137460522d3152de27fb072888e3ea2d6a794fe3b7d263044867b7fa9e33ff177078b6e501b7d016ca0e2e0457b390c5e335ec7bdab7df31730b6817fd2bbfefbdaa709682865ec08e51fdf49babc4642689ab747173d64b731f7bbb7c23f8d8f0ede61f6ec74a40bb8760051b53fe72ad97a81a9014ff0ea6787306fa346bbf90cfe11d9bb1f958e2aea3f48121cedbd65b7053ef188335f773c27a1a55051faa97afad6de346a7a0fee449e29204e64bd7295597abd8bfb0cfbdc96e41a7cfa1be0c522756e24daa57c53751107ba34c1641206db7dedb42c8a3f12f99028d4ba6e793d0090d525980d2b9692424a98081721d40f3a2cfb2dd44787fde37655084656ef2f879466b5615d3c01e7d7ad740ff80c64d106b2609328ba7842ca47a4799fc7e64a71f8b76c29390281aa3741dd56220198511b59414147f32f268b2b3ba6c4f40f2593aa7dbe88016377f2e5e381dce814db419fd3007a1fedf517d7c205aad523d9097e8d6764cf58a3bee15e936f871be5cd01725254354901e2ff8fd271e80e72f91c964949443e2b3da59ba658d39d424a89f5d2c98abf3f32e971106b26709e23f0da1299c8f29fc1d4df81c63bac3fef27dc5ef374805aaeeb8028d779020cf8b65daa092a308852799b5476ed9259b4ddb574e40264537c17ecd25b4a9a18a49ad6bc3ac0203fad449d0838eb8037e67c68281475933b08e855df96ece6a6e5f0c94757551d28bc61dd3b057755ab69121474cb8aee041f1688d60cc8f2eac7c1a74f0a04428627951bf7845e21f12858679cc8320caed703ebc3bacd994c9d5953736aaee084eab6b5243edd65f9d76c8fefa216d46f2e97881ca6daa28c0300823e98e949077e9ff3fce7864576fa5088c6343dd7572019834b607dbd0df67ec25a56b2f2571970cd6e624f7ca0d254910338b37c3041138530b8a4c425b6e8554fd10b1d704324b18017807fd62ac43aff39dd2e7c2f2068279b4ded985f2e391318130bd947365e5f4a4f81a93efa4284e2cf7ec551a8f22bbcf4b52ebaf91d879cf75aa0cbbff9e0ca2cb2f99ee02dfa32d75fb8e038675e5ac290ada0a3970909f9f24b0da06c1832809cfd742c86d8797750581b4b1d802559b316a176670c1ad13f6dd0fe9ef162c635b80f57959ad37829ea3614587d1616e404a025ee7ba1846850c161ca671a0f63575159346ee503ae07e030725c771d611354719d744a2a5af33437e6556518e963f4f781a4a1dfc0275928a4c7c7bacc40bdca3a8ce9a1f225abf79af0664d4f43e57aca37df46685574e63b829affee29a53130aac6dc1d5d51119c7ba62f2fe2797650a10842c6bb51656684054d5038e9af2cbb76a842f761532e315fcc85ef373c256fbc0dfe3782b72ac0d63966a46c82b74dca00de6c807ca3cbb15d4cc5396da7e61cefce05858ca42abf5181e9f2608d1043b94b75fc8debf8aba58368edb59b7695cd53c91757e08f6bb1b3b67b00907321d93999b20e7343313c943451fb2e82f538ffd8fce91258e0dbe502fb837ec01e33057bfcd168752842d366e7cda5a4ca76fe9fcdb2db59a40d5348996a8316ceecf001a8896dfa34d648e4dfaaa6ff67e981d41cd8581ba1dbf273466b9657e80a1bf521ca4809ce766aadcc23f81846044bc2c4bc1ee84f65add9dff9bc0598516e7a6138f55d087a8bfd84d872a9b71787f3568438e653ef5fb6e6582eb902c9f68fb39caaf85a1ce56bef9504cdb89057c37e3424d3c09ff1cc208b26a41945f7f80ee5a016b2461f65cc7914f9c646030c54cb98451cbbeda9d3ab5629bc2222b50feb042c56aacf133bfd819acaa5327791fe9dd5e926890787f19c0a349ff8b8cb2e178514f28fd2a6e63dd75e93c3aadab9a28aae1d9f718da0280508e61bb2ce6352ca7259d303e28176a9a6340abbe9bd3a69c397a49f01111f1ef29922e2a45f19c86df3796f78b62605bc25e3fc7d401c83df29fb585b3dbb802103f4a22a6c1ac355e168d1073684dc508afdd5a2a1737b2605d22d7f182a917a77bc0b52fefcf16b0d4158b917b372bfca498b084b001e7f252818f3a75a685590ae826aa0038dba6e31292bccfa9f4f6fae689d45af7dc57ddfdf280fac6745d55930b06a57d3f8759105e8093f2e6772ec786d3157d41c35e1dcadeac6b354d245d03754d6bea1a8e24ff0de6e1ee96140e1956066285225fdb4e9189a9ea5a4218390c339c7eb2c6906af41283c79240ffff916a1e2cacbdb8a419897ce1d07e36d0491f897b2ccbbb732d12e68fa0539704b80171c422a03bc338263a254fe8ca0041598eb1ee1762efccb781beee37290a0104fb8a05ef61690fcefe4c6dda1bbf80618a9cd11ee29e0318c29b51675d9d008b60b2f74ae3d6ae5bce2aa835db1d8b5d31f419e4da72486bef8b215591691ce99f95c6e6cc6da200a6d99101f466b9622fc9572cf881fc1db89a9874cb575fb88363f7522b3ae0af776d46de9140b5d418e610bb4e827a5c154ea010965a060e1849e08f8bfbb602597ec37d46bf39010b79babb27a4927185b73002acd05675a7caba891366137c5a12cabc778c0eae95c573f37a618c510bcb1b058cc422f9ecc95f5364daded1b81bbf6b0a56532b74c0afc3a610655e8f66e5f2f5af3af5c1f8d6589a34fda050067fd7802cb878dfc21d8e0cf46086067efbc88e8ea57675f97c46445e4dc1667c79fe7a58679d262a2cddec78bef4a24ba2b0022cdeaf0b92f94c5711b9d97d353f9de2d6a5f3ce38b00d26d92234692757f77338ec8926bb3c7d50aa97814c78412382a17b72ea237c9820d9d50ec04c54b0fe6249e7add49e37daed3686f13e37696cd96b88557946c2ab435854f9de957d1f81e90aa345e0b24c2b29c45da23fea865cca35e04b9ea591f976bf77dbcad05e399da2022df10e036206910e2af92de2087ee98fd27204229a9224f95aacbb9c5bf6272b0cc88bd15ff390140ebc57db733446464e926c79277c19188d23fbf5970b8ffb444353336ca3de5746e751881c23f850c3f61acefea5653434e240f67dc664a4b4a4e5d5f60b8ab54c044620040f30b3ea6bcc8be98ff6a550b7015bc8b396baf9a42dcf991d0340e7229de25551597d98e6896b8ffaf3da1fc73762b669612ed8726c43cb766169661aad2253d5f94fb53f8a5ba0317cd118925d210463f35fa322b1381c90780c8364a0b8b5cf84c0f00aafa777cda988ddca99129d1287c05b6a5c809402cfcc679cf8ff9d1f93b076c0cf9731d187283c0de55b597b938a3caa2a1181e15b3348a3bddeb92af0f0bdeaa45a193bb26443f55c5dfc7c1522e824b4eda772dd81f24dafc32645ab5ef899ff5ee35be456d7702802dfbe6bce67206589984cbeb846e885672a9561d59eaf2620b11e821c6599e28a0b642b76cc1c0a4e8d1948e0195e707e99c7cbb40fc740ac2933655edafb1a43e2506493cf661964d145c94c988f881b4280425fed1cb51e962b2676b5e6a18d769477f0ef1db451f78f12bdfb9c0eaba311ebd933676d5174b4a0c4e36079c9825c930fb047e1ef877afcb7ba10c184d15a2beb0d38fa931550fa94a7dd18cfee98ca76d8899228b20fc2c6dd9b06e9e8eb60fbad51fb4e878a047ab5425de61fddb53398b7676297624148aa22dd571d413dd3ac8af9cb5ee74dda9ab217d7586ebff364c45b72caf6bc9e8e76054805bb45d4317cd9f74b0877bceaa142ddb252a9fd57f8058bcce5dd1439e544cb9e03ef818e9dfe66dc4d52cd6afda8b3889fbc7b1c85150e44a565b39c09f7a64993d5e820ed9ee0ffc197c0d8b00aec186e041cc4619d8f1f4148a79cea41b64b7b1b75b7520ae0ed107c9e1dd4edea13e5c938c614b32f71d471c22a070ff912e214cf57d8aa3432f0a7f56986eb045536708899af9c4b8e0c97908e6cd5498be21731c8917d4fef3a0a5731a5cb23832479544be7434240a8afc358b2130f93f59e8f84c1ad4820d4b2bfd3421f827c3d06e2e4044f5e74d3f001362b1e018d79387cd34e92a6dd6195153d1bb67491fec37cfb8ce90a2e8a36d38fd64854b75853f354c82eb4810d375e3930e1f33ebf3b59987c72880966ede21958a76d4dd0a7e0593f6a2a0d61113c5e3450ab41c8b4766f280a10b4d4db557e9e433774baa3c3cb444d71b959ec347399629611edad38576f51f59ab707d23d15bf80e34866e7a69b36b4df4acdd5002dd5d9a8ef79335a5e921a78da42800729a2335cdb46dcca998ddc54d51483628ec7f05a8e44aa478d5d5e749d1c1e31954a381c9d343d0fffdde1b30d7d9250e443e972e9ed7fec6dabf6dd351f83a8b3066069d34665eccb12b1364042abbda0213a7418ee85a96853c666e3a23cd7dea954fb3c86162ee5e7065c78741378364b0f7a2d62ad069a9933cbccfd1ff293275221baac2e678adbcd1e4fb31030af9de6ce0797ad363893fe4788846093c5bf89398c52436fcd0ebea00367d5cf757a647533f2a9f89903c36f1ce53838e4cbfa358bb3ec6b5d974291791896b7488e7fe4a31892edccfa718b29bdc40b9ecd033e3911cd0a4633dd0b735b075999c130191df6657329568ef925b2b53840c01a20a181727e85b247d489e485346d08b11c683f6bd07abac0abe4011a21cfc39cff100c7aec1abe28582e5fb1474b78f9805d94687aac339d44fd1e87a994632806dbe16deebc3c3749d12efee4af045f1f463c4e3bd07d7181ad37a2177c8f6da172ed701b7722a60e7b730b8f15649255a8e97d678fa29515d68150bd126e69a4adf7aabeb51b15c8dcea39eb765e49b86ec7f350e27e45cd5cccacc3c897175ffb4eeacddb1151f265f3457f701011f70c1a59672b6bc3e006187db8eed8df9a1ffec362475554a6bdcdc9facc616d0b9fe7d459fe5aa39c1e09dd392641c028808be6b75668f87379b7dc7e6dc722f2ccf0e307def508232dbcfa5e38f4eb0a313158ffd404c93c2a4b1a175f62e04d5d5e9fcdb1e21d381220b1dbc6bc23de39b920da0145dd17ced211cfaf9754be1572fd92bcba57a65a87cc0667cd212926bed7c1cb4ed3f27120300194e9e7c1dd75b7896afa2ea834b7bf45b084d9d21756801912c7e6d8ec0081ecdc85cf6285181186bb4755aed829a2ad2ab4423e82c3b5aacd4f3fee23d4c63ca43f8c5b2d43ac4edfc7beb8b93c8da8d9f3936799013248b2db98b87b6a881934b25f9aa3c3cfc44f4b1169cc1899fc665208975ba596198c39ac88b3f6747020c379251114a5d46ed140bab54056027fdace1f76f195d354a761c5e54b4e2af3fbeb5ee5c3be18e5e22f1d031c858238827bd935beedcdfe5131e96c5132963d686a8c5e80fd6427cc515b699fdd67f7c81eafb9e60147bfb31d1832b068927a4fc0ff5685f0511adcd279661e6c58ec5b408a573ff7a994b15ef7fbe9a379984e88297f44caa619473b9f00005bc4c7ac1e6c27444b7aac6a4e05b1631832321edd091be16ae449a8626c7523ae223a98d663af15129079944c114727fc932eccf0d06035c1bcd5df9aa50ad020d9a14e6da0b15f71c4989fdac050b2382b26e5c366140774ed09e07be2784162b249641f0e1cc53b7e23c056a6ce5f61938e467c4deb920621bc913b7b891cbe62dc2e4c16fa06480bb9f2816589f53719e91c5240919ce12acf271e246c12b44e7817086d51d8cafd7424ad715b47ea8df04d47581a72725bbb77cd56a2f7c9cdaa12df1f2dec9ac0fa8ba42c516267206bf6d2ebb7dfeac51173221561c06b95659b7e76ffdddd121893852ef936d33f58e2b1b58be9196d90c2830009597b43987a366a5931017a1cbdcd9215dd11a4da4aacaf7b095d8b58fb7673ac8a846a44333fdddef98b349d6923125f940d2bd043ce10b6c62666880520b8788213884fdec12360b46e716d3c51741d093aec9fedb0bf4d86ad66cd850702fdbc440372b2135052022974475103dadb1ccb9908b8a6577215d6eb59685b57dc594f32978ca314b93815dedf105f379697a198c67c83734ae5b3b1248935f404e1bb03bc54e76b0b3192f9cf58476aa6ad5e8f07e43c550b7f482b093f3aab40dc39401117e103b32fad6de19568c0f5330de1708a697ee675f7aec1d1a610fe2139a188a1e6244dd273284d7411de54e57576b2b2139485bd7cc6f5cc268e1b15be9eb18c0f3b5f0916c9c80265d69ecb47cb07b817cca7120e9a5a2ec7e6e91020d404eb5220b1453bc0a6bbd537cccf36cc9b205929b096bd6d3061508cab03c5395bf330910d40da346ce0c323a073fb3f7ede6c1ec51098727cb85b77277f014da52655447cec4f45891f63d54ce19c18109236903fd7492e03e7624c7a65de5a3e7fd0d177df908097aec65c8739c1825a7d77ee0e3904e0ee5f98641285eaa4473532a3f948c5e9d9215efc61bca5959e016887fec46a92f19913962fc6c5e82c6e06b5db2f037bf292b5a25031458604935fe7e0626bc314dbeeadcbd39aa7a3c3e8bddcafef626e1a1ccc798442a0bf9fd80cf532ab53209e106f77f0fda4568b5e82496829cdc021d02f7b3e7105a730d7ac2a099e8f3d8670730db1fcd6689f06e9754af02636dfc84b26d56d6a761127da0437720fe65577ce89a4a353e6e5e2d948f60800a96e69ef6004ae467565d76e5efdab2932d5cda92237b648d052052f425f36b8c5509b0da270c9ad2f5319914983b77a39fd9c439c4f8a98fea2a173d1a15939010893ee94d4eb907d14961ca5c3538b541bb44c4dfbaf302198159fd3f1321e5ef54e26f1791a57512474ac77660b1c713c6d8724f9f7ba38fbe04eff4b615950a678f1fbc0a1db915b1a54363753b01f868c8c7089df1e68821a558373c28c915bf8400a99539e7410716a16132b971cc2eb96b3106d3f23ba516fb7cec85e751fad9c2b0f8c34cde786da5c6772e0a3605b3f66d41b9d0fe6f19fe272b3c045dc94796937212dcfabf083c0e250f708e0ae2af42aab86f9612f50e8e3bf0835e484095b325df3a7b9e0f19d67588d6da323a1d06c2c109e963fd3e9478ee5b69d54f051334970dc13e6e9bac0b83134bb5efd3de9d7ea88ececdbb0116bbaae3d2dcae25305229278df5a8735a119dc6590ace9687965240cf45578269c700ed6790c4a1836ce156cb7ea34b3a232321766a3d37c185e0d900b11c311612839489ccb19006efb7ebd5f74bb25f4472e7618a80325a0a8f721ab4bc134333e4ddf5c7114b758ff0c3121feda3a1b1d1d495bd132c7fd86b7f7d100aaa74264a018097c4db8b920ef8f3a5d994d7df0fc21a520bd19d5424f549a18f6660af7c662d30a199c77833175cfc2466fcd85985c3a0ef530db11da3ac6c2d53013c7c3a86391891e1f937d178df1d219873700f1d380f80933d24f70d60a78859e0c8a6af133029b337d331bccf7c4f4b61189a61824c1c968d434a4d57e13c3ca59e8ee762434bdbc04580484eb9da2a33210bf940ab8bc8fa452c9b29a5a3a5b380af7162ece1534036221d4e5c8809eb206a60522821ddb431732f61a2db34b550ec045a39b4b1a93eb72dce02003fbfe4dcde9c83bdfe145bf47004e870b2f26cafa85d0dca5c18b9048db755356fe324081b73f470dc668be1316dd1ec673422dffc6e0e8bd9d1b5d36835ae3a6d60bddad06b057c5a18d27a338725db3a79c2430cd3d9ca26480878d2d68ade70e562ed74f4fde212aec51f27d7b4504af720990c4785be6d88b78a37958ed3213f1b1e48cd106b5240acb320fe040877139b7d085ff2fa46f951360f5c723d3a6cdee5c0a7e3158522415423da31e7f65a8931912c2a7e85863ccec95b03db41b6318752b8a54e472b4ccd1e7ff69324623621346fb7ba9e0ed75f759731afe4d206a0c81def6829947fa72907c8d767db855473e675fda1face9028025c89dee3d214a4bdbff6af14dfd9b480c3b88283f34a28f2d550759f2349efbad533a2942937f246730ad9de37d85e94523c83664ac978c139895c6c41b923fd93ea5534fce625c6e6670a787d52a72b46810428c93e0815f683d0f59e34859ae07364d06d9c255f03aea0c36f1c36ac19c16901f68357e2aa95665f2996a8f02465335f17ab7ba63ec5f30c877ca6f6e202d59414c8cd6189e53d75cb59c3944ef3d3964ddcf4e4eece8b2438c42b765f370db0972038bf84c7a23db87516f44f1e6dd805a5c68045e9893b475bbc53d5c3e1f2bebe42709fb97180adc3bc1aa59d152827cad377e890039274c372c838e72a896a9962ada6fa581ad1c13e70cb266c777dec65a7891ec85e089cf56b3d866ea8b60e0668f29d325716c882c225c407dda453ff976fe077910d19b0c421b8f25dd67c2cb1de337e4410b2be8082d0d8b8873afd4f6ce645db905a4c03c0925f4d8359f83da9acc9fd8582d03eb31be0cb411eb73c5bb9baa7c61dbd44bd328a55ac91dc272a5eff3de8ef578f4bcd8e4341649ed9b451061a9bfa624c451b2943de6531b7353e1a15eb0f879616471683705d328f5b6cb991fd0e89ebcf3bcdefc91003ea7948971692e3e111870fa8dc55469824e678310f4f18f2cef503d0f30adaf65a8cdedc602d4fcfd8ba8d455a820dac1774b7bd7b79a0c48c0216cefb212da2e2a29b8985c8fac2c2734e16fa1abe0a540500bfe4dabcb2748fa47d2b053cab3fbb55afb12aa001642ccca2f48a66911c80054a726c13e7deb2ae5ce9ae6ca7138ed76a1b363856d30360afa22a5575c5f6322dbf0b88450b88148ae56f7f4a1585f923c6cb879ff2aa78f0813def13e6016622fbe02e87f3dea1afab7dfbb986eba1b82eb633b1c4a7ec6b0946509033849b3d61202719931274b6e88bc1b65ccdc0da6dd8ebec74441de5354f5e5e80d26f97b96bb8a72d65743e667ce1fa69149bc0f1a6dde48c70c5f73353622723c6fb5a33b4d5358273beb251570c357977fa20d002ad0f59b1803810085908e804aeb9570297b09806c15a258514cc381939fec8c53cf3f9d8fcbebf56447000c78470fa9ca2d709d73b24e69230391beffbcd0c1b30741d4ae16bcf760c94e58ff12848121bbab38861760e021b256955f2ef4d82490c5721b329d594949da73a7cf762c8843822f63d44085dc175fd95fb9452cb8c2ca103690c1be14b63e76a3fca68024e69fe681b44015ee6da52f5afb3e1ef48130169f31b2b7cdbabf1ff0ec77e5f059578294d9c01647dc30c6540460a07f36d143104c04f074b0a8bfc15b8db3bcdb219561bf32f5a7f9293ae6bbedba5d38dda91f907170d3ebebd6a52180d8695d3aed269eac4887f619fefc464cc02e860e7bbea7a6ab1587c1ae7309b5c2234a5d831b6e05a0c4d9077efe6d5210167cd5faa563a5218cbafa6e40e33e23f79f88ac659439dcb2035ab9ed2de7666c56460f7d1cdb8b9b6158b43d76d5bd7fc080717aaefe515c6bbde8231c94b9294e5e353f27bc211980edb267bb60dde54df6c09e32d5951c2432d165730690ee9b96f2ff5741a8b3f15abd8a86d42cf3380d9961e643ca3b6e096f16bc8cd26a25a081b6242da51b32e1bbc47561784ab9f9d617c49d76be7cea41977078edcd1259a6ca01017a8ba1d01a701f179e2a4b41ecad8f737494e8a038a7a92dedf6dcea718e7d49e058f24475848712d4543e45b6ab32c11f255ef4134e3ca82643bee1c8d93fbebaef583a1e41fab3966af9870589d8ebe1e7c6e2ebd455e191bcf155c40a7b7b952293b7134275cf46fdfff3ed11bac2ad098fd125aff0a712921c9ff2f3335f8f6f00b50563505794b00838fb3a523d6f7537dc97ffc4d19c1583c8a7ee5390f8e9399a83f469c26046109320218a6528c2415873fb146b32e570e863f95b83ac813f86009be550fc82d760c6c38a6b1e2d69271d41fdf6a97b8c5030220762888dba1dfe7de3b429a3d8ac30ffde635b31240bda941b03987ff5f592cf1184a940fe89cd561068435623bca31d79f08ab1a123fbd469da668d3b36b430cd0a9a032e5fc9ebb44be40e9c7ea0633fdf1f18303ecfb3645cfd377c06ae183f06e210b079f848697770eaa34241cc1159d6a3ccc2e51a10e45dd4be1b1f2abc008554db2eedf1c7ab17ad654e1aa6512d05eb335de6e42224973a1d9075e5d0405f48d28649944d482ecb907c0f8d413e5dcd7f8f302c79c6eb0eb8eec9514d41c8cb9ab096930d3b76c2838ff6ff8b7f257de76083c22f1bf4c05a3d459a831356f1278dd39b8ea14cbcdb18585bd1aae0d97ff2e12f0e27338f78506430124af007367c70188ca15498a68207a5277f3b502197746e8e950c2fefa4ba80f67c71e65bc774caf271d4f56d435d7444092f874824c8c4fa5b02aeeafd856125ae2e7cd45346cdd0d2efc6cb7064ee4670f25e2318f44d254ba5fc1a837bd78eba1060e9e7c48a19949e0d243f011ac2edb3844890015a2cbd177971bb2727168b52e377e5e51ef3c7a611fc6b75a43721b18e6332c579f3b7ddd963426d72bc1232027dfa655afa124e5a294901998f115df3bbad53c824a4d6900d2451a2e797bb53a0156e471c6df0b8f215279476c3de8c6a8b8224981049230364d2b725483513b09ad7355252d613ac29d6f9af2f96a291586f36dcf85637b619dac0449b851488cc3bbee74e37bd945bcfa17bbad20afbfa8fb08b96e30b63d6736cd1838127d45e89e0bf41f0827d7c78e506830dc448c09de18ca35dd49cd3cce68de71bb895faf7d724741fc57ea959630576f17c528135499d687badd4dc77b65df1369e1119398838f3d52fbe3e9330d1464a4d88e1f5aded755c6d262e2d7dbac647e87bd02ce6c93a330f2937cfdb68095b897d0e236902245477e76cb80a4ed9ddc972823605134df53aa96f85113ed965c1fc3b8cb4d51af56cbd3fa4223ddfdf7b6de490fc4d72a3b7c63fba5e51221ed196c7913c24f753aece98545f5f03a94054738dc816494972df2135f0327a1438de829108ceda7b5b8db72c4e35a03933a057c83495869c28946e304832d59f660a1753a0b9e9438da1b4cd11fe335e24d03ed9ad5e2a4a2dfe613424a6e2c3caf2c26070876048a38df9ba7ee02f040fbbdde8ae62bc1caaaf9087e78c208e12d9802f66611ada00681cf8df646dda44042d3d49232a10b8ce3784cd027bae34ca19909750a9f20076702bd1bde384635de134df037fe000c1b37fbd7ff96f65344e9ccce3af0f9b595e8a1e30421a9f63c222939363ada2c0d3fe2e4ae04c7db81860e3997732999d861d0a450221fe1beb0d1be4cb4b60859c20b4e3a49f277ea82384835944d27bb28797cdad071d68b7eb40bd94024f9b19825167586e12dca7bdf39c62ac723331693f6d5b1a96583c0e4c0ac4b56a4e4c530135279fa8b57bea5a6b597fccf80c7d7af7d6a78f42d3c68450aaf1fd99ce99ee90a1c0de2d0786d7b82293a4acc45532d1ff37b3a363edafe50dd3e7ebc6b509dd319fd2081958e032843502a92ddbcfa71214f474975ebdbf8c32e1f71528aa4b2a67cde8138d97c8c1eb52f895c7960bd746140bb0134550128aeb2243af160de2eb9625480d1e0ee6832ea06a4638b03d605e11409865d61a8b860717da0b5cfcee1c04a39cd2cc0d0ab69a27f78456a025800df0a40c68fc2c2619c804a37cd75da67d91b964a6fc061ec36ce3be90b13922d1d758376dd3c4d4ee9b07654f2208cd8d395137f4b5445c5f92ce0680c28fea3762794abffbe42315e6b667c26c2c94cf4da8080d3a1fdf08149f31554ed1bd9fd916c28441a112c95e8ea58dbb9f2aca5621b33ed3fc20ed68867a5de0a951c88b279441653b0e1e54b12f9f708e9716070366035552b2e23e547f0c833c2866129824ae2951b43256eab470f4ca1d3d9216275fa75d7c39a08959b6cbfb0c0186f938aeca5c6ee3f0ef6653f94e7c04c204e3dd8e497ea511781c12caf275a26fbdcd29c4b2fdcca80e4e833e395116798d108e40e814296fbe988594fd147edb022d4715b0f318ce788d12f4831c12f376ecbf38166d1b60abe6b8f8c7e25bf052c673d2ff322a644cf3752ee0aa25488ec0e0f7f5ef8795777b2de42dfc38f61f1ce33f85d85224c0c3e6b1eac907839efdcb1780bb20f90d98e2c99c7d9ab490ca11fe80eef234ff4fe57790ff85332eacd161390909774d41eb90e176e2a5f5e7763691b5d3a8727f21f199bd44bdf205c42ad4d5ce488b9c51686a2da2235da811f7f3f2b21eb27bfc16ce21fdf4f24016b64e2174c19d6ed6502385f11e4b5dac4ce9337e6ec999ef5a5b97766c74223b727c1fda453ceb611d089cbd7edaf171126362e7bdb17ebdad892ed48e4f670b4ec3f958b521b932b09bcbf0a9ad6bcf09e9c91641b2e82585bc514766c146c863f356972f98ba0c21096a963d43382c3795bf6718ee6801f623430f4dd2c4e1f7d1cd6013de85cfb902fdc695eaec70e0513abe07a87bf649173448f0da5b7732894389920b5068c634788e0cb7d351d4bc1781f3ec4c33cae0ec75ca386a48eed90a1100be3110acb09c0878a6d98c85f11e2bde430e3b2f9527b5601d2e6361850bc7b4ed0ee30234731bca545eaf58e08860d3bd47369a0c3b8a33879cf0ceabe3d4b50c91b17674f4bef5ffa50f92f16cc794d1b73529bdab2640bd4f496e21d8bdbbaede5a699e5b5137492c5cc9134c549502c0b7ca56df7dbf4bd1d52c4f98407b930a527f1e8ce0c8fccdabeb58f98099a0c8547a477f353985c1ca3788129d8f32f5c61b50e7555e002652548b16d6bab5f75f32caf087ebfa1f3205c99e5403582c85ab73544d3eada9b82fc8ee2fb5990dd868190339f6563fd6e712fca17943f3f1c61a7ba84cb4236f3ec10597d137e594c8c4aee15afd24af5d8f500d909936b826bca2a232bbd1d12494b19965a2e8c696a5c5c94d8e8257d1cbdf66a7b2cd09b86be48c9a7705f9e50c830b9bb9d7887cc457519e9638d0e139843b63fe9d18f4ef1fba6f7ab19f9658a28ccbf04fdb85765588d4d754f593bbd4aa53f362e61b3fe2bde91670bb668c6ad9ecb7895f1a7b912f1e33f0242c40bbef78db8c9e7f1c1e2fbd2a8aaee07450e6aba37d5dc3a645442e0f5b48a1e8024767e8198423c100ef95e62154cb5ccb4210f07c77acc8d66ec836519eb16370880991744c8a5fa33917b3c3efe1730520dfbb8f6fcbc864d91cd1b5bef33df48fe7860a29bd616d4d859e6ce8cb837005158ab2af373db9993064e3418b3bc2bd358a222559ae305482872392efbf618db02577ef6382c848b4c60715b9840d6d324aa0d24ed4592ff4966d518e8ece99a899d6cc7bfa27f6ba97c541f299048b318a027554a4bd032f933af8488f21f7ec6a6639c4963dca8a9c7b4607579327bc57a39081081e38196341088e8f64c33e03231723c5332bb18109c152d9eb2c88438f5c1f295053134bfd1087eaef827b572a0b84971f1796786db8fa27d94a4ddf1ad506c3605167b3b0ea8f5bba20e0d08e171fe1a5a67a7b4f9b51bf3166ddf3840275e29c23cf0fb00c53ae20d0df2efa0548a882dcb6f5d41ffe68cebdb439efc36ef88708cdba951544f6d7bcc8737ae719668e70445867febb0bdec0fc1820658e1c676198a907ec8a2fdfd1516e992b051102d4fc755250814519aaedbb3d09bff113542743078b916327ccdf7e7e9454eac8b90cc6cea6b56e5f0c182772d3b9a43bc9f5f69fec59bc60410a3fd986a2b9118a517e2059ece49dc857cc37d52eba9a5ff902fde4c46a4950e5ea3fbbcf1aaf501bdd0cce8a5eabb968cf50a2eb6e38a0066ec749e3eacc9c441a170ec3e434e109200fdc7057efd1b8850bb77615dd09598791536e9cce7f53e954929de7137ab4e4473e09284533f030e684239bec803b9e4d80c3eb53df6b53b38bdd3af9126d69092e11d80c412816e4af28b50106b96435f775119d708d7cbe8901428425a631b1c7000e96b158019387e34da963c260492826c866531e365aa219f1062af1a39b784698a4edf14063e4db85e4c50b23f05809acb7b98fe042edc11539636c3c01d342597d87d39073b50120cf348c1d10f2240b7759b4bd47cc083c76aa93f63b605d731f7d19d8ce476b8f4c61ee8739254b4afe8fc2f0294d0be57c8a1fa46d5cd4285e9c731e2fb79c497d422306325e8bfb61a491fad725e301f949d761c50f95f4461b25997c2f5b38f8788da085639a38c84a0ea8b38c81e5722783ec9fd9d51f9390e0a7b5c9f79bd388da3306bdc5be913defde4ba6bcb07babdbbc736b2f13215be197eae0a1291d269634c5aae139c3126835ddf9ab93e0e0d240d1b4926c4c058fcb58329b068762446f43e0956ef0986455cb17201f2dd4d62c7fe9525dd80ec1f3cdf1825df955c97169edec0e646906356eb6c8461413d889b5d1af6b511e572113af1460b0221113c43a35ad2f1b299a4b6a97d550c706d2f21b5d8f6caeacaf07a3a0896eb7252024aafdc10b25fb26707df0cb728872b7b1d6265a767f95a125b0f225954eda694add2846aedf627d02721572eb7b504a506636d0766d51cf48423f86e0638a12bf9a7d03f15bf7ba362cb1b05fbcae0566670bea4ce7802d99b75955f35ac63290bee77d4cd4d214ed21655942c101603e06d32e6fcb460093af5dc6d9961e3983cdc49f61dd42e294f9e9c71900a7dfe297019297067931da478d9d661a331826025c7b9dd8fa0c4f183789593c20b0c5b6e31bb9e02168eed4c423b9040488b3927</script>\n  <div class=\"hbe hbe-content\">\n    <div class=\"hbe hbe-input hbe-input-default\">\n      <input class=\"hbe hbe-input-field hbe-input-field-default\" type=\"password\" id=\"hbePass\">\n      <label class=\"hbe hbe-input-label hbe-input-label-default\" for=\"hbePass\">\n        <span class=\"hbe hbe-input-label-content hbe-input-label-content-default\">Hey, password is required here.</span>\n      </label>\n    </div>\n  </div>\n</div>\n<script data-pjax src=\"/lib/hbe.js\"></script><link href=\"/css/hbe.style.css\" rel=\"stylesheet\" type=\"text/css\">",
            "tags": []
        },
        {
            "id": "http://yjfyqfzs.github.io/2023/03/04/UeMayaControlRig/",
            "url": "http://yjfyqfzs.github.io/2023/03/04/UeMayaControlRig/",
            "title": "Python实现Unreal和Maya传输Metahuman面部控制器数据",
            "date_published": "2023-03-04T00:30:41.000Z",
            "content_html": "<p>Metahuman 的面部控制器可以直接在 Unreal Sequence 中调节，使开发者更直观地修改动画。但目前只支持将 Maya 中的控制器 FBX 导入 Ue，Ue 修改后的控制器动画不能直接导出。<br>\n此时使用<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmwwdjAuY29tL3Bvc3RzLzFiMjM4YjgzLmh0bWw=\">智伤帝的博客</span>中的方法，实现 ue 控制器关键帧导出 json 文件和 Maya 导入控制器关键帧 json 数据。另外 Maya 导出控制器 FBX 时烘培了所有帧，在 Ue 里不方便二次修改，因此用 Python 实现 Maya 控制器关键帧数据导出 json 和 Ue 导入 json 数据。<br>\n<strong>重要 tip：</strong> ChatGPT 有利于辅助 Maya python 代码编写和纠错，但不能用于写 Ue python 代码，ChatGPT 会编造并不存在的函数。</p>\n<h2 id=\"前期准备\"><a class=\"anchor\" href=\"#前期准备\">#</a> 前期准备</h2>\n<p><strong>Maya 创建集 (Set)</strong><br>\n 框选所有面部控制器（不选外面的大框），点击 <code>Create-Set-Quick select set</code>  创建集。后续如果要删除集中的物体，可以使用以下命令删除</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> maya.cmds <span class=\"keyword\">as</span> cmds</span><br><span class=\"line\">set_name = <span class=\"string\">&quot;mySet&quot;</span></span><br><span class=\"line\">component_list = [<span class=\"string\">&quot;pCube1&quot;</span>, <span class=\"string\">&quot;pSphere1&quot;</span>, <span class=\"string\">&quot;pCylinder1&quot;</span>]</span><br><span class=\"line\">cmds.sets(component_list, remove=set_name)</span><br></pre></td></tr></table></figure>\n<p>如果控制器的 TranslateX 属性不可调，需要将其锁定（选中控制器按 <code>Ctrl+a</code> ，点击 Translate 里的 x 属性右键 <code>lock attribute</code> ），否则 Ue 读取 Maya 导出的 json 数据时可能出错</p>\n<p><strong>Ue Python 脚本使用</strong><br>\n首先需要在 <code>Settings-Plugins</code>  开启图中所示插件</p>\n<div align=\"center\"> <img data-src=\"/2023/03/04/UeMayaControlRig/img1.png\" width=\"400\"> </div>\n<p>打开 <code>Windows-Developer Tools-Output Log</code>  可以看到运行日志，python 代码可以在 python 模式下单步运行，也可以在 cmd 模式下以 <code>py &quot;./MyScript.py&quot;</code>  的形式运行</p>\n<h2 id=\"具体代码\"><a class=\"anchor\" href=\"#具体代码\">#</a> 具体代码</h2>\n<h3 id=\"maya导出关键帧json\"><a class=\"anchor\" href=\"#maya导出关键帧json\">#</a> Maya 导出关键帧 json</h3>\n<p>在 Maya 中点击创建的集，选择层级，运行以下代码，需要设置保存文件路径</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> maya.cmds <span class=\"keyword\">as</span> cmds</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">import</span> threading</span><br><span class=\"line\"></span><br><span class=\"line\">attr_x=<span class=\"string\">&quot;translateX&quot;</span></span><br><span class=\"line\">attr_y=<span class=\"string\">&quot;translateY&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\">file_path = <span class=\"string\">&#x27;Your Path&#x27;</span>  <span class=\"comment\"># 保存文件的路径</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#获取选中物体关键帧</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">GetSelKey</span>(<span class=\"params\">selobj</span>):</span><br><span class=\"line\">    obj_x=selobj[<span class=\"number\">0</span>]+<span class=\"string\">&quot;.ty&quot;</span><span class=\"comment\">#selobj[0]为控制器名称</span></span><br><span class=\"line\">    <span class=\"comment\">#print(obj_x)</span></span><br><span class=\"line\">    all_keys = <span class=\"built_in\">sorted</span>(cmds.keyframe(obj_x, q=<span class=\"literal\">True</span>))</span><br><span class=\"line\">    <span class=\"keyword\">return</span> all_keys</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_controller_values</span>(<span class=\"params\">ctrl_name, result_dict</span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">    获取控制器的值，并将结果存储在字典中</span></span><br><span class=\"line\"><span class=\"string\">    :param ctrl_name: 控制器名称</span></span><br><span class=\"line\"><span class=\"string\">    :param result_dict: 结果字典，用于存储控制器值</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    selobj=cmds.ls(ctrl_name)</span><br><span class=\"line\">    all_keys=GetSelKey(selobj)</span><br><span class=\"line\">    single_list_x=[]</span><br><span class=\"line\">    single_list_y=[]</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">0</span>,<span class=\"built_in\">len</span>(all_keys)):</span><br><span class=\"line\">        cmds.currentTime(all_keys[i])</span><br><span class=\"line\">        </span><br><span class=\"line\">        <span class=\"comment\">#只有x和y两种情况,判断x属性是否被锁定(注意不要用判断属性是否存在,恒为true)</span></span><br><span class=\"line\">        attrx_lock=cmds.getAttr(ctrl_name  + <span class=\"string\">&#x27;.&#x27;</span> + attr_x, lock=<span class=\"literal\">True</span>)</span><br><span class=\"line\">        <span class=\"comment\">#attrx_exist=cmds.objExists(ctrl_name + &quot;.&quot; + attr_x)</span></span><br><span class=\"line\">              </span><br><span class=\"line\">        <span class=\"keyword\">if</span> attrx_lock:  </span><br><span class=\"line\">            single_list_y.append(&#123;<span class=\"string\">&quot;frame&quot;</span>: all_keys[i], <span class=\"string\">&quot;value&quot;</span>: cmds.getAttr(ctrl_name + <span class=\"string\">&quot;.translateY&quot;</span>)&#125;)</span><br><span class=\"line\">            result_dict[ctrl_name] = single_list_y  </span><br><span class=\"line\">             </span><br><span class=\"line\">        <span class=\"keyword\">else</span>:<span class=\"comment\">#如果存在tx属性,x和y需要分别存储,名字也不一样</span></span><br><span class=\"line\">            x_name=ctrl_name+<span class=\"string\">&quot;.X&quot;</span>           </span><br><span class=\"line\">            single_list_x.append(&#123;<span class=\"string\">&quot;frame&quot;</span>: all_keys[i], <span class=\"string\">&quot;value&quot;</span>: cmds.getAttr(ctrl_name + <span class=\"string\">&quot;.translateX&quot;</span>)&#125;)</span><br><span class=\"line\">            result_dict[x_name] = single_list_x</span><br><span class=\"line\">            </span><br><span class=\"line\">            y_name=ctrl_name+<span class=\"string\">&quot;.Y&quot;</span></span><br><span class=\"line\">            single_list_y.append(&#123;<span class=\"string\">&quot;frame&quot;</span>: all_keys[i], <span class=\"string\">&quot;value&quot;</span>: cmds.getAttr(ctrl_name + <span class=\"string\">&quot;.translateY&quot;</span>)&#125;)</span><br><span class=\"line\">            result_dict[y_name] = single_list_y  </span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">save_controller_values</span>(<span class=\"params\">ctrl_name_list, file_path</span>):</span><br><span class=\"line\">    <span class=\"string\">&quot;&quot;&quot;</span></span><br><span class=\"line\"><span class=\"string\">    保存控制器的值到 JSON 文件中</span></span><br><span class=\"line\"><span class=\"string\">    :param ctrl_name_list: 需要保存的控制器名称列表</span></span><br><span class=\"line\"><span class=\"string\">    :param file_path: 保存文件的路径</span></span><br><span class=\"line\"><span class=\"string\">    &quot;&quot;&quot;</span></span><br><span class=\"line\">    result_dict = &#123;&#125;</span><br><span class=\"line\">    </span><br><span class=\"line\"><span class=\"comment\"># =============================================================================</span></span><br><span class=\"line\"><span class=\"comment\">#     #尝试使用多线程失败</span></span><br><span class=\"line\"><span class=\"comment\">#     threads = []</span></span><br><span class=\"line\"><span class=\"comment\">#     # 创建线程来获取每个控制器的值</span></span><br><span class=\"line\"><span class=\"comment\">#     for ctrl_name in ctrl_name_list:</span></span><br><span class=\"line\"><span class=\"comment\">#         t = threading.Thread(target=get_controller_values, args=(ctrl_name, result_dict))</span></span><br><span class=\"line\"><span class=\"comment\">#         threads.append(t)</span></span><br><span class=\"line\"><span class=\"comment\">#         t.start()</span></span><br><span class=\"line\"><span class=\"comment\"># </span></span><br><span class=\"line\"><span class=\"comment\">#     # 等待所有线程完成</span></span><br><span class=\"line\"><span class=\"comment\">#     for t in threads:</span></span><br><span class=\"line\"><span class=\"comment\">#         t.join()</span></span><br><span class=\"line\"><span class=\"comment\"># =============================================================================</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">for</span> ctrl_name <span class=\"keyword\">in</span> ctrl_name_list:</span><br><span class=\"line\">        get_controller_values(ctrl_name, result_dict)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 保存结果到 JSON 文件中</span></span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(file_path, <span class=\"string\">&#x27;w&#x27;</span>) <span class=\"keyword\">as</span> f:</span><br><span class=\"line\">        json.dump(result_dict, f,indent=<span class=\"number\">4</span>)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">ctrl_name_sel= cmds.ls(selection=<span class=\"literal\">True</span>)  <span class=\"comment\"># 获取所选的控制器名称列表,名字与名字_shape</span></span><br><span class=\"line\">c_len=<span class=\"built_in\">len</span>(ctrl_name_sel)    </span><br><span class=\"line\">ctrl_name_list=ctrl_name_sel[<span class=\"number\">0</span>:c_len:<span class=\"number\">2</span>] <span class=\"comment\">#间隔取值</span></span><br><span class=\"line\"></span><br><span class=\"line\">save_controller_values(ctrl_name_list, file_path)</span><br></pre></td></tr></table></figure>\n<h3 id=\"ue导入关键帧json\"><a class=\"anchor\" href=\"#ue导入关键帧json\">#</a> Ue 导入关键帧 json</h3>\n<p>开头需要设置 Sequence 和 json 文件的路径，Sequence 中脸部 skeletal mesh 名称</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> unreal</span><br><span class=\"line\"><span class=\"keyword\">from</span> collections <span class=\"keyword\">import</span> defaultdict</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"keyword\">import</span> re</span><br><span class=\"line\"></span><br><span class=\"line\">DIR = os.path.dirname(os.path.abspath(__file__))</span><br><span class=\"line\"></span><br><span class=\"line\">my_seq_path=<span class=\"string\">&#x27;/Game/Seq/ControlRigSeq&#x27;</span></span><br><span class=\"line\">face_name=<span class=\"string\">&quot;head&quot;</span></span><br><span class=\"line\">json_path=<span class=\"string\">&#x27;Maya_control_val.json&#x27;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#使用正则表达式,删除字符串末尾的_和数字</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">remove_suffix</span>(<span class=\"params\">s</span>):</span><br><span class=\"line\">    <span class=\"keyword\">return</span> re.sub(<span class=\"string\">r&#x27;_[0-9]+$&#x27;</span>, <span class=\"string\">&#x27;&#x27;</span>, s)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">unreal_progress</span>(<span class=\"params\">tasks, label=<span class=\"string\">&quot;进度&quot;</span>, total=<span class=\"literal\">None</span></span>):</span><br><span class=\"line\">    total = total <span class=\"keyword\">if</span> total <span class=\"keyword\">else</span> <span class=\"built_in\">len</span>(tasks)</span><br><span class=\"line\">    <span class=\"keyword\">with</span> unreal.ScopedSlowTask(total, label) <span class=\"keyword\">as</span> task:</span><br><span class=\"line\">        task.make_dialog(<span class=\"literal\">True</span>)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i, item <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(tasks):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> task.should_cancel():</span><br><span class=\"line\">                <span class=\"keyword\">break</span></span><br><span class=\"line\">            task.enter_progress_frame(<span class=\"number\">1</span>, <span class=\"string\">&quot;%s %s/%s&quot;</span> % (label, i, total))</span><br><span class=\"line\">            <span class=\"keyword\">yield</span> item</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 读取数据</span></span><br><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(json_path, <span class=\"string\">&quot;r&quot;</span>) <span class=\"keyword\">as</span> rf:</span><br><span class=\"line\">    data = json.load(rf)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># <span class=\"doctag\">NOTE:</span> 读取 sequence</span></span><br><span class=\"line\">sequence = unreal.load_asset(my_seq_path)</span><br><span class=\"line\"><span class=\"comment\"># <span class=\"doctag\">NOTE:</span> 收集 sequence 里面所有的 binding</span></span><br><span class=\"line\">binding_dict = defaultdict(<span class=\"built_in\">list</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> binding <span class=\"keyword\">in</span> sequence.get_bindings():</span><br><span class=\"line\">    binding_dict[binding.get_name()].append(binding)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># <span class=\"doctag\">NOTE:</span> 遍历命名为 Face 的 binding</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> binding <span class=\"keyword\">in</span> unreal_progress(binding_dict.get(face_name, []), <span class=\"string\">&quot;Face&quot;</span>):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> track <span class=\"keyword\">in</span> binding.get_tracks():</span><br><span class=\"line\">        <span class=\"keyword\">for</span> section <span class=\"keyword\">in</span> track.get_sections():</span><br><span class=\"line\">            <span class=\"keyword\">for</span> channel <span class=\"keyword\">in</span> unreal_progress(section.get_channels(), <span class=\"string\">&quot;获取通道&quot;</span>):</span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"comment\">#print(channel.get_name())#str类型</span></span><br><span class=\"line\">                ctrl_name=remove_suffix(channel.get_name())<span class=\"comment\">#移除channel后面的数字</span></span><br><span class=\"line\">                </span><br><span class=\"line\">                <span class=\"comment\">#判断是否存在data中是否存在该控制器数据</span></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (ctrl_name <span class=\"keyword\">in</span> data.keys()):</span><br><span class=\"line\">                    <span class=\"comment\">#先删除已有的关键帧</span></span><br><span class=\"line\">                    key_all=channel.get_keys()</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> key <span class=\"keyword\">in</span> key_all:</span><br><span class=\"line\">                        channel.remove_key(key)<span class=\"comment\">#没找到clear_key功能函数</span></span><br><span class=\"line\">                        </span><br><span class=\"line\">                    new_key=data[ctrl_name]</span><br><span class=\"line\">                    <span class=\"keyword\">for</span> new_value <span class=\"keyword\">in</span> new_key:</span><br><span class=\"line\">                        frame_number = unreal.FrameNumber(<span class=\"built_in\">int</span>(new_value[<span class=\"string\">&#x27;frame&#x27;</span>]))</span><br><span class=\"line\">                        <span class=\"comment\">#print(frame_number)</span></span><br><span class=\"line\">                        channel.add_key(frame_number,new_value[<span class=\"string\">&#x27;value&#x27;</span>])</span><br></pre></td></tr></table></figure>\n<h3 id=\"ue导出关键帧json\"><a class=\"anchor\" href=\"#ue导出关键帧json\">#</a> Ue 导出关键帧 json</h3>\n<p>在开头设置需要读取关键帧的 Sequence 路径和脸部 Skeletal mesh 的名称</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> unreal</span><br><span class=\"line\"><span class=\"keyword\">from</span> collections <span class=\"keyword\">import</span> defaultdict</span><br><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"></span><br><span class=\"line\">DIR = os.path.dirname(os.path.abspath(__file__))</span><br><span class=\"line\"></span><br><span class=\"line\">my_seq_path=<span class=\"string\">&#x27;/Game/Seq/ControlRigSeq&#x27;</span></span><br><span class=\"line\">face_name=<span class=\"string\">&quot;head&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">unreal_progress</span>(<span class=\"params\">tasks, label=<span class=\"string\">&quot;进度&quot;</span>, total=<span class=\"literal\">None</span></span>):</span><br><span class=\"line\">    total = total <span class=\"keyword\">if</span> total <span class=\"keyword\">else</span> <span class=\"built_in\">len</span>(tasks)</span><br><span class=\"line\">    <span class=\"keyword\">with</span> unreal.ScopedSlowTask(total, label) <span class=\"keyword\">as</span> task:</span><br><span class=\"line\">        task.make_dialog(<span class=\"literal\">True</span>)</span><br><span class=\"line\">        <span class=\"keyword\">for</span> i, item <span class=\"keyword\">in</span> <span class=\"built_in\">enumerate</span>(tasks):</span><br><span class=\"line\">            <span class=\"keyword\">if</span> task.should_cancel():</span><br><span class=\"line\">                <span class=\"keyword\">break</span></span><br><span class=\"line\">            task.enter_progress_frame(<span class=\"number\">1</span>, <span class=\"string\">&quot;%s %s/%s&quot;</span> % (label, i, total))</span><br><span class=\"line\">            <span class=\"keyword\">yield</span> item</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># <span class=\"doctag\">NOTE:</span> 读取 sequence</span></span><br><span class=\"line\">sequence = unreal.load_asset(my_seq_path)</span><br><span class=\"line\"><span class=\"comment\"># <span class=\"doctag\">NOTE:</span> 收集 sequence 里面所有的 binding</span></span><br><span class=\"line\">binding_dict = defaultdict(<span class=\"built_in\">list</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> binding <span class=\"keyword\">in</span> sequence.get_bindings():</span><br><span class=\"line\">    binding_dict[binding.get_name()].append(binding)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># <span class=\"doctag\">NOTE:</span> 遍历命名为 Face 的 binding</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> binding <span class=\"keyword\">in</span> unreal_progress(binding_dict.get(face_name, []), <span class=\"string\">&quot;导出 Face 数据&quot;</span>):</span><br><span class=\"line\">    <span class=\"comment\"># <span class=\"doctag\">NOTE:</span> 获取关键帧 channel 数据</span></span><br><span class=\"line\">    keys_dict = &#123;&#125;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> track <span class=\"keyword\">in</span> binding.get_tracks():</span><br><span class=\"line\">        <span class=\"keyword\">for</span> section <span class=\"keyword\">in</span> track.get_sections():</span><br><span class=\"line\">            <span class=\"keyword\">for</span> channel <span class=\"keyword\">in</span> unreal_progress(section.get_channels(), <span class=\"string\">&quot;导出关键帧&quot;</span>):</span><br><span class=\"line\">                <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> channel.get_num_keys():</span><br><span class=\"line\">                    <span class=\"keyword\">continue</span></span><br><span class=\"line\">                keys = []</span><br><span class=\"line\">                <span class=\"keyword\">for</span> key <span class=\"keyword\">in</span> channel.get_keys():</span><br><span class=\"line\">                    frame_time = key.get_time()</span><br><span class=\"line\">                    frame = frame_time.frame_number.value + frame_time.sub_frame</span><br><span class=\"line\">                    keys.append(&#123;<span class=\"string\">&quot;frame&quot;</span>: frame, <span class=\"string\">&quot;value&quot;</span>: key.get_value()&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">                keys_dict[channel.get_name()] = keys</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># <span class=\"doctag\">NOTE:</span> 导出 json</span></span><br><span class=\"line\">    name = binding.get_parent().get_name()</span><br><span class=\"line\">    export_path = os.path.join(DIR, <span class=\"string\">&quot;&#123;0&#125;.json&quot;</span>.<span class=\"built_in\">format</span>(name))</span><br><span class=\"line\">    <span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(export_path, <span class=\"string\">&quot;w&quot;</span>) <span class=\"keyword\">as</span> wf:</span><br><span class=\"line\">        json.dump(keys_dict, wf, indent=<span class=\"number\">4</span>)</span><br></pre></td></tr></table></figure>\n<h3 id=\"maya导入关键帧json\"><a class=\"anchor\" href=\"#maya导入关键帧json\">#</a> Maya 导入关键帧 json</h3>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> json</span><br><span class=\"line\"><span class=\"keyword\">import</span> os</span><br><span class=\"line\"><span class=\"comment\">#import traceback</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># Import third-party modules</span></span><br><span class=\"line\"><span class=\"comment\">#import pymel.core as pm</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#DIR = os.path.dirname(os.path.abspath(__file__))</span></span><br><span class=\"line\">json_path=<span class=\"string\">&quot;Mydata.json&quot;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#先选中控制器,清空所有关键帧</span></span><br><span class=\"line\">key_list= cmds.ls(selection=<span class=\"literal\">True</span>)</span><br><span class=\"line\">cmds.cutKey(key_list,s=<span class=\"literal\">True</span>)  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># <span class=\"doctag\">NOTE:</span> 读取数据</span></span><br><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(json_path, <span class=\"string\">&quot;r&quot;</span>) <span class=\"keyword\">as</span> rf:</span><br><span class=\"line\">    data = json.load(rf)</span><br><span class=\"line\">attr_map = &#123;<span class=\"string\">&quot;location&quot;</span>: <span class=\"string\">&quot;t&quot;</span>, <span class=\"string\">&quot;rotation&quot;</span>: <span class=\"string\">&quot;r&quot;</span>,<span class=\"string\">&quot;Scale&quot;</span>:<span class=\"string\">&quot;&quot;</span>&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># <span class=\"doctag\">NOTE:</span> undo 支持</span></span><br><span class=\"line\">pm.undoInfo(ock=<span class=\"number\">1</span>)</span><br><span class=\"line\"><span class=\"keyword\">for</span> channel, frame_list <span class=\"keyword\">in</span> data.items():</span><br><span class=\"line\">    <span class=\"comment\">#print(channel)</span></span><br><span class=\"line\">    <span class=\"comment\"># <span class=\"doctag\">NOTE:</span> 解析 channel_name</span></span><br><span class=\"line\">    if_set=<span class=\"literal\">True</span> </span><br><span class=\"line\">    has_attr = channel.count(<span class=\"string\">&quot;.&quot;</span>)</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> has_attr:</span><br><span class=\"line\">        <span class=\"comment\"># <span class=\"doctag\">NOTE:</span> 处理 `CTRL_C_eye_parallelLook_4311` 格式</span></span><br><span class=\"line\">        ctrl_name = channel.rsplit(<span class=\"string\">&quot;_&quot;</span>, <span class=\"number\">1</span>)[<span class=\"number\">0</span>]</span><br><span class=\"line\">        attr = <span class=\"string\">&quot;ty&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">else</span>:</span><br><span class=\"line\">        parts = <span class=\"built_in\">iter</span>(channel.split(<span class=\"string\">&quot;.&quot;</span>))</span><br><span class=\"line\">        ctrl_name = <span class=\"built_in\">next</span>(parts, <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">        param = <span class=\"built_in\">next</span>(parts, <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">        axis = <span class=\"built_in\">next</span>(parts, <span class=\"string\">&quot;&quot;</span>)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> axis:</span><br><span class=\"line\">            <span class=\"comment\"># <span class=\"doctag\">NOTE:</span> 处理 `CTRL_C_teethD.Y_4330` 格式</span></span><br><span class=\"line\">            attr = <span class=\"string\">&quot;t&quot;</span></span><br><span class=\"line\">            axis = param</span><br><span class=\"line\">        <span class=\"keyword\">else</span>:</span><br><span class=\"line\">            if_set=<span class=\"literal\">False</span> <span class=\"comment\">#`CTRL_L_eyeAim.Rotation.Y_4387` 格式都不保存</span></span><br><span class=\"line\"><span class=\"comment\"># =============================================================================</span></span><br><span class=\"line\"><span class=\"comment\">#             # <span class=\"doctag\">NOTE:</span> 处理 `CTRL_L_eyeAim.Rotation.Y_4387` 格式</span></span><br><span class=\"line\"><span class=\"comment\">#             attr = attr_map.get(param.lower())</span></span><br><span class=\"line\"><span class=\"comment\">#             if_set=False if param.lower()==&#x27;scale&#x27; else True</span></span><br><span class=\"line\"><span class=\"comment\"># =============================================================================        </span></span><br><span class=\"line\">        <span class=\"keyword\">if</span> if_set:</span><br><span class=\"line\">            attr += axis.split(<span class=\"string\">&quot;_&quot;</span>)[<span class=\"number\">0</span>].lower()         </span><br><span class=\"line\">    <span class=\"comment\"># <span class=\"doctag\">NOTE:</span> 解析出控制器属性设置关键帧</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> if_set:</span><br><span class=\"line\">        attribute = pm.PyNode(<span class=\"string\">&quot;.&quot;</span>.join([ctrl_name, attr]))</span><br><span class=\"line\">        <span class=\"keyword\">for</span> frame_data <span class=\"keyword\">in</span> frame_list:</span><br><span class=\"line\">            frame = frame_data.get(<span class=\"string\">&quot;frame&quot;</span>)</span><br><span class=\"line\">            value = frame_data.get(<span class=\"string\">&quot;value&quot;</span>)</span><br><span class=\"line\">            attribute.setKey(t=frame, v=value)</span><br><span class=\"line\">pm.undoInfo(cck=<span class=\"number\">1</span>)</span><br></pre></td></tr></table></figure>\n",
            "tags": []
        },
        {
            "id": "http://yjfyqfzs.github.io/2023/01/18/ueplug/",
            "url": "http://yjfyqfzs.github.io/2023/01/18/ueplug/",
            "title": "ue插件",
            "date_published": "2023-01-18T02:33:40.000Z",
            "content_html": "<p>在项目开发过程中，有时需要为他人的纯蓝图工程提供 C++ 开发的模块，此时通过 UE 的 Plugins 实现。</p>\n<p>新建 UE C<ins> 工程，在 C</ins> 工程中新建插件，将编译后的插件拷贝至蓝图工程，即可在蓝图工程中使用 C++ 编译的模块。</p>\n<h2 id=\"创建蓝图函数库插件\"><a class=\"anchor\" href=\"#创建蓝图函数库插件\">#</a> 创建蓝图函数库插件</h2>\n<p><strong>1. 新建插件</strong><br>\n新建 UE C++ 工程，点击 <code>Settings-Plugins-New plugins</code> ，UE 提供的默认插件如图</p>\n<div align=\"center\"> <img data-src=\"/2023/01/18/ueplug/img1.png\"> </div>\n<p>其中，Editor Toolbar Button，Editor Standalone Window，Editor Mode 均与 UI 界面有关。Third Party Library 中含第三方库引用示例，Blueprint Library 为蓝图函数库插件。选择 Blueprint Library，新建插件。</p>\n<p><strong>2. 插件说明</strong><br>\n UE 中的插件由 <code>uplugin</code>  文件描述，具体如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">\t<span class=\"string\">&quot;FileVersion&quot;</span>: <span class=\"number\">3</span>,</span><br><span class=\"line\">\t<span class=\"string\">&quot;Version&quot;</span>: <span class=\"number\">1</span>,<span class=\"comment\">//版本号</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;VersionName&quot;</span>: <span class=\"string\">&quot;1.0&quot;</span>,<span class=\"comment\">//版本名</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;FriendlyName&quot;</span>: <span class=\"string\">&quot;XXX&quot;</span>,<span class=\"comment\">//插件名</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;Description&quot;</span>: <span class=\"string\">&quot;&quot;</span>,<span class=\"comment\">//插件描述</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;Category&quot;</span>: <span class=\"string\">&quot;Other&quot;</span>,</span><br><span class=\"line\">\t<span class=\"string\">&quot;CreatedBy&quot;</span>: <span class=\"string\">&quot;author&quot;</span>,<span class=\"comment\">//插件作者</span></span><br><span class=\"line\">\t<span class=\"string\">&quot;CreatedByURL&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t<span class=\"string\">&quot;DocsURL&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t<span class=\"string\">&quot;MarketplaceURL&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t<span class=\"string\">&quot;SupportURL&quot;</span>: <span class=\"string\">&quot;&quot;</span>,</span><br><span class=\"line\">\t<span class=\"string\">&quot;CanContainContent&quot;</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">\t<span class=\"string\">&quot;IsBetaVersion&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t<span class=\"string\">&quot;IsExperimentalVersion&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t<span class=\"string\">&quot;Installed&quot;</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t<span class=\"string\">&quot;Modules&quot;</span>: [<span class=\"comment\">//插件包含的模块，新创建的插件会默认包含一个同名的模块</span></span><br><span class=\"line\">\t\t&#123;</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;Name&quot;</span>: <span class=\"string\">&quot;XXX&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;Type&quot;</span>: <span class=\"string\">&quot;Runtime&quot;</span>,</span><br><span class=\"line\">\t\t\t<span class=\"string\">&quot;LoadingPhase&quot;</span>: <span class=\"string\">&quot;PreLoadingScreen&quot;</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t]</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>UE 使用模块 (Modules) 来实现多个类功能的集合，插件可以由一个或多个模块组成。模块的编译过程由 <code>.build.cs</code>  文件设置，模块的一些参数设置如下：<br>\nType 表示模块在什么场景下使用，可选以下参数</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">namespace</span> EHostType</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">enum</span> <span class=\"title class_\">Type</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        Runtime,                    <span class=\"comment\">//运行时，任何情况下</span></span><br><span class=\"line\">        RuntimeNoCommandlet,</span><br><span class=\"line\">        RuntimeAndProgram,</span><br><span class=\"line\">        CookedOnly,</span><br><span class=\"line\">        Developer,                  <span class=\"comment\">//开发时使用的插件</span></span><br><span class=\"line\">        Editor,                     <span class=\"comment\">//编辑器类型插件</span></span><br><span class=\"line\">        EditorNoCommandlet,</span><br><span class=\"line\">        Program,                    </span><br><span class=\"line\">        ServerOnly,</span><br><span class=\"line\">        ClientOnly,</span><br><span class=\"line\">        Max</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>LoadingPhase 为模块加载的阶段，可选以下参数</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">namespace</span> ELoadingPhase</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"keyword\">enum</span> <span class=\"title class_\">Type</span></span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        PostConfigInit,             <span class=\"comment\">//引擎完全加载前，配置文件加载后。适用于较底层的模块。</span></span><br><span class=\"line\">        PreEarlyLoadingScreen,      <span class=\"comment\">//在UObject加载前，用于补丁系统</span></span><br><span class=\"line\">        PreLoadingScreen,           <span class=\"comment\">//在引擎模块完全加载和加载页面之前</span></span><br><span class=\"line\">        PreDefault,                 <span class=\"comment\">//默认模块加载之前阶段</span></span><br><span class=\"line\">        Default,                    <span class=\"comment\">//默认加载阶段，在引擎初始化时，游戏模块加载之后</span></span><br><span class=\"line\">        PostDefault,                <span class=\"comment\">//默认加载阶段之后加载</span></span><br><span class=\"line\">        PostEngineInit,             <span class=\"comment\">//引擎初始化后</span></span><br><span class=\"line\">        None,                       <span class=\"comment\">//不自动加载模块</span></span><br><span class=\"line\">        Max</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong>3. 函数设置</strong><br>\n打开 sln 文件，XXX.h 和 XXX.cpp 中声明和定义了模块启动和关闭调用函数，自定义的函数放在 XXXBPLibrary.h 和 XXXBPLibrary.cpp 中</p>\n<p>UE 在标准 C++ 的基础上自定义了一套编译体系，类在定义时需要添加相应的前缀</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">U--UObject派生类</span><br><span class=\"line\">A--AActor派生类</span><br><span class=\"line\">F--FString，FName等大多数类别</span><br><span class=\"line\">E--Enums</span><br><span class=\"line\">I--抽象接口Interfaces</span><br></pre></td></tr></table></figure>\n<p>暴露 C++ 类至蓝图可参考此文章：<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vS2lsbGVyQWVyeS9wLzEyMDI2Mzk1Lmh0bWw=\">暴露 C++ 至蓝图接口</span><br>\n头文件中函数声明为</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//设置为能在蓝图中调用,DisplayName为蓝图中显示框上的文字</span></span><br><span class=\"line\"><span class=\"built_in\">UFUNCTION</span>(BlueprintCallable, meta = (DisplayName = <span class=\"string\">&quot;MyFunc&quot;</span>, Keywords = <span class=\"string\">&quot;XXX&quot;</span>), Category = <span class=\"string\">&quot;MyFuncTesting&quot;</span>)</span><br><span class=\"line\"><span class=\"function\"><span class=\"type\">static</span> <span class=\"type\">float</span> <span class=\"title\">MyFunction</span><span class=\"params\">(<span class=\"type\">float</span> Param)</span></span>;</span><br></pre></td></tr></table></figure>\n<p>cpp 文件中函数定义示例如下</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"type\">static</span> <span class=\"type\">float</span> <span class=\"title\">UXXXBPLibrary::MyFunction</span><span class=\"params\">(<span class=\"type\">float</span> Param)</span></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">    <span class=\"type\">float</span> value;</span><br><span class=\"line\">    <span class=\"comment\">//补充计算过程</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> value;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"创建第三方库引用插件\"><a class=\"anchor\" href=\"#创建第三方库引用插件\">#</a> 创建第三方库引用插件</h2>\n<p>在插件中引用第三方库，主要需要设置静态 / 动态库和头文件。在 UE 中， <code>.lib</code>  静态库和 <code>include</code>  中的头文件在 <code>build.cs</code>  中设置， <code>.dll</code>  动态库在插件代码中通过函数句柄来设置。具体设置方式如下：</p>\n<p>新建 UE 提供的第三方库引用插件 <code>MyPlug</code> ，在 <code>.../Source/ThirdParty</code>  路径下新建文件夹 <code>My3Party</code> ，将第三方库相关文件夹（ <code>include</code> ， <code>lib</code>  等）放在该文件夹中，新建 <code>My3Party.build.cs</code>  文件，示例如下：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">using</span> UnrealBuildTool;</span><br><span class=\"line\"><span class=\"keyword\">using</span> System.IO;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"keyword\">class</span> <span class=\"title class_\">My3Party</span> : ModuleRules</span><br><span class=\"line\">&#123;</span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">public</span> <span class=\"title\">My3Party</span><span class=\"params\">(ReadOnlyTargetRules Target)</span> : base(Target)</span></span><br><span class=\"line\"><span class=\"function\">    &#123;</span></span><br><span class=\"line\">        Type = ModuleType.External;<span class=\"comment\">//作为外部依赖,不参与编译！！！</span></span><br><span class=\"line\">        <span class=\"comment\">//库文件路径</span></span><br><span class=\"line\">        PublicSystemLibraryPaths.<span class=\"built_in\">Add</span>(Path.<span class=\"built_in\">Combine</span>(ModuleDirectory, <span class=\"string\">&quot;lib&quot;</span>));</span><br><span class=\"line\">        <span class=\"comment\">//头文件路径</span></span><br><span class=\"line\">        PublicIncludePaths.<span class=\"built_in\">Add</span>(Path.<span class=\"built_in\">Combine</span>(ModuleDirectory, <span class=\"string\">&quot;include&quot;</span>));</span><br><span class=\"line\">        <span class=\"comment\">//添加静态库</span></span><br><span class=\"line\">        PublicSystemLibraries.<span class=\"built_in\">Add</span>(Path.<span class=\"built_in\">Combine</span>(ModuleDirectory, <span class=\"string\">&quot;lib&quot;</span>, <span class=\"string\">&quot;XXX.lib&quot;</span>));</span><br><span class=\"line\">       <span class=\"comment\">//加入动态库</span></span><br><span class=\"line\">        RuntimeDependencies.<span class=\"built_in\">Add</span>(Path.<span class=\"built_in\">Combine</span>(ModuleDirectory, <span class=\"string\">&quot;lib&quot;</span>, <span class=\"string\">&quot;XXX.dll&quot;</span>));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>在 <code>MyPlug.h</code>  中设置句柄，注意，有几个 <code>.dll</code>  文件就设置几个句柄函数。</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">private</span>:</span><br><span class=\"line\">\t<span class=\"type\">void</span>* ExampleFunHandle;</span><br></pre></td></tr></table></figure>\n<p>在 <code>MyPlug.cpp</code>  中定义 <code>StartupModule</code>  和 <code>ShutdownModule</code> ， <code>StartupModule</code>  中，首先获取该插件的路径：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FString BaseDir = IPluginManager::<span class=\"built_in\">Get</span>().<span class=\"built_in\">FindPlugin</span>(<span class=\"string\">&quot;MyPlug&quot;</span>)-&gt;<span class=\"built_in\">GetBaseDir</span>();</span><br></pre></td></tr></table></figure>\n<p>对于每个 <code>.dll</code>  文件，都有以下语句：<br>\n <code>StartupModule</code>  函数中：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FString LibraryPath;</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">if</span> PLATFORM_WINDOWS</span></span><br><span class=\"line\">\tLibraryPath = FPaths::<span class=\"built_in\">Combine</span>(*BaseDir, <span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;Binaries/ThirdParty/My3Party/Win64/XXX.dll&quot;</span>));</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">elif</span> PLATFORM_MAC</span></span><br><span class=\"line\">    LibraryPath = FPaths::<span class=\"built_in\">Combine</span>(*BaseDir, <span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;Source/ThirdParty/My3Party/Mac/Release/XXX.dylib&quot;</span>));</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">elif</span> PLATFORM_LINUX</span></span><br><span class=\"line\">\tLibraryPath = FPaths::<span class=\"built_in\">Combine</span>(*BaseDir, <span class=\"built_in\">TEXT</span>(<span class=\"string\">&quot;Binaries/ThirdParty/My3Party/Linux/x86_64-unknown-linux-gnu/XXX.so&quot;</span>));</span><br><span class=\"line\"><span class=\"meta\">#<span class=\"keyword\">endif</span> <span class=\"comment\">// PLATFORM_WINDOWS</span></span></span><br><span class=\"line\"></span><br><span class=\"line\">\tExampleFunHandle = !LibraryPath.<span class=\"built_in\">IsEmpty</span>() ? FPlatformProcess::<span class=\"built_in\">GetDllHandle</span>(*LibraryPath) : <span class=\"literal\">nullptr</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">\t<span class=\"keyword\">if</span> (ExampleFunHandle)</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">// Call the test function in the third party library that opens a message box</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//ExampleLibraryFunction();</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t<span class=\"keyword\">else</span></span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\tFMessageDialog::<span class=\"built_in\">Open</span>(EAppMsgType::Ok, <span class=\"built_in\">LOCTEXT</span>(<span class=\"string\">&quot;ThirdPartyLibraryError&quot;</span>, <span class=\"string\">&quot;XXXX.dll&quot;</span>));</span><br><span class=\"line\">\t&#125;</span><br></pre></td></tr></table></figure>\n<p><code>ShutdownModule</code>  函数中：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">FPlatformProcess::<span class=\"built_in\">FreeDllHandle</span>(ExampleFunHandle);</span><br><span class=\"line\">ExampleFunHandle = <span class=\"literal\">nullptr</span>;</span><br></pre></td></tr></table></figure>\n<p>将 <code>.dll</code>  文件拷贝至 <code>LibraryPath</code>  对应的路径。在 <code>MyPlug.build.cs</code>  中添加第三方模块和 <code>Projects</code> ：</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">PublicDependencyModuleNames.<span class=\"built_in\">AddRange</span>(</span><br><span class=\"line\">\t<span class=\"keyword\">new</span> string[]</span><br><span class=\"line\">\t&#123;</span><br><span class=\"line\">\t\t<span class=\"string\">&quot;Core&quot;</span>,</span><br><span class=\"line\">\t\t<span class=\"string\">&quot;My3Party&quot;</span>,</span><br><span class=\"line\">\t\t<span class=\"string\">&quot;Projects&quot;</span>,</span><br><span class=\"line\">\t\t<span class=\"comment\">// ... add other public dependencies that you statically link with here ...</span></span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">\t);</span><br></pre></td></tr></table></figure>\n<p>编译运行，即可使用第三方模块。</p>\n",
            "tags": []
        },
        {
            "id": "http://yjfyqfzs.github.io/2023/01/05/GithubHexo/",
            "url": "http://yjfyqfzs.github.io/2023/01/05/GithubHexo/",
            "title": "Hexo+Github博客搭建",
            "date_published": "2023-01-05T03:03:28.000Z",
            "content_html": "<p><strong>配置 Github</strong><br>\n 注册 Github 账号，新建 New repository，命名为 <code>http://用户名.github.io</code></p>\n<p>安装 Git，运行 Git Bash，设置用户名和邮箱</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git config --global user.name <span class=\"string\">&quot;你的GitHub用户名&quot;</span></span><br><span class=\"line\">git config --global user.email <span class=\"string\">&quot;你的GitHub注册邮箱&quot;</span></span><br></pre></td></tr></table></figure>\n<p>生成 ssh 密钥文件</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ssh-keygen -t rsa -C <span class=\"string\">&quot;你的GitHub注册邮箱&quot;</span></span><br></pre></td></tr></table></figure>\n<p>在 <code>C:/用户/你的用户名/.ssh</code>  中会生成两个文件 <code>id_rsa</code>  和 <code>id_rsa.pub</code> ，用记事本打开 <code>id_rsa.pub</code> ，将内容复制到 Github 新建的 SSH key。</p>\n<p><strong>Hexo 配置</strong><br>\n安装 Node.js，随后在 cmd 中运行 <code>npm install -g hexo-cli</code> ，即可安装 Hexo。</p>\n<p>在 Git bash 中运行 <code>hexo init MyHexo</code>  初始化博客。</p>\n<p>在 <code>MyHexo</code>  文件夹运行以下命令</p>\n<figure class=\"highlight c++\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo <span class=\"keyword\">new</span> <span class=\"string\">&quot;标题&quot;</span><span class=\"comment\">//新建文章</span></span><br><span class=\"line\">hexo g <span class=\"comment\">//生成网页</span></span><br><span class=\"line\">hexo s<span class=\"comment\">//启动服务预览，在本地浏览器输入localhost:4000预览</span></span><br></pre></td></tr></table></figure>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9oZXhvLmlvL3RoZW1lcy9pbmRleC5odG1s\">hexo 模板</span>中可以挑选主题模板，按说明配置</p>\n<p><code>npm list --depth 0</code>  可查看已经安装的包</p>\n<p><strong>部署到 Github</strong><br>\n 安装插件 <code>npm install hexo-deployer-git --save </code> <br>\n修改 <code>_config.yml</code></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">deploy:</span><br><span class=\"line\">  type: git</span><br><span class=\"line\">  repo: git@github.com:XXX/XXX.github.io.git</span><br><span class=\"line\">  branch: main</span><br></pre></td></tr></table></figure>\n<p>Git Bash 运行以下命令</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hexo clean</span><br><span class=\"line\">hexo g\t<span class=\"comment\"># 生成静态文件</span></span><br><span class=\"line\">hexo d\t<span class=\"comment\"># 部署代码到GitHub上，之后会跳出github授权的框</span></span><br></pre></td></tr></table></figure>\n<p><strong>解决本地预览图片不显示问题</strong><br>\n打开 <code>MyHexo</code>  文件夹的 <code>_config.yml</code>  文件，将 <code>post_asset_folder</code>  的值修改为 <code>true</code></p>\n<p>在 Git bash 中运行 <code>npm install hexo-asset-image --save</code></p>\n<p>此时新建文章后， <code>source/_posts/</code>  中会生成与 md 文件同名的文件夹，将图片放在该文件夹即可</p>\n<p>如果仍然不显示图片，根据错误提示修改 <code>/node_modules/hexo-asset-image</code>  里的 <code>index.js</code>  文件。</p>\n<p><strong>给文章添加密码</strong><br>\n安装插件 <code>npm install --save hexo-blog-encrypt</code> <br>\n 添加密码时在文章信息头部添加 <code>password</code>  即可</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">---</span><br><span class=\"line\">title: Hello</span><br><span class=\"line\">date: 2023-01-10 10:43:03</span><br><span class=\"line\">password: XXX</span><br><span class=\"line\">tags: </span><br><span class=\"line\">---</span><br></pre></td></tr></table></figure>",
            "tags": []
        },
        {
            "id": "http://yjfyqfzs.github.io/2022/12/15/MayaApi/",
            "url": "http://yjfyqfzs.github.io/2022/12/15/MayaApi/",
            "title": "Maya Api笔记",
            "date_published": "2022-12-15T03:00:14.000Z",
            "content_html": "<div class=\"hbe hbe-container\" id=\"hexo-blog-encrypt\" data-wpm=\"Oh, this is an invalid password. Check and try again, please.\" data-whm=\"OOPS, these decrypted content may changed, but you can still have a look.\">\n  <script id=\"hbeData\" type=\"hbeData\" data-hmacdigest=\"f1378580f4f4c2cd210f840747995cab969ab8742bc61feecf6426cc791635cb\">b4402e99068bc1cbc9e962a428aafa583b2d31ae75d22e681410d89f5e97e86090bac275d3c9446e95e76fc2849c326392e603d3f1e19cdc2eacf4712788a800480265e762facf896570d8fc0f23e9c8581f2063e6978242ddc0b0594ffbc408cc62660b5d1a4fbf3e8d394fbd641c25d6914b23e4cc547be551de28ac9eba103345824e42adfcb0a9a77fa06d6c6a397e6aa33ba1a1da31d8670c6d4cdabe6b88cc837f2d29304a132e07595142b7debed51c53bf6d5ad6a614064e16c8faf5a35dcb98ddabf9bda40dd355429559b97acf8540e91c92fa143700ca4ef9eed50dff8be603a57ed226c3a4f07bfa59e59e0c3156637b2cd48d5a4bd8927c707bd1a86d60d7cbd00052d0e62d792a1c6ce737c3d4835f0f499c4fdf20d584f7b00641d4142438368f6f55f9478ee1eb4dc8e9541c5c55b85e960645d6bee3de8dd423fab126341ed978ee9f9e2fa59d197dec018e295f1c132e54fde2a62b0beef8b3d9161fb70c6cae76bc38ad87289da90d4ad6c87ac5e7eac640c968ce2a3650f9e631679edcdfc46b506794687811e66ef514c8c7e0f2320f4e16bb77506a4f78bba16f3ef8bc075c5a88d2a7bcb24ccef8da427d7c749af68737dec3347e7134996274a689c465daf4e5ed6f683b825dfb568536f88a13d635fa57ee47a94536e9bfaf01e62011fa45a4011803f6ead5986e6ca35579d0b11f2e017cd172bdeb67b3fd069a8c7c1b4b7601fa7b0c9a2766bda4797de5afe8000e76e0ae362d871e520284add9adf94aa82f2583ee9d3d1cbef560c7dfebbe0171eff9ad161c9617dc96a45f85d227d40f9df48579c56d5769ff5a447a5a6fd4f2b49109ad51eac49537b74765bc2e5fe1721e7b4d148fadfa6653840bcfb2b21c10d4bd8c6f988fbb99ca590699dd0d8169f9b93f709fb520f4ec9999b12bdf43b2e4c21b60315565408f4b56d4dae635529d42877d508fac8d49a49265cc0647e34a7588e0daae0630b5321b3fe5c07c60ecd84ecb4d42304e1c9d32c49f3642c6ea27081d65a6573a0fd5cb675a23320f423bee628622c8bb42e160b7940790428ca3e7f4dd89152239959a2750d1b685aa41292c26d1778834eac51c643441256af8a8debc207d4d50dfa35aab877d08ded915fecf46003ccfd52d1fb06eb70d16c443c6fd0bfe6cc3756d93dd9ea15bb3448d91de35bb5b15de435697b0ff535ff6ae2a55cad3ab27656d1544bb5ebdf6d27ef5f98d466bbb1eee4221dc312ee3a8bb0968b0ae41b2b33701a4a40601a604ba8e7be49252188f3005274347ddc7a851149a431927d78879753cec542947de1fba34b47e55a5bcf373f2d2269099157dd15966c276e19c3e59077d00864f0b36782ac4800bdec83ca3d328f267676215933bf6fbe93a704043bb2ae10a17b910cc7d4a17fbc55dcb3e51fec6501a3fb27a669109d395ffa594715b5c75143004650b5aa888339f87309e847b14707ed1c4ca6a87a4642963878340ac671445ace148d8e79d0736ff69f6aaea57e9de9017516e84eec6203691d9cb5db179f16b0ff4eb9ee20f43c5e5476a40a07785f14086d71b2395b897548f490c168afb400afdb875c8c41cb171b23df78e8093772084535e44c6461b32724bd2c641226a4696d36ee94c588300b829724eee75dd25d4b74ce55c48abfb70f1ff4efa5d349d7cf8f6974af0eba92f69e5753be2dc7703a88d9bc8b6dbb8942f1ed59d6349ca10b266ab593472026f4d6374cf4bb57b8804757b8a90fa6ddf7032f4481badc6d5acad1ac151219bd6425abae90345eccf01796aeae285ffc2169cfd2f6bd24d916282aac2b9689dd64f403cce31917b92b57e8e60b465bf6f19232e58c7ee9f81024684e3af0a521bda6e89731fd80c4d62c7489950de9d53a91b33120371b0690ca47c7cbdf9eabee90edfac792ceeb6de6305e93caf5ac4efa6cc83cf653df98652ae70c5c702e659393354716e51aa6a129f7a871c0c2f8ebe1480aacd4019fe136a05959c2e2a26e1c559487aaf039eb8a485c86c7469dc8fc431d3fa2c465c07e2ac952128bfe9c9e2520e8a68d5a2576b7ddb06f775ea3bb6134fb158a6dee9d8d20134a99f6af996a65c0ca76f2b584c0aabd558e5cde6200b46995116a610a34938f2a14f1be05860e14bc8f577d6da914f149f65bbc325a0b9ab57ae3583c7a2708e1e41080450138bdaa01bbb45b8a2e737f98ba6883171ceda163d451f8bd519cb31ddf876c22f6316b700c831f560612cecea3e6d78354b97e93f472c213fd9de4ea45f3e83c1a2071a6467e6b41f472a5351ca4cabdb92815f1c453c27b891ee18fcdd0db4e1592a60bc4dc05343dd2048ce29946985b086dfe1d5b18b971937a74a930c5726b312d1d5e9313daa910b0568cd6c5bd0201862bbd185668e72e62d2cefa563788940a8f79eaf0ed6dd0436e47dbb51e967ebe5cd1e42ff3bea994d73d4acbbaed2b37d8826decb76bfc6f38950f145ef284cc0df58074fdce47e7f872ccc0b2220ba7350ddb16712993e37047cda9e0e30befe3a7a9bbe79afe04daa55b6622997d65082726d59894638f3f0d102bc5a9e40b156e8265aad87ab976abdf87ab1b395f5fa700420322ac16a8b9fe89348a623b4167d2ae2d718018f87daed38a40f80aebc524169841ce7ec188321040e02023e74616bbd3b3e697c140a223822a9a9a571eb3d2fee3d3348fec00d5c49b6a668db921b3d5e5c26ac62fdc1764b6eed1e854ab6d9b68f58424fd0c477f614e9baf2c213ae9715bfc6067fa970e0be8f87764584790a9fc1813a8cdbc44a98fc78da67855d1e46c77a6a3b8bebc694560031995e933d3ac80b6e44d50b12df603e3821285044db383fd74086da257283ac979a78a213c18cd0c2c3402f508f6d62c71a8213c5fee9e2a4ca45f08b2e4f9b5161761b93e74a206024bdd51ad980046f940b4664d89be86957fd06e6ba5f83c6a9a0e7b5185c54c41655ec57e3e572228bffadb8fb831c3de5ba569de2184c8044bd365014ee268f751b7f0fed664158752a3d0796d792a09c84c2b2f3e27e339684b7ec165184be019a94f7febfa5ff39e738fdcf5b5479c6bcbe4a6674aea77d722bb64e502204bae8353c1af89ad08e4e86b15a94a7b853c0c59d5bca1bcc7cff29ed4a6bd3475a65801e42e75c07c83858d558ad6558d2da99a2a1796b9ca28d26109367c1680678a6489f9630a2b8a52d5f98187398bf7c9745f1022639cb5ffa7ecc071205f3526d1e7ba4c12dc0f66bfd3e1e83650b808fe78e77556376efeeaeaca5ced10911ccab2cff7c613cc3ac221c8847577734bedb7f801b6ed86dcc9843e9d4e327bdc957a7d8413491d20b20f49f1836f0b7a3d714aa5787368d20e0e4058fbbec446ea5c09e3ffe675ced14236cb5022b09f02392a36ad20cfc4f3b56ee58166ffa5fc4e16b04bc094c8355da6e790d7acf60e247f897dbc55b64eee4a68fcb866f6e82970a2cf7d071e1f10cfd0de661b7a15277551ef5a5292eb948538837b6b6129a358fcebdf4bbb401bf56a7ad785d0419abbf318065ebe6987931778eaff5c4e8df439526b06b4e33bf8907a94944ab6e2061404c694451dcb6dcdc173695b9d64386b9b22a2e5c72afe1a676ce31e1326709a4b8a6813bd1426700bbea0ef306a8bb2cc1a2affdff8c6b567798b1c260a579a50eccb3ae1de2db5a020be5dce46b686bd47dda1ea1694a12938f96f3ef551b70565408b9bcc05bd88588cb499e86a095a1696b08c24aed868c4f1b5bc0067ea56bce2abc271dd49d3fc18e5464807d241b8aa15f6a85bafcafd626b80ec1a4a15c447acb2ed951019611f58e88759a0ed85c235971f885c8d4da15b9cfa5db28075f875f1f8f4f166e9b208009cc4674860ea35811e5792b7ee4a995ccb6e1deb9d2e59dee49c8588cc73b1f659f45fb56b43c7167d1f310c54fe2e7df61205510774d47aa0c4b400bad51fb14568bb9e0cea70620c508276da97b2daa5e9331b8de3a760d2314a523a5ecf0da24ef14530d84404d24dd711f2b238e81866e0130a095b86456a099acf59f68292ecf9612d5eb47a22f784ee8ec9834a333451a3217acd2993893cf52ef09cf934dc005286733e674038e81ef71828077cafa2b2d4fc23ba058443ae1197b396bb499a528d5f2ee11f21c7fba8f649509053de8ae92400237ee14e5423f9a17ac37ade93b6558c5c676dffe6af57206c1a759fa4da5ebf50bfe9f14dc17e0c742208ac60c398f22c08f461a04f6398fb8f45c77637f1d0c1865fb123aefb51923f738ad5a9b07a855c985dbeaa11d872843260c083564b8c97e6f4fd35a20590e20567bc7254be03cbb14d8e5d418ffc99f115d8b17fc1d97053d1a8578fc443f648d969bece67222de8a8dacbdd4f863560c22e4fec1d9d6ce2a476b12c15055fb694bee1117f19571bce1678493822e4e78a94f84bcf1f1caeada709fb375f10ba7f5302d4a27297610e995a0a8f1af09969aa2a4ec4c685671d57a896749253f5076b6cab18eebf9fc788b3a9e3a50c2684fdc00093ecd07fa56f10622a53124bd85b83b259cd051c6bab89fca2abafb752b4a8079246a497f8e055d340b650043f36fab85f452122119e34732f462cc5af9d3b910b0bfced61e7ec29a33ab729be20c56639a9fe1a06ca9b2f46bba84056c558d606afa722b60ee4f3c0f9d00ab71f3407a09e334c2e4b5caf074896d7be0410dda0a78707b569d5ea930bcbed7f42e9a6fbb2a49298cf70645b3cfc9c73c698fc96535e018a64875497612567e843f5e6175727837d4f93b63cad702a1e8644e787430df6583ce079759e9f2f9d5f2229b8ad8cb8a232e7c8a82dd575189fac00ac488f9a6ab302638824152a12278844494694670e335d500101e734e5370422d601880045e61d14d9123ae6274c7b57a3234e4809bb74e5b2e03f681d1f336739f513d602711a43e7672136601a87de7aac18e992cbf854bd3bb3163652b8803dcfc61d876bfeddfb76c676d09fa50de6d80687a50c697a9385931553c1d72f3e6d08ff305afba933af9eae24f55b852b0a436de3eb5fbfdf073a803c716e4163c5a239c0f4ec53c2f1bf5de5179a60cb0243b042e159ecb52dabbed64a2fdc7b305a30256eb46e1c98baa89178d5de0c4be9004b3629bb84925a5402c76d044e3ee4419ce63406a90fbdea6bf17d2b3a91f290fe4dbd49d20a21da418199b531295b7580f9fd722effb7302d1d5eff599e912ac8e37ff512b1537ace45e64586098c1ec1c072ced6272847e8e895089891ff9a9eefc9625e32524f1e355c1f32e906b25527273257e093ba5876a2545b927ba02dbcc2bb2a21d012712e1795d08b186f08d09ced6c9f26d3b9bf99be18acf104f1a863a5f6028c5440619d3347c83c6e118d29fa52bb4c28dbcba119165d518edd040cbbddd66f26926356ad35a1f4578432b1b9cecd6bcb0c6e130c510d6985f14da8f132cbc50b85b752cc7f56b9ef321807961718fbed0e453df608fc25c31a0422b8451645dca2465e3b5346a09c47ff8a55acf5d9fb4d215a03c6a3c6ccf6e96f9236e94ba8971b0aa95f1af7e34c44104e8371629355c079819d22b186773d0914951ed741d7d30bece60ca1a1dd4b012ea7cb738c26c45c8a3013cdf4c1a5c34625ba8c8c26eafb5df5ba352495bbf0d07063c71a935d888a95cab7674cfba6191eb865234471ec510aa1c577d12b4e93ed9256e6a0c1668b0af2fe976041a634a73822ff29ac3602442c6ec6a8dd601a2408b303499aeb6165f3237262d4488fdee7a0af02c6123562fe9488e52203ba261a5b408df90296aba515be822077e1aa3a2365edcb1ea3429d38d84eac8faee485d9c4582c7c6e91856f6a20ef89790d63081ce1a96425e1a54ca323124ce6d65661db4034d46b223934ebccea9af0fa8e0b871854600d4793170b7a97252f8468b1bd077cde397ed847fbf66c9d57330cc5b7ef3e4ff8da4a4403ac2efff204d9a9a611ccd3e82a5de15b9f0133ac371725aea664a044f31be04bb3fd4f8e66e7a2fd6da1d76b0554df6387d1b34e55e7a7b030f7073f91680590e1b7968c370e20c7c482f3b6db32eb0e782caea654c1a85fc9f094950745ab2a3676ae051a24c466bdc1a7023823875cbba5bca4b536cd651ef43762805a7230ef90616878b7936993bc184c641457e10af8134d9fd0d3c9613d7710e60d326514c333b599855614017a6c2224ff050aa5d9f2e4bac12c6b5f7d66e3c523994f5f041430dfe9c8da682602bb2239894b330d8028468a944cc840138df819e57bcb2e2cb7ba932a0f187c027a6ee86c5f69fb1bb7f6f1a17941e2c7bfe4a70abbff89570ac8442238497126258b935355d4e7cfdc0a535070e0c73d594fee2921c7f94b2c0f0c4fcf8a837cea713f6e09d0ce6dd091f837bdd59ab7cc324b37f603fc2367cf6b1fa54f116ce577f1764fafe726fa21528af51eb4979ecb85a030fae5071eb4aef75f76a6d234bba98e83ced06b7a844b767b26f47a8e1230b83167b989328f7ca9719eb418d692ca6c22dd5b0f9474bd85525f7eeec729aa07d0255324834f35244a83f4df23f771d67f424ef6b4dc444588cb284d9dd6035edaeb7c12d7679b9e452cf83b2da708fd1a4b32596f0b9cf8dcac7cb1f7b0f66528e8ecb31f167b016c6ac152a89aeecc93007e6202e830fe091bdbe50bba5b21eda7b8f6fcfc714f17cf3156358265fc648cbff82eaf74318e1ae5a3659006bb753043dc6bf5ca04c8ba1f41c8dda02786aec48640c98b28a605a4a8663363a3b339cb93ece579763e7cbc6f9a105cb7b3985cda3f859f2fb526a7df4b731e2d3499a3577b4aa86897c90ffbc1e0ffb53a4165eac6120ce4651e0bfaa375fe81121bca0f751711c58bd3ef5b69fc9b23f4fb46da1d5aa5feee2fd8339bf41efa8e9079a3bfc320031b2c1ca5969a70f68e0c386a1cddfa0d3dec31258baaf159cb75d8aba7203eb864e811ae2ff7edbed81e9bdc865041a950e5413e3fa75340f73a639f06152f317af552bd7b41bd84b7783ac83276d85db7e9398e7a7e709b9d3067a5ef8e229e75d94804e45e9e5761cbca925a539d849bfd4d13e3879be081eebc8616184de270363f3895a1e270c3bdf5c14be4755fec16e1a984f15dc7b6c8e836cd10247460445f1245890f3f203315f18ddf76e9eebfbe6d95a6498e2d951d8bfdd5a12a4c59dcd68239da489fd7defa8ea7050e53dd25d32a3b925532e9cac2255a4a4d7dd3ffda9d99c5f99b1404b3142a2cc99663bcc90bcadd94d9c2f9672803a0db6e6e62030dad17e220f4e431932055af80cb1679b9250afd273ad3602c8724a89788ffbdfb493c0f1ff3a7aca51002d76319e96a46f4158d8481f6a3dadb4a7b91a7ac7286e80efa8bb3bf9f235789bd11902316be909036ed777a963da5f7f85a3c26e18c703a23d91b7effefae67dfe323603e408d58e6cf2d922d64e1308b056f5c7414e258bfec65dcb824e280248a86a7f9c615a5b7029af31fcd84358bfee82299b5e84472188feceb4b8f834ef30abc182eef12d1837c8db015b1abbe513ecd9d32f1ac5fcfa28183f7909bae18979a821f56177bef991bcc5c4aadf8fb90d63d58fca0cd79100c7b9f15977b8d2069c1a0858cfece45386810c8d2c385abde931fbefbed10562175e96c351abfe4e43b8a4b4ac7636004ca3f32ae11385b752fc3d2126a3ba0977dd652ee03d3e483f2e3a60e601a74913a61577a955f72dbfbbc5be7a8d4697f84a7d296bbd829b1ccc1813c453b4fb98969ff1c032934253f7d920c17b366621ba7ca98d30a168957e96b46a3a45501be29c54093d2d04fc6f1d9cd38ebd8c56695c32ac221820f73001b09f8dd1c9693f3dfedda2c5668623cd081686a7deacacdb782e36dfecea72cc05aa3f509edb639230780a56c480d69f1125e89eecd78b5e8aa1f3a29e641d6aff41e0020fb5525cd555caf79570a2b8b25111cacb3516ec1c48ff91a403b060b3ac31f4a2f6cc6ae639259bf540eb6801792a29a3b492fa915a1c28ce8e7ee0336fd6b3dabb92e624a8c1b2d7a459732a95e221190ca97364389cdcdf765a3eab215a24bc7d71d8d988c349dda36a6ed5e714041700ad6c5ac7060dcc0ace9c3dfad99375794ab0804e216d1cec1250d6bc7a1b60f84c04f760f92152290ba95d4015a071bcae132c4be1eb3a3e7f02a66b34381edd9e604b3762f60bfe54e3bd8ce7efb605c5b989226647e17c2cbb733c3ecd3ad0eb7364647cd6a8edc34e27e4c91b9c716588c9f5312421b2de00b97a2b6a66717d430c37bc69d32d721af382f76ff118aeb051c98593d2ebb5be7c7f17ee8384a25a42ea8b2eac4b32fa9112bb7a1fd443a7f3915e274ddf97d0b91a962ae2e857b7b22183e71843494ee0d58208128e1403d5ea2e1c26f4975bce654697350df2a6b2f9faaac776cf6634fc8cdda970c81034a685b8edd04ca98c71fab0b8d3bdaf176d7a70794adbb0a1edbbee308b45e5f8a5d460db79d29dee11bbb9ffbe40624c5bf1f40e805c273525f555f7520112b2d527abdf0df633130b674a6160f64ac8de13da04085198d1efae2fbc1dcf6c1cce0d7300545fc7a32b63354961aef1c6818ca7337577544ddcf97cce775688cff32cd5c0b3a1ab0ac409514fd82018c195389bf44a1fd653852b536b9003c9e64845c49ca0f2247c220616aaf20d4a00544c629d1919ed17dace8c6916c7b3aa813f3d0296deb89bce734fe781c9fbd2490d1caef4abcdf2e34743157c23e5561463c96672c93a80ba66ef5c7cf0cca459327eba5a69399f9464902a5eb8c8cb4ac71c6fb8802723481420258560503e2325c77cb121ad9462713c7e4147fdaaa9ae13166c5c3dd4ceddc6c4b67946eeeae4da372c1ab6cfc5d370a4f3b2900b028aee9e48b3431706f30562fe65d22045d222943de2ec60bf5d352b32e81cc79335aa066ea08ebe030f664f38d617df0d8f08b3ca0b7f774a043cb44a0d0b59ae6318cc416dd7e9be5abaf84c019fd917f0e8788f070614baec0db73f8dff525ed749f52702d3042c869cd925f4eac0caf0b06a26d57bfa16c61cbc393fd0262580a966b5b0ddd8983bf93066435a7e0e3f3f14a9ced88fc8285d1f545b0104917ba044c065040526a5edb6680d8fb5d0601149769508ace3d449ac77fc75649224a727236156fa7b71336ec78049acd2e8d737a126e43707509fcec9f97d1885dd98293f9fd5be1dbd4fdeb3f99c322912eda8f03535e351d7fe426f48d992fe6a5ab7a74cc7c58a2b99000329d257d2e40043db7c9c91d63b06a9327e79db56db5d50b28c0bfe9ff74bf403c823befe9ad34d2cc8eef99764f41b127a769642acdf712bd647536f5b2e866e4344c077dc53b1031f7fe97f03ac1fa59133ce5945a8eef9653de16dac1d2437e45a8e26472b1251317865f7a8febc92bab31f28a57a7a0db393b67bee9c2143a9e8f41f3213a80a25514ac412b5250d5b5cd9240c521324f7c0415c5d4eab9181bee030201e18f69d7ecfa391530829393bc361d56ff984ca6815ba95dbaf2a682af9fcfa60a8f3d1a582b93ba1f1966a5107571fc3e24ece88fade8f2e66ae57ac924dea53bdd833e47dc535e58cfc35241f7d357d7b901b0dc7409f07bec6dd14e61ebfa5086f28b661558453891e7348281c4dbe2fdd0c6a8646fd2f7d9bd249497d3c96f471a208ddac41abf0d9fea2d11a9968f5a0f6a3e2e7efa0191afc4a25faabd72b258323078271a42881d08f4dede0d8e8281ea3ffb292000b3b8324cab5f76e59ddb2f22686d788a8091e6f3d93bedb7e087589c0c4e2c1d43f3bdcd999409846ec42ecc7a0bc0b918e5d3c056abc3a27793267063bc7d7b0a9a8ccac59f776801bfea428f6f7f8367ad133aff5783b8f6ca59069128a16a0dce67b0a8a5bc14d0032546c85a803f99c38251eef6bd95fd49033585423abef05f64d5e6222a61e6600f771351c228459d083b9bff760cfe225322dc18d057d5fe6ddc0f5ccd371fab4fdf55e37e7840faee26b575671102d57833b68ee3961c0579d67d8105f7c548724d9e6f9e08ec8e4c286a66e6f13e6e2dfbaffa180b50f2195395d7414fe9f0d1016e730926a5ae73c49ab78a86b0fe30631e0c7af697d3e45a00fb0818aa6d0b32ab733a2438d72d7e57d9407ccfcc44ffb7e91b4f43ee98cc260e6c1053b8228871fcccd99e23690c82513614a0a53377cee03c0741ec8e897f0d862803d0d426eed75635bdd03e78c789768e846e071c41636c1040dcd55a213d9670183f7f8ea3993cafaf87afa0010b3d84083050e7f09a3f34cf71d57f3e70cb7e0a9bb4e53acf7a515081f4d63ce1a3c3c54c1162d9de4841d487b3925ae588ec2c31050505e7477e93afda3fc3c59d1ae6691d9bd52e65448109d079d60c3e98b97758b8dd2852a352e2d2b402071434da65258e54344495e20e67603fb3d89782725a710cd3366c5222f0e98ce5d590757cb98773e551cf346ee490823edc402466eb7e1351ef35b7f6568a4f07c74219d2dfb017264d9849688aa52dcef4fafb2de79cee2ef34c9cac3e2b9e2e24714ef327f4486ba6beeb3667aa7fdf4e82e5c0efa685366b14948eb0183104e4803569e51a01a0dc9fb4e7d754705201cb514d0819cc796bbf00cb46c0fe600d7ac7a89d06017cc2178488be57bf4eb477bc668e2c3f55f9030777f48fe8788ee5fac40066237912ce01a0043d113d621a61a758a994fb0a56c0820c4292c52bfebb7bf4e9780817ebc04d37bd336bc49a9ddef471eb910c111d93dd735eaa62b3cde0b9fce325d9070d3665c6502c0c7af0f87f1be1bfaaf963f8be20a8bfc7400a71c9a23a5f08bb1df43f1d091fdb0056069f82124bfe80c8b3b59ca6f4962163f58615f715eaf257a8fc837357826ee3779e1d81fd450d08d0ea91f946bc17b5442bb72d06bdda894f5db62316d8d8d397d5be853751899898f7914cd402a28b40f5f8cb3f8b47ac95280037aafa35e8b784548a2b5d9ebbdf79a51946334e9948a050b83802f2c286fc3b42d3a7944fc397c2e41dd0503aa330a101de6d4565c0dda03e54a03cb851000e807c01c353c16bd0c8c9c89eead89e45c5c314097b085af38191d9d345e6beee28097aac7342c4407c4c2968e8d54d9cb4b0c31b13d94bd4dd2d8d1ac04efafea9c73d571f1a02b9673ef30e13848db28a24198313b9ec72e9b07b00fc4ff405d3b3021a5f9b09f057e26db9f112849124b7d16347686ea47242eb72353c77f029f1b5188589be427011efa3b038011c52cb589c54151b4a1e97ac7cd97c3e13f0b2e956799170149da7f625d3375e10d72948700ed0cb8fa15438d6cc730bb14f678dee0179d4c8b175dba82481e602925cf8ef1b05728d8970221347c1e173ae5949e428ce1f75537642420403ff49bb80a44ebf612c2c15b7da72611d5c9a369c1cbfac202241e8b617c563472b8595e8d97d41f63e98a148f09e6fcc549c25be8f2a1e9873ac5fdf161fd1c6d676b06f4b893d312bb9221314ccc10a302b527e0c934f40febcef7888df74beffbe9143885ed2228a66b69e8dfb9b8cdefd04e64800c15e0b62437919c3872b867ea59061a86dff16cb31384763289fd042cc61679aff61c6858ab4b7835c0394c874875c7a79c73ee1b507e51d6b4a9bac1f941b2db81bdfaf292e562c487829a86ba058f26edc60a245122bd2850ccee00c0565a984799dc8d0046669bc6d2d480e811ac88617aaa6470ed8723285f34a067eff7e76fa13bf4f205b0dbaa6611bbc7638a15263cee6a9a178edaf1dc11079e4e6314ad9242575e81d721cdc474a36b25405b30dd24ca85439a87b573a8af9b0497b0c549170668fdac428a54221e2b222efa9a5601f3511366a8adcb472c6c90a23ea203ac817e73936c9138c875ca711daf1ff03395378f5e91c32b52e8f805bac3204e4a01eafb94a45efefe64aeb1c83fe8b0fe8b80decc9997318055f8b8a85369fce9186f5d09b69e6ccd81142feac8381d271ed3cf7df7c2be4b27601a5e660f84e6ca2819577a144843ee23768122bcbf3e04963e44df640bc9694738e8a12754635698de58cbc33c7f36e58e1185c65e9cddb11454cc0568c339621ab81e66dd2576d203f92854b5f715415df33f9487a791a0961c8649ccda581982b24513f9b41649fcb737c5f420594dae6a296b6d02bfd05826fbce93f8c46fdf828df4886f03a768b1a7b6135e52934c003a0dc863ae4b464ff0fe158d47bf0416dd756bc737f097748fd5ab21eb3498ebfbd9273e891d2258ebd536252472e37e78af690e37789a2f66c9fda6b3755d5137dd05b90de0adb0f426554d8e9972cb58ed22397488c25eca48719457772d4dade2e9422dcaece41db6a3a668882b62c18449af0e9c6d5d382a0c135d3d7da26baeab6845918c14f4f5b9ac36cd0ce62ece8db39027792f9512776ef3d4177c2dc648b45f62ab7ab36b49f1c7cd19b072a4ce8b817d2934fe00f58ad0a260bee9d8060e9893a733b2df23e64f11c0a37401b7fa888225bc1997d789d10d068d2f52f5ddbdd331a437ae8a49dbe2e4a43bd16e5c587054b1f7bd61e2b99f1269e465c3a0b6747f1c2110218d609d61e5738b5d0b86c43adbcd06e3750e2bc8f7d9d7a7f0572179b0d361cd306b9c1f2b6eebe2ab51640fa2621b87447ee7a8680a7a08f90faba41261cc4fa1c91101661872136021c3c193645d60136aae640f106ad5298b5360466e3faccfb235ec9ab16314238dac1b531ebfbb56d0577c44b8958eb6a4f117393904f525c0231913ec33b1bfd608839c029783f4004a02079bcb35e14dbc8963164c8a418ebed5625f5f702f5b701fc1e0515b546fbc4734c99d7fab62849ca0467c4261cd3c00577d35bb2f6e431c2f9fa835c0f608e9aeaf0bb3189d01c96d16258d2ad603752a96e5931dffb29942284f6e30404b8eb25d3105a28903e4fa491dcbc374cb9ca5735b1bfcd2d3e686c260b460776d9b8373c0c1a55a5fd74fbf875dff7a153d7bdee06d0418d3a988b9841a3868eb16916cf3c8225e21ec2b3f9e31e9da88fc24199ff2a21ea60477d7edac138d0f4f0d91eb77f4b4a78db45354fb74ac237977e52f8314340a5f46da279b7907a7365d12ea4bf68279a40640e21f7cb7eb992ffefd38a771185836f01eef9734fc41446674d9a2ff36f83dd0a47dcd6b8b264640af00c227c8f25c02cc7abcc088b956b693f27d2b7b0511db708396ea05a5ec87b977099d54be2923d445b4f921ba08bfbc94271c0ebd6dbd5e464c6041395aee0b3a4bbe883a6095e0b08fa0ea0f3fbf59cea475b6a08ae426ff77ec56f6b31fc17cdccdb6017bab9587228916809f92b4a8734fe6d141fea162ec9a2b5a56d14398c753f277a2c8905919004db8bbddabf089f8941a491110a1690d393ab2529d170977f6fc8b71bde328bd9aacdcf124f461b20d668380bbcd4d246fcc8bff2edb200bb122f72e5df53857d349c49bffe2e0ab7c6c258741fd15a04f11445485f36c2da215885da5957785d69357f76ed8d21732b24d8f9497f6846397ba4dc1df092cd9c7b97479f5523651f88f5f67e6ffa6be13c9105d99833c131e4e9367d5fb58c1fc03d0c9d9124f9a0700324b7f8f2ab6ad885f96f2dd632285e7e4da07b92aebfdc63d9ba3463b59a77cb87d11ad34d96475b84121f1619cb630e75081fdebcb086c3704c39d8b37872e906a75a1f4a9d7a75fd3baa256facb69add6e0cd7328f74b2b64a5832c9f8db40962ab4b06b2f18342d9c394f85a123f499a61643a89cdf0195189c775774269c4a68ea31ca6a8535b464614fa77a4c44d685b1d573fb0718dcf9fa63fcc2b7f2eed23b59a1673aa4a9bdb4ce7a21843fa52fe5159be53d147b2ff9ced997898375988c4e9083f530e545d2740a6ab187fb9fa2a506c45292b9dc6d22920d656c5e4f1a71b7e4611877246756fc935d6d4133b12c4c94912e1729cbf92d95b33bb1edf696e4a2390e85984b20dc9ad7f5431d4a381d8c4d698f194cb017b80c878efc880f3afedbc74998832df157b8826f5299cddf11477f81c9d7a42aee01a3a2857d5ae2f56085947a41c9460f301542dfd425611421d99f94af9073d4573c98f61e0e9758d417f36d14572760051f980f588b9b67844e926758e7da0258acd8bfd864854c54765485bc0fbfa31299e7bd4bea0b89ea593664c222cfe7956a9050eaff4c4babf23946f11341cf0b2cb990f6e09f58bb785dc1b6b4a201a543323565d74a5819efcd4cd8d53bcb58676305135d9b411487c061b967747748c3baf5a6d6fe40b599e8d3a28889b65c8221df55302fa33025c2d5fdf251a87a12fa16cf7a099f8b2ec37c6c2d7aae5426811f12124d6e29a53437ed28cccb1954393401bb7cfc5e7dc9a44f9f0ee2b8d5ae00e533d7d68786eeeaf26a3d3d276d12d13ddc326b62b4bb900d202aafc30096bf63bbc1889bc157d2e9a6a6d661f441ff65c7c78ce9db373a03854b54c92d64a92fa57be6f62b3575109f30436da0092ad96bd3be94b60d5aff1ff730dbabaf7d811c2f563c5d02c2fe8abb46c189d5603be593955ad4a7a2ff2b4f2aad2529e4c11c8f89a0a98ec0435f7177a5ca919ad3f617b88bdf3e5dc1df83987462db459c21b2d64d7bf4964a5b5a1ea9c581856aa8012f5aefd8105eba126faecb5bf7c02130d9eb0ffe103bbae1ece1f7e0e4b9cb439fc506ee2eec8dd547878ddbc0fdcad96bde8dc621d3cdde8ebc7a004f46c828c271b083302d1b4bebca60377fd0d389c487457b90a0016973c9964c9ba2acfe6eddc564651d27a38d1185b3501293e030a6ff5c1faa9e5d01ebc9513376f02190b6e285dc80a4069851d467603a55aee309253af537dc68b60317010705616f48f583871fca95cb6a7d1ee59ad83c6d39f4debac95a39c64cea1082746d2f6a883b5ace6a6f81c9d3f60f4325897fce12f68576654fad8aea1840134af7a4dfb2d88f4b7c44155ec39507c6897945ce61122d156fa0b264be516c10d0ac19ab26d07df8007aea71455a3a13e32932b69bd2372041a91271326920e9c5c9d752130ee8ad511faa295a25ac2be67236995597045d8c5edb6ae39c8fc10b0505098d94f759c9ceea9d47c0b455b7672b2d290bf9c6b7107dbb30a859baff0993a427aca6cfd7fca0ca104c9009c8955da143cd7f9c8aba9e29d4cb5aac09c924ddd3f74be7c051992db7b7520eab6fcbfefd2a233c8f4ee40bbe8db2543ab93482a3efb2db14db9f34753ed9bf67d8c315fb997e3674ef8c94fda9fa4604f8aad6e9a53424529072bc892eb89602b5f2af4eae26d3e4bab60873365c394fd1228e62e01a85567ff64e0765bd47514440fc43468b977e51092c017a03f121866acce981fd29c612c2b29f4ce08b5583dbc0c0bc4c9cd6e872e4029a1b7562f5c66f9368a2ed21429d7103d1d9a93e3ceba1a69b08d522de67996219483520d69c96278f485af4ceb47e7dba80a69cf734bfefd13dc07dbc4335c09a576bc96d0d90464f613077da73bbf27c0d4adb6b8c9597d4f9162575e85016d4e8f9b2da6127528d471dbff7d9612946bca2a39055ff7533d0b71cc74e255841be1baabec4d2a1175df0b89fb14c601597b7717fe51a020a804e189a705960f61b2b9b8814a0417d047eec561a6dab97e7ba31e9b689056f0f7b1bb412b083b9138a8cdf083e63c0869fdf13dacf587b10e80d6fd099420ed1adfafe424e8553c29bddbce92023a5c0a6aea8b9dd47e0a1f0dcddcf1d0ce0752dee7189b90ec16c952944f075c67e31611d48a8a5585b24657aa51701dc52d7efffd589537465377ea20cd08688e7313237fe5e056a5f57523edf410e1b02d34effb2109b44a4ddba942fdb48c45cb712040a2e7ba1cea90d3180ea19b5712f6d08114a109b8cbfc1725e9779f9d8f6c10d4c303a6dd7c18915df2e10b683aad740261e5af00bed3492dcaf5683212e82952beb84bec174516bac65d65554cfc864fb814262191b52bb86fc87253ec553cd2619563bacdcbe1030e739ceb97df970062894cf33585105bd39af3c949f69cafaca7691987d9a4b1ebbcd4e62036f2b0788f4e53035e71e8a64ec6c00d15b4f791b9645d2328e0c0356c10b0e855f9dba78004d9de87acf9efaaf3f7fea8144fa3bc2fc26fc24b6f2c4ec6ee227f1a10256b6d252063da9107306f38a774063db8266732523db4dc9498912522921a46a724dfd26572091feaadb1424adc8ea2c3404bd44fdaf22f54abbc2eab18763e4170ff37a1b8354ab1a5ab60c58dc09384aea4efbfb892c914df22f2f8fe1bb12ba61a49fb5ad189234c2fff750881fd73adb305ebec82aa305cc1297e96978b24e5146b89251df6063f7f69fa987c379bba879667cb8675fd5299c78cc391fd282862711f2714a24b790c2b0fc1b3d1884be1d26927f1e36da6a9afe0b11dd46e7727a089423684b1fbf475ec59c040f3961f63ecf0d6229ca03eb8aec3ca3e1639dc7b0b6563d4f7041c69381d0cb51a4104bd6349127d02259f477bcf118b11c8c2247b39f8c60b7571c472c77b0ac85e19450301b1f51e17b69b37b0c933e58e8fe26cf4f08fcf2f947cf0e85512c2e9158e7bed4935a032af03e010fac17a45b4de55a7c3039c8dc0a62f7cc9189c79913b7f3baed2133a81bbdc28eedc6bd56edb4a3bfad15d741b43db2749af6aae8583a28979234b5ee49f2aedabbc7c67d608e327ca16e10f85c00178875efe3bcf211d2534429215fedc1ef374da265a89a96cac63a0f759a2cef82be601e2860fda89502bd8be8455a449f89f90e362e2f9bd52fed624a7c70ff8a204eaed85bae74dcee30a845fd6bc71a88ab31b4c9a306af0d44fb9fb8cfaacfb6fde89327873c970fb3ec167c309d08ac19762aa8380170979be882fc98e3bb631826c7542dad8970874911215be9e00182e5aa15b6f5c6a6f4b350acad49449e800b3fbf253e306df1821910b6f561648701063e1adf114997936c8a15f8ea47f3668b18bd183ec162a9795e4a285dc8485d914c94e984e4ddf2b88787fccf7d98c605861f607bdff714aa6db01b1eab51c2103d567826b7602598f450affcfb52290db655c009321a32216fc55fb1d0f9d65fd8e0628c401d4f0cfd53942a0751969b8f94831e628d6284bbd7e2dd18f04934363b69bd1505767c42b2708335abdbe6c27cd7a43a519f36e781e79a5cbd4b33edabdb025186a1f2b6c1f2524e35d4d362132c9a49181c9a6ea42883f2c0445e913e5a697b5f7aec5f80360feb86432d10efcc901cbeeb7b6ca3bdcb91e75949ee85bcde8cb016e0e61169892863835700c1b57556f35f1a906412df9247ab03cd1e7e13fe8c54229a7b082d82c279387e371210cf5bae1e5c389d6b9614e8171bc87afc61038a89bee3c03909ecc5e8c91b80b791d102f2428b169575757bfb551a1efdf5bb8bc07b302360c419799ac2d2b7b14a8ee504f10deeb0385b3cc76e21bef15bf9e3f55e37e4694152f30d9397e927fd02e0189bc4a6832f3d8effa2fea9b6eb1779321e1e327b418ddd03df0c03254e8b4e17575862b424e0ebe98494e07dff5f315c695f7b4b288fb59f99115292d41c1704fadd5bee1d8cf4e3d9c4045f32ecf7b9773bca51f274a047055b4187c05178290f1539857c78f4e805198d5e5a7dcabdc169057867b7762d92fd8c1d905723526f4d88f578e147885fb64cbd5c551af8ca86bbae44fa7090b417051bacab40ec9066c368b9ddcec5eb37e7cf2478347d4e145329f287de39c54a725345a8c7717df4c41408e26ffd9a16f8738313ddd73240aa059e92ea628ea759540f755c48e475ed73e4dcfaa1326daa8ab954a1851c9eacce9c0b60809d957609e10381b58c07c9029cf656f1a9a1a3f44211e487b3bb614f81dfc913953b95950cd80467c4f2a746fbd57d772ab0794c658e7ef7865467765263dc643c67b00649bac7b71adfb7c69db53465cc5087d33733285a94f21ec1bc6d63487605e7f05c622499ff2fb38ec1f2e7a8c5f436eb79be3f12e5992b452b25205fa1168d89b97e0204811fcb22b20ccd76e425bc902cc6a226c3f2994fc36dada5e47a9cac7acccdaff08c0b42edfce1f755099dc42ffd855e3a1f2699889814fd383693236c89cc478f93fe2d58c7be351ec3559a2b64634325772524aa5625e25fc873adc99a6eb383b8ac191429325d995e0021f97acfe8972474454c5285d95794c8023524e3fb270ab6fd6b793007f71e035d94747cbdb31f4cf5951e93f5673109e2a3a8297da792b213f6448e90764c72ea145f385c683c6053f7d3a1f4dc3cce7786fba2ba20500d987c277f52a7d1a7d4b3e41e7c3df4641e9f92035e24606d910cfa736154653544b999152cd506e50e8abfb4dafa4ae684e79ae1863ec43d0ad17fc43d7c5f8b28cec42ec3ffd060a2eddbebbfbfb34bec2b410c27bb7f93d99bca00c3f4592c4643b14547ff952c1ffc5f2f93fe79b8e102688f465e1448d3cf29bca277be76241fed4c0fde86221fdb1bbd74ad94443cf700411481e80114bfcc3876b2e141ec6881c62ba5dfb329f253ce0565387b26231d195a025371e5e1cc30d8a77f343e203f9f63c1914a321037a6f4f8325e67701999e7d0de0af035613f3e3c2993698b379403babb4feecb0ffa11d935b6d8209e8c3b48593be2229804c1a87844cc87d9307e6ff0135748fd9156a14e51a2530e4cc9a7dc817483844d515e06686e2d5dd92e3e7fddcce51b13c87025df0697ccd52b93be23516c70407af7b755374b82027a4e687a5b548849f284806ce473eedf57d9d0f7a30ea60a71f46f55f87293fea44151e14e3b22978b16421224c87d2d2be5270e4f7e8f634185326f5efe55747728592613bfd7e5140b951f68aad23dcab5225c65d11e2d062d7e5f46aa6ad84d90068bd844ac571e71be17e6d46a1a428ec05b61ddf7050b61ebbc33291349c34a96a6b1238f4fec13e92ffb8cbc8d7bd18a7a644a90a7be66c0cdadf0a2d91f0be3e8dc8ce9e8363a6d2bd9aa6b664207edf8f75c41c4eb042be576ae183c31c64ef8b140feabf8855305843122656e6c292f1638cab941859c4ccec2e497920bc7f8b1ba21fa75709f296ed07848b993b8e73de9bb3f86721632d926e71b1e6433227c69a4049bf1c13557dfad9d89c33f44898c50b335be0d846f2943b93dc14cf9929a86ad09e45722c4ab28bb77eb6d604bae1e304303c19978b3f70294076c99fe6a5b1139c7a651717347489490024a6d64bd4d32c93adb618aa4e89aafbb78f1e92bc2cfbd09ee62ac8f2f7b1d4d503a33992ecd4b80a6ffd8da615e9b494c931ecc4dc1659ca66d32ec3e2e20ce5dbee37b9db43a014e271486a688c600e859dcdc45fe080a610b076ee16faffd82a6cca6ce29cee1ace867edda1b6cb5db32a8db803d8013c66ccec24abff0030d64bfca90f723350dddbd40b05170a42c3150cdf7e88d721b10efe6fac0749997ff5a6c036c2c1df42087a08a329a8756d8c15f64e77fa58254587372a49c9a236277ea403e1938e93e9e2a4633bb9ab9c4c5e01f310da21c224c151f469c33ec6073e739e91d746dbd6a4285ed98199db3e704e8b3b103016545f2217ae6f51c4b80a58ade51f164381b9c54a30384deb332f3975b033cd7ea7bed1348a54d93ec003516db5f4d67298ca67079030b44c07fc48f9bd1e6cdfeb57b05c1fd3adaa8f908b8472e303dcade72baa21250611e5a6ab5e57cad7c228e484cc4049d48109e03f297e5878833272202b2b46eb926edb8bdf5b37af9f66921def71a29e39d358c59c6e20fea59488e1f181b0ea08fa548b468867e449e2fc1f709126a234039cb9b23c3a5678bc62e73e9262f24b1f59231a3b152ad860baaed1b72e6ddab1df493eeed9743115c183205b3e709cfccb472fc2acaf3a6e1ca7ea06f761a0291ab793d2525a03b905fdecf9792b45eed17c98f0831a17eb48a61bdc70ead3dc5ebf72a1dfb5cb63d92eca506c2954fdd4c9d04bcbece197b44817629e3f8872b46411ad1aef00f9b58f0709b712b2e8133c57d227e00200ca6c3cee492d5b88d9668a28fcc18c469b2055a9aa23188f079f91f6ea28ce91fd3d4972b77b87d30938af704e7c715565a6eaeb4d3711bc907db900aa1a47974e6bab69f04839e3dfb98d2c7a69548f89935cfe4784b74841119e7db5aeba47672733197d7f5744c0296b7020fe835765113dbe5ba46de4367187af8fc1c96c6a755fc19ea3cf2179784dd840c524c5a7798151d8cf0ff156d73d68351f7cdc6fda305b08964908de5b7870119bd2b964cd2402d43e20022d27d555b0ebf322abff0a72592b9351fbc250c2467a8175a1bfb60a200caf1e1b9315af4b45bccace50e568dc0741347a37bd15c252996e55856ac6ae9afd982e33d1e56d362eeb3a5909f3b96e10093a7505cba33502c69f69caaff95822913ac2629e94cb04b3c268f21e5d898c0b59abdcf25dfc8995c3e5992b19bd7db9344e1d8a27e477f48148fcdb9349ed2988c34a5b2ec355dfdcb0eecc9aa93af1faf9648c0c51f0fd16ea8fa749318770f35b518f39709e21b2d82e2d2779bc0d0af1e4b687f1a54f62829486da707fc9e0dda24e627444f4bdba6b0f6af592fd164baf9aaa4e5428865f9abb6926388931983c1496e54e24b5362b8a1f426e018e82f05d84c1386fc109864e10a3bebe079868d6622198372cb6c9bbd8f8bc8ea4b34e3eb1712f7050ad8dc449bf524808039a2b505f90f30717a40ebf83efa0ba056e7946772266d8a1dc2fa8f6910d41a23b5b40d83274f82f3703bd5269c3ae1948a1197929aac821e748da6167a19ec92d0cb6598303f4d2235c3302ff2d3dfd202fe7cb32e8797f5be7ff011627ecce2c8b86755a0dad2de62222e77f249a71a33f9f95664f57bc7f7459420a908e5494a0e69d8f224a6cdf5c4ae1bf67fda192d43a76cf889b30210df0779b27a2442d1bc9b23aa8525c79e54cd5679658c28d48402afee929bebcf71f5a377450b4f44c397e09344063ea193204a844285a3a40dfb7c91d8b5f447752415d0720e43001e55381cac09fcd06fbbbf2c8b2283c7eb667ed8b67d354d1f883b8e7f95ddff8440a8ba9693b8c1d6147fd51d3d9e45fc5417e3562068657981945b520d564b0ff6ecb98ca7576369bf059b108f946d28d5451bb087a0c081d1858393e89262ed4458958044645edca20dbd9fbc62ab5749a7ead5539b01d1abf0127590521ef76572c2d26180fbbe46e28acfdb79f45595657da5ae1d5e67693789f654cf96ef7af605cf9079b7d011d008bdfe1ff9335751adf4a358cba92269c535312d0b35721184070ea19305ce93629bcabe7801fcd145fb3fefc7afacd9543fa81a9bcacdbd89eca8f043e38da28e9b83abfdae6777dd4d9ee22801c9adf07d75dcef6e2ca5f1eeef0ffb52ee158157a7fa16f8afde78d83ee827f1317df78e2515ccccf84402d75b1cf298a9b54cf912af10723b62777a330025c7d544f5fff6bac371382a2e48d76e843e2b2de851ef7e55aef84c9e654ddf3854e068cd5fdd2dfb0abc5bc64cd7172b982a5bd5b17d9fb8243568097aa6f4b7843b295a6d989801081ad635c414fd0cee9465475805e796af83bddf3ac53a3d4c03d6ecb173007f488010e5576644d398fa56d470bad5bfb3f4c07ba27a89481bef458ed1d7da8e3a2ed53a5a07455972704a82d2dcf30ab146991d442a43f877f04e8bc51942f4dfcd4da63698967d1cbb660a5ff6bfdf8a80e476ada49557f6e17e5e315649ad47fe4766339e39d9d0e5798b6a2c67acd08350f59fc72a7dacc32178fc4b0e9fd78d17bb0399760a790463a5b1ffef6cff8e43427eb1e97622e1ca1b6a98a23f8277c3f9d34aa9f07915688d0e6e579ba37bc6461604ea82f0487bb7d19fe0dbf58cb32a82603898e413066403bc14fc01149842c4b7ad12540d0077a3006c97f2f5e2bf850c4c27f1a973d55d793ac0d70bd44f64e11b28c15d48af7729dc30559737d718ec84076b8d6d11fe12244b90d84d12eff712b6705ad25503550f40446cd2ad55fdb7796e052a20a2cc67ef56bf5ff2d247b29b48b6ac67baba37e9d9b562329f281b8a192124dc283fe406239227a703c4f6f7049aa26a733541ca8fbdb62f5d9e3196154d630ef8de17c9f4279c36788f1d95e1206ae495d5054b498b17dfe37a885a9639bdae64fb4a7f4f7abc29b96c520c1ea129d827adac150800b8129284f238d66af787cb09773abb3b929d9f1387f07964149ea0e094fa2aa42710c08ff344209ff0b4181f52aefdf13d565c56228b37133e18a8fc834b098d9458ad3b0706c141e5deda3c2d8083759b0f5b70f16d2c3e214d1d06dcadaf2717ff32b41e668a611a675642546d5b06fe4c077507fff984b402f6730ec33814cbef7544bd73590bc2d0e44eded2808ea2008cda1201ac3187c78f1653320bd046fe2ac2823b100d4d3dd47687912dfb43811742e6022a18c6122d0acccb9adf94c47937207e3af0abe05d8df382e2b80a3599c5bc1dc4dffda77eadfb672b1aa031be09dcbfdf62fc4ac2a7c00b84bf659d90308805c7bdcb0805be89f96b99566e8266ede0693318f41f8ef840742c2be67e0e1a60ec43c7f37a58541bc90dc376848bc530bfcad220faf44714b977f524065210c98a43a0e43c27a985876c4c75a689d6de36a68bd993f97aa49e6152c5a9e232de56f9ea7a63c51adc942a126b3b9d3d12bfeeec69005068e44b0771d77cac64d547b2ea60618a3c9f70aee1e044ee402ef4812b67bd1aa05863bbf09b6127e60b0862b34a54bfcbe5e87c55903343a26843ac7ae68c2a7d75532ac7cd582fd22678fa0e4194bb6f14a3f8db59b0be307fe9f417dfe5ad3ecb48e5d931e7f7717c6a1fb1a1410815ca1fbce4a82c578b171336ae4cfd698d3f4268edb06a00c6431dbf67f877e7d24913033d571b5b1166d2ed2e9e512d255881337ccb026b4fabab80647f0bb57336a59bf6b54fd85cb8e5a67a1230bafa5ff33ab173610fa4fc562ceeab88446400ef9040068f65839f7b1e34c5ede7a82341b8e5b76074aea20b1311ce2987f291f29455514d0544be517748b61ebf713a39d635163aca15b43bde7aa3d26c011ba93b515cba29faaa5fdf9bc5b6aad435c8ddb3fc6e56b97bde321cc78741e6990fc4a4458281c1260858b113f21acec5583a363ad48370f2d9460452c0b518a85526258270da0177dcecf68138e8b7b7b79a285c163fb8e07d77838e0928c24125fe9b675e378b39512b28d59b32f2c3517ad1c9d82011c28c3bc5912c9f15908f1438761b8aa47524914682d1c11016ecf1a3e517eb68ebbe503f1833f10d41475e179afb284732c82fe23ed4181b6ff99366f9a336fc1cd5cfb3cff135c140c8e7bd3e1cd9a9dfc23be2e8ffc62b5aa8b8ac81aad77d5b9c790c80237aef4f187f1a956ebc69adce9bb6b4bad6e1315f0d8a6378dac28c203100aab0d9e978c8ca842cb8a580a247a1c6bae82ba868b9d703ca15f8e135f062cbc06a178c294c5bcf8e5d36077cbbd8bff9993acd658a80705afeb19643b2ec8215c24bef652acffd3aac84e0f73e2ee9eeb904c85f5f56febf331fb48e4810aebb413f6a2f249094642b9e788553243488415f982f5044d4cfa7fb46a0e2bdcfaaff907dbf7bbfbdd7b0462678684f2a6daa8e7f243c48d59ec4e0cc5bddbe33ddf8dd9781ad0aa0d725e3fb420b29d64871d1c4da292387444323b413e393a3aa14036f0ee85cb56b3776fde26b8edf76c639b2236d63d027eb8719386d5456aa2c0f0b9772d0c7833670bc8a8f9e3033bfe5050602da76b61aa7c8ce51afded8ff66c888cc42934265a166ccae6dac9dbce6e87e289f80f42049509ed7debf037ad9181ede006d2213d3a260d0a7f45b5fc221c566a9e15df021d9c921c5e4152845f78a2b5ea526ddbb0521a0de5bdbfad328fa6714f997bbeac838ac9bbe8703f4565fd89a9798e3d9c7a4e0beb469d8208af94a19b23bb2e2d63cf3b89682215af09f90029234c906825c61ce2cf68a4fdd746efc17fa9a3167ea0e07dc9a447fd14c592719236f0ecb017d1bf399467938ace5a25b9632e32b81a37af65d15477bd8473893f405674d217f2581540f2963447b1c66659e57dad2234337df439b95203692f1b6348f2b02d146d8c2e9b81845e3e1315722f656a97054ed7b6b58e09657467f66be05acad168e311ccffe32bfc8e2c5e019ff70750a1add52e4a22ee3807d9a762025f4c18dd6a75110f732e479854d46aeef66f7d70ed509c16293d1b348e32ce98a12eab8847c0b69ce48005042e8e513664434dfe067c90de42f5f49c4e56cd4aff15e135e4eef6ca5602179623c4c56e0873ff2b6c523d2a46a49a99e223cec3ddaa6567f9955e5dd93cfe3feee277372438d4f8a9458ed686834f567e8881389312585cbd914c6119f15daa66a2aaa810fd58bda86769ae619b7c1a4dc467a233237b93eb30c2265215975fe39a7390eedca74e7d2216d46d2593388b51bbc3d336753822f5ad0a95821087865177e31e7118083847cd8640e7dae70c6ed67ee3fb419f57b3005063a66ccae0421211f08d1b4e482153c22a56e02282011fb64f1f6bbc09885151747eeb205dc1142c1020079358d926458d94488a4a5e6b1ce14edc8766a624b44b63a03aade0d9302937bbb1c58bb78a6ae955a762dbacf9f4337b993d50fe813863ed15d973f71c0d6031fb0be73dd9646405e1e952d19510db61d73b7cf89b2d0100369b29a97b361f7fa6f9d8a399eb76322db47ce23bbda5064c10ba0fa48a474fc909ce543be8cf528ba038029480b1d66c8745b457a0eed21240eb5d9ebd8e388a263c5061e7ade4f57acab2ac0ced81ed15b0f5896dbab3036cbe7af721b25c2943c50a54a1bf18d8efffcd313c68a4a55297c03766d7e0d2196134f3dc3a2624172ba18cb4ee0543d95f4e1957e739c3912397296d8df513822ae120fb3241ec42dd36e3cc94de14ae48e5c6adf20c7c856f2cb381cedb8ce6b9b34c9c0f89843baa6eb8fa17129133ce93c5c9e45c2baafab7264bfea90f4cf3f0f26404abe50fc6224909ef80a9da4e71322a4961426d949b1b24cfa64a97667851b5eb688b06094dcfdf84021e655d78752581a390a37b11f1f98034aaf81bd2f895e7b11ebfb1b5e91af0d121314d3c3636fb2b5b15ea5ef5ca904fa9b205271b05b044109ab175c84df0baa0cde7bceeee4a1b46e7f4e912ba695812ee44de05ff3df82b98d06c657a468ad3e25c1dbf0a8ad42921014cea1b27d6e4ca785889f5b55f4f31b78ad639559f9ef940c972b31f91a149b179041538e2522580df5231072ddaff2d780e513002c13e1ead26a7d0d1f7eaa80dd1c7881b62c7e28382b7fd5d683a80fa08b6ced7a33aea5be0a387e31b119a13e09745619f46bf46fab0e4511db7398483d606052813de0db52a9b5262e5ed5818ef51171e7877222f72828964384f660d59bfbb0767a6ebae4f996cce41901e65d7f8a5f216534a835db178ad57b5f30db0c708e705c89efe4498c9872f2ab4f238e17202ed2059380c89589e8cc0ebe7fd85f9217b842ef01cb1ec684d9ce97d943e2986746a406c83384a2105eadbbb867b111be3e30f5eb632e51064bfa02c73165488970a26ee5ed824a66875ca25d82e049d2e6ab8c10ead94a7be8bd964d96a33d336a3e58d0fdff867718dbdd54fed7afd2577e55c7179f6fffa5cff6628dde49a1add79add035f63177cbe6af96645f5998970fc95f24a834fc7d2d58dc55e3f82f34edb5051addeeb8be5f13cf5a388fd074e60b05ce8f4016571dba1acb6d52138f6435b88d762acd1691993cc22e98b35abdf8fe7e5a38befeb9cf9e7208d183c698c68f7c85009e2fe8776534d2d00cb89950cc3a004938b29bb5bace02b697a27bf05ee139c4616ec97f8ffc5dcd031956991953f88f04e4fd33ee5c2220e357858c7c49e4f00ab6658e132b707ef9f316fe864d944461942b4b57624cb3460a0a15a74f2058d5073774c5e227fa4b543d7524fb6bfa3f9c9aed1ed1e4b9e40c6edead6b6c97121961533a23beb40ef26cbd24a34d70a1dc8a5ff7c5646357f1528c2f3ba29ae353084e11a4307c04bdd4ebe7c8dfb80f6b1ca6c7aa8538e21b4c32caa4d5f076478320da0749c68665bebd93d27cab9a31b8ec48eb9047eb82a1a7e8f03774d34f93923c797f497a93d29a08e1c8dffeaf9907281c5347f7018bec835c657c0270e54b8475179cb399a98e9183cb0cacda756a7ce73fb48bad7cae13bf506303d52b8590153a9a9b893645afd8d4ff62643b790d96fb378dc80e47be4576d8dd607db0ed99d7d5cd3a45ab9f79e3124166de716deaedd5ff352b951b23c8942f837c7fb120230d5826c3a9a55b50c3e8123dcfc0caac32ea5de46803fca470628cd7cfb88066bdbe8b30142c516d00e59c7d1ad7d756d8c08187748166525f28b241933dca6db537cc763f31b73c1fb3a05654af6296321a68b7c00a77e460bf89d5dd806fc50229becf7f83a7e54f495f25d91b10dfcdb55009708e1eab60bb65762d81f9224f1ce31350d3254aaa28837339a1ca12674d23a495e3a44ea458440c6e6573248e61afe731f8e15ce70c0a8b541db4beaa09af5c7a0e55b0269eabd91d5644d18ef9266123acff3d44f5eac515ac8524066d3b5ee40f07149ab4411bc5290c58363219d547557f25b3533b05d03c9d90aefa716bfe270fbd1e21f9f9e2e164271cd40250a7884a9be15d8a655b9c12869916da2195d950a7bb347055c83e2be0977ebd0ee69a4cb1bc5458d90f4dc27876597c6616d8e2e15e9acbf96a25194d10f3f4b416cf2e84ad8af22d76a48d380b7f5e898f893cb3f1fc6473d096ee46e86989691b20259c4a556ab9b1d50d67cdb74856f03dde57cafa879c3040a3152aa42c179022e044165cf6f7a6dbd852b03ea3267d0f7bb48f59dd45fbfcbcf8a5c7066624f409edf33aa8e15d122f012e9856ddb00e4359c5a8862b7ab3e4e0e3430525341b49764333555146421f25c145a11be7f90284bb46310570de4792b437a63650a3935f6e4bcf9f757783b66bea79bf74e4bd3551229ff762240ca8fddd87da1ed3f78b148119b5a434fc87dcb32ae9b2f0f333e8989dd0df26a19d423c6dcc4d468cf689647cdba802d2541e93074d9097f8a7d039ce4cba069c07917587174e6f7163e393c73c2bb3082d86182f</script>\n  <div class=\"hbe hbe-content\">\n    <div class=\"hbe hbe-input hbe-input-default\">\n      <input class=\"hbe hbe-input-field hbe-input-field-default\" type=\"password\" id=\"hbePass\">\n      <label class=\"hbe hbe-input-label hbe-input-label-default\" for=\"hbePass\">\n        <span class=\"hbe hbe-input-label-content hbe-input-label-content-default\">Hey, password is required here.</span>\n      </label>\n    </div>\n  </div>\n</div>\n<script data-pjax src=\"/lib/hbe.js\"></script><link href=\"/css/hbe.style.css\" rel=\"stylesheet\" type=\"text/css\">",
            "tags": []
        },
        {
            "id": "http://yjfyqfzs.github.io/2022/12/09/Ue%E8%93%9D%E5%9B%BE%E4%BF%AE%E6%94%B9Sequence/",
            "url": "http://yjfyqfzs.github.io/2022/12/09/Ue%E8%93%9D%E5%9B%BE%E4%BF%AE%E6%94%B9Sequence/",
            "title": "Ue蓝图修改Sequence",
            "date_published": "2022-12-09T08:52:54.000Z",
            "content_html": "<p>在实际应用中有时需要批量修改 UE Sequence 关键帧的参数，该操作直接作用于 Content 中的 sequence 资源，不能作为仅在关卡播放时运行的事件。UE 提供了 Editor Utility Blueprint 来实现只需要在编辑器中运行的事件，具体使用步骤如下：</p>\n<p><strong>1. 开启相关插件</strong></p>\n<div align=\"center\"> <img data-src=\"/2022/12/09/Ue%E8%93%9D%E5%9B%BE%E4%BF%AE%E6%94%B9Sequence/img1.png\"> </div>\n<p><strong>2. 新建 Editor Utility Blueprint</strong></p>\n<div align=\"center\"> <img data-src=\"/2022/12/09/Ue%E8%93%9D%E5%9B%BE%E4%BF%AE%E6%94%B9Sequence/img2.png\" width=\"400\"> </div>\n<p>选择 Asset Action Utility</p>\n<div align=\"center\"> <img data-src=\"/2022/12/09/Ue%E8%93%9D%E5%9B%BE%E4%BF%AE%E6%94%B9Sequence/img3.png\" width=\"400\"> </div>\n<p><strong>3. 添加事件</strong><br>\n打开新建的 Editor Utility Blueprint，新建随机事件，需要勾选 Call in Editor 才能在编辑器中被调用。</p>\n<div align=\"center\"> <img data-src=\"/2022/12/09/Ue%E8%93%9D%E5%9B%BE%E4%BF%AE%E6%94%B9Sequence/img4.png\" width=\"800\"> </div>\n<p>Sequence 中的关键帧数值读取层级：<strong>Binding-&gt;Track-&gt;Section-&gt;Channel-&gt;Key-&gt;Value</strong><br>\n 其中，Binding 表示 Sequence 中对象绑定 ID 的结构体，每个对象的 ID 唯一；Track 为绑定对象的轨道（如 Animation，Transform 等，用 Get Display name 可获取具体名称）；Section 表示轨道中的片段；Channel 为各参数通道，如 Location,Rotation 等。下图事件为将 Sequence 中所有 Transform 轨道的关键帧位置 X 加 10。</p>\n<div align=\"center\"> <img data-src=\"/2022/12/09/Ue%E8%93%9D%E5%9B%BE%E4%BF%AE%E6%94%B9Sequence/img5.png\"> </div>\n<p><strong>4. 运行事件</strong><br>\n选中资源管理器中需要修改的 Sequence，右键如下图运行相应事件即可。</p>\n<div align=\"center\"> <img data-src=\"/2022/12/09/Ue%E8%93%9D%E5%9B%BE%E4%BF%AE%E6%94%B9Sequence/img6.png\"> </div>\n<p><strong>参考资料</strong><br>\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9kb2NzLnVucmVhbGVuZ2luZS5jb20vNC4yNy9lbi1VUy9Qcm9kdWN0aW9uUGlwZWxpbmVzL1NjcmlwdGluZ0FuZEF1dG9tYXRpb24vQmx1ZXByaW50cy9TY3JpcHRlZEFjdGlvbnMv\"> Editor Utility Blueprint UE 官方教程</span><br>\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibHVlcHJpbnR1ZS5jb20vdHlwZS9ibHVlcHJpbnQv\"> UE 蓝图查询网站</span><br>\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzI4NDcwNTI1L2FydGljbGUvZGV0YWlscy8xMDU5Njc2MjE=\"> UE C++ 获取 Sequence 对象</span><br>\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vcC8xNTc4OTI2MDU=\"> UE LevelSequence 源码解析</span></p>\n",
            "tags": []
        },
        {
            "id": "http://yjfyqfzs.github.io/2022/12/02/DNAimg/",
            "url": "http://yjfyqfzs.github.io/2022/12/02/DNAimg/",
            "title": "MetahumanDNA校准库",
            "date_published": "2022-12-02T02:43:03.000Z",
            "content_html": "<h2 id=\"dna文件描述\"><a class=\"anchor\" href=\"#dna文件描述\">#</a> DNA 文件描述</h2>\n<div align=\"center\"> <img data-src=\"/2022/12/02/DNAimg/img1.png\"> </div>\n<center>图1</center>\n<p>具体描述可参考<span class=\"exturl\" data-url=\"aHR0cHM6Ly9jZG4yLnVucmVhbGVuZ2luZS5jb20vcmlnLWxvZ2ljLXdoaXRlcGFwZXItdjItemhjbi01ODYwZDgwZjgzNTcucGRm\"> RigLogic 白皮书</span></p>\n<p><strong>metahuman 面部驱动逻辑：</strong> 控制器 GUI 数值 -&gt;RigLogic（存储在 DNA 文件中）-&gt; 关节等数据<br>\n Maya 中，采用以下方式查看 DNA 文件路径:</p>\n<div align=\"center\"> <img data-src=\"/2022/12/02/DNAimg/img2.png\"> </div>\n<center>图2</center>\n<div align=\"center\"> <img data-src=\"/2022/12/02/DNAimg/img3.png\"> </div>\n<center>图3</center>\n<div align=\"center\"> <img data-src=\"/2022/12/02/DNAimg/img4.png\"> </div>\n<center>图4</center>\n<p>Unreal 中，DNAAsset 参数在 Skeletal Mesh 中查找</p>\n<div align=\"center\"> <img data-src=\"/2022/12/02/DNAimg/img5.png\"> </div>\n<center>图5</center>\n<p>Epic Games 官方提供的 python 示例在 <code>...\\MetaHuman-DNA-Calibration-main\\examples</code>  中，全部 api 可在 <code>...\\MetaHuman-DNA-Calibration-main\\dnacalib\\DNACalib\\include</code>  的 <code>C++</code>  头文件中查找，python api 名称与 <code>C++</code>  api 名称相同。</p>\n<h2 id=\"dnaviewer\"><a class=\"anchor\" href=\"#dnaviewer\">#</a> DNAViewer</h2>\n<p>DNAViewer 模块用于在 Maya 中从 DNA 文件创建几何体与绑定，只适用于 python3.7，因此只能在 Maya2022 或更高版本中使用。</p>\n<p><strong>在 Maya 中获取 DNA 文件数据并显示</strong><br>\n在 Maya Script editor 里运行 <code>...\\MetaHuman-DNA-Calibration-main\\examples\\dna_viewer_run_in_maya.py</code> （其中，ROOT_DIR 要修改为绝对路径），显示图 6 所示界面：</p>\n<div align=\"center\"> <img data-src=\"/2022/12/02/DNAimg/img6.png\"> </div>\n<center>图6</center>\n<p>图 6 中，Path 选择 DNA 路径，点击 Load DNA，Meshes 中会出现相应组件，选择 Build options 中的选项，点击 Process，即可将关节等数据导入 Maya 场景。若要导入控制器驱动逻辑 (rig logic)，还需设置 gui path 等，相关文件在 <code>...\\MetaHuman-DNA-Calibration-main\\data\\</code>  中，如图 7 所示，其中，gui.ma 和 analog_gui.ma 中为控制器的 UI 界面。</p>\n<div align=\"center\"> <img data-src=\"/2022/12/02/DNAimg/img7.png\"> </div>\n<center>图7</center>\n<p><strong>将 Maya 场景中的数据保存至 DNA 文件中</strong><br>\n修改了有 DNA 文件的 Maya 场景后，将原始 DNA 文件放置路径 <code>...\\MetaHuman-DNA-Calibration-main\\data\\</code>  中。修改 <code>...\\MetaHuman-DNA-Calibration-main\\examples\\dna_viewer_grab_changes_from_scene_and_propagate_to_dna.py</code>  中的 ROOT_DIR 为 <code>...\\MetaHuman-DNA-Calibration-main\\</code> ，CHARACTER_NAME 为源 DNA 文件名，在 Maya Script editor 里运行该 py 脚本，即可生成新的 DNA 文件。</p>\n<h2 id=\"dnacalib\"><a class=\"anchor\" href=\"#dnacalib\">#</a> DNACalib</h2>\n<p>DNACalib 模块用于查看和修改 DNA 文件数据，包含 <code>C++</code>  api 和转换的 python api，既能使用 Maya 中的 Script Editor，也能在外部 python 编辑器中运行。该模块只适用于 python3.7，若要使用其他 python3 版本，需要用 SWIG 重新封装 <code>C++</code>  库。</p>\n<p>使用 DNACalib 时，必须导入以下模块</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> dna <span class=\"keyword\">import</span> DataLayer_All, FileStream, Status, BinaryStreamReader, BinaryStreamWriter<span class=\"comment\">#主要用于读写</span></span><br><span class=\"line\"><span class=\"keyword\">from</span> dnacalib <span class=\"keyword\">import</span> (</span><br><span class=\"line\">    DNACalibDNAReader</span><br><span class=\"line\">)<span class=\"comment\">#括号中按需添加模块如RenameJointCommand等</span></span><br></pre></td></tr></table></figure>\n<p><strong>读取和写入 DNA 文件</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#读DNA文件</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">load_dna</span>(<span class=\"params\">path</span>):</span><br><span class=\"line\">    stream = FileStream(path, FileStream.AccessMode_Read, FileStream.OpenMode_Binary)</span><br><span class=\"line\">    reader = BinaryStreamReader(stream, DataLayer_All)</span><br><span class=\"line\">    reader.read()</span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> Status.isOk():</span><br><span class=\"line\">        status = Status.get()</span><br><span class=\"line\">        <span class=\"keyword\">raise</span> RuntimeError(<span class=\"string\">f&quot;Error loading DNA: <span class=\"subst\">&#123;status.message&#125;</span>&quot;</span>)</span><br><span class=\"line\">    <span class=\"keyword\">return</span> reader</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#写DNA文件</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">save_dna</span>(<span class=\"params\">reader, path</span>):</span><br><span class=\"line\">    stream = FileStream(path, FileStream.AccessMode_Write, FileStream.OpenMode_Binary)</span><br><span class=\"line\">    writer = BinaryStreamWriter(stream)</span><br><span class=\"line\">    writer.setFrom(reader)</span><br><span class=\"line\">    writer.write()</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> <span class=\"keyword\">not</span> Status.isOk():</span><br><span class=\"line\">        status = Status.get()</span><br><span class=\"line\">        <span class=\"keyword\">raise</span> RuntimeError(<span class=\"string\">f&quot;Error saving DNA: <span class=\"subst\">&#123;status.message&#125;</span>&quot;</span>)  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#读文件示例</span></span><br><span class=\"line\">dna = load_dna(input_path)</span><br><span class=\"line\">calibrated = DNACalibDNAReader(dna)<span class=\"comment\">#calibrated作为后续命令模块的输入参数</span></span><br></pre></td></tr></table></figure>\n<p><strong>获取 DNA 文件中的组件</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">#获取全部关节名称</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_joints</span>(<span class=\"params\">dna</span>):</span><br><span class=\"line\">    joints = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> jointIndex <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(dna.getJointCount()):</span><br><span class=\"line\">        joints.append(dna.getJointName(jointIndex))</span><br><span class=\"line\">    <span class=\"keyword\">return</span> joints</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#获取全部网格体名称</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_mesh</span>(<span class=\"params\">dna</span>):</span><br><span class=\"line\">    mesh = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> meshIndex <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(dna.getMeshCount()):</span><br><span class=\"line\">        mesh.append(dna.getMeshName(meshIndex))</span><br><span class=\"line\">    <span class=\"keyword\">return</span> mesh</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#获取全部动画贴图名称</span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">get_animap</span>(<span class=\"params\">dna</span>):</span><br><span class=\"line\">    animap = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> ani_index <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(dna.getAnimatedMapCount()):</span><br><span class=\"line\">        animap.append(dna.getAnimatedMapName(ani_index))</span><br><span class=\"line\">    <span class=\"keyword\">return</span> animap</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#涉及获取Metahuman的静态数据(如关节，网格体的名称，数量，层级关系等)的api，可在DefinitionReader.h中查找</span></span><br><span class=\"line\">all_joint=get_joints(calibrated)<span class=\"comment\">#Metahuman头部有865根骨骼</span></span><br><span class=\"line\">father_joint=calibrated.getJointParentIndex(joint_index)<span class=\"comment\">#获取父节点索引</span></span><br><span class=\"line\">joint_position=calibrated.getNeutralJointTranslation(joint_index)<span class=\"comment\">#获取关节相对父关节偏移,保存在列表中，单位为cm</span></span><br><span class=\"line\">joint_rotation=calibrated.getNeutralJointRotation(joint_index)<span class=\"comment\">#获取关节相对父节点旋转,单位为°</span></span><br><span class=\"line\">all_joint_x=calibrated.getNeutralJointTranslationXs()<span class=\"comment\">#获取所有关节的偏移x值</span></span><br><span class=\"line\">all_mesh=get_mesh(calibrated)<span class=\"comment\">#LOD0~LOD7，LOD0包括head,teeth,saliva,eyeLeft,eyeRight,eyeshell,eyelashes,eyeEdge,cartilage</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#涉及控制器绑定相关动态数据的api，可在BehaviorReader.h中查找</span></span><br><span class=\"line\">bs_channel_lods = calibrated.getBlendShapeChannelLODs()<span class=\"comment\">#每个LOD通道的Blendshape数量，只有LOD0有Blendshape，共687个</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#涉及获取几何信息的api，可在GeometryReader.h中查找</span></span><br><span class=\"line\">bs_tgt_count = calibrated.getBlendShapeTargetCount(mesh_index)<span class=\"comment\">#Mesh的Blendshape数量，其中head_lod0_mesh有681个Blendshape</span></span><br><span class=\"line\">bs_tgt_delta_count = calibrated.getBlendShapeTargetDeltaCount(mesh_index,bs_tgt_index)<span class=\"comment\">#Blendshape中变形了的顶点数量？？？但没有找到获取这些受影响顶点索引的api</span></span><br><span class=\"line\">v_position=calibrated.getVertexPosition(mesh_index,vertex_index)<span class=\"comment\">#获取顶点世界位置</span></span><br><span class=\"line\">v_j=calibrated.getSkinWeightsJointIndices(mesh_index,vertex_index)<span class=\"comment\">#影响顶点位置的关节索引</span></span><br><span class=\"line\">v_w=calibrated.getSkinWeightsValues(mesh_index,vertex_index)<span class=\"comment\">#获取权重值</span></span><br></pre></td></tr></table></figure>\n<p><strong>删除 DNA 文件中的组件</strong><br>\n该部分包括删除关节动画，关节 (Joint)，网格体 (Mesh)，混合变形 (Blend shape)，程序中需要导入相应的命令模块</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> dnacalib <span class=\"keyword\">import</span> (    </span><br><span class=\"line\">    DNACalibDNAReader,</span><br><span class=\"line\">    RemoveJointAnimationCommand,</span><br><span class=\"line\">    RemoveJointCommand,</span><br><span class=\"line\">    RemoveMeshCommand,</span><br><span class=\"line\">    ClearBlendShapesCommand</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#删除关节</span></span><br><span class=\"line\">command = RemoveJointCommand(joint_index)</span><br><span class=\"line\">command.run(calibrated)<span class=\"comment\">#注意删除关节后相关顶点权重不会自动删除，需要手动修改</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#清空Blendshape</span></span><br><span class=\"line\">command = ClearBlendShapesCommand(joint_index)</span><br><span class=\"line\">command.run(calibrated)</span><br></pre></td></tr></table></figure>\n<p><strong>重命名 DNA 文件中的组件</strong><br>\n该部分包括重命名动画贴图，关节，网格体，混合变形</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> dnacalib <span class=\"keyword\">import</span> (    </span><br><span class=\"line\">    DNACalibDNAReader,</span><br><span class=\"line\">    RenameAnimatedMapCommand,</span><br><span class=\"line\">    RenameBlendShapeCommand,</span><br><span class=\"line\">    RenameJointCommand,</span><br><span class=\"line\">    RenameMeshCommand</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#关节重命名</span></span><br><span class=\"line\">command = RenameJointCommand(<span class=\"number\">10</span>, <span class=\"string\">&quot;NewJointA&quot;</span>)<span class=\"comment\">#将索引为10的关节重命名为&quot;NewJointA&quot;</span></span><br><span class=\"line\">command.run(calibrated)</span><br></pre></td></tr></table></figure>\n<p><strong>设置静态的关节和顶点</strong><br>\n该部分设置静态的关节位姿和顶点位置</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> dnacalib <span class=\"keyword\">import</span> (    </span><br><span class=\"line\">    DNACalibDNAReader,</span><br><span class=\"line\">    SetNeutralJointRotationsCommand,</span><br><span class=\"line\">    SetNeutralJointTranslationsCommand,</span><br><span class=\"line\">    SetVertexPositionsCommand,</span><br><span class=\"line\">    VectorOperation_Subtract<span class=\"comment\">#向量差，除了Subtract外还有Add,Multiply,Interpolate方法</span></span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#设置关节位置,只能整体设置数值，使用前需要先设置关节层级，设置关节层级相关api在DefinitionWriter.h中</span></span><br><span class=\"line\">command=SetNeutralJointTranslationsCommand([[x1,y1,z1],...,[xn,yn,zn]])</span><br><span class=\"line\">command.run(calibrated)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#设置顶点位置，只能整体设置，在原始数据的基础上增加或减小，若要直接设置位置值需要使用DefinitionWriter.h中的api</span></span><br><span class=\"line\"><span class=\"comment\">#new_x=origin_x+pos_x,new_y=origin_y+pos_y,new_z=origin_z+pos_z</span></span><br><span class=\"line\">command = SetVertexPositionsCommand(mesh_index,pos_x=[x1,...,xn],pos_y=[y1,...,yn],pos_z=[y1,...,yn],VectorOperation_Subtract)</span><br><span class=\"line\">command.run(calibrated)</span><br></pre></td></tr></table></figure>\n<p><strong>变换静态的关节和顶点</strong><br>\n该部分对所有关节和顶点进行整体变换</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> dnacalib <span class=\"keyword\">import</span> (    </span><br><span class=\"line\">    DNACalibDNAReader,</span><br><span class=\"line\">    RotateCommand,</span><br><span class=\"line\">    ScaleCommand,</span><br><span class=\"line\">    TranslateCommand</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#整体相对origin旋转ro</span></span><br><span class=\"line\">command = RotateCommand(ro=[<span class=\"number\">10</span>,<span class=\"number\">20</span>,<span class=\"number\">30</span>],origin=[<span class=\"number\">0</span>,<span class=\"number\">90</span>,<span class=\"number\">0</span>])</span><br><span class=\"line\">command.run(calibrated)</span><br></pre></td></tr></table></figure>\n<p><strong>修正混合变形</strong><br>\n该部分修改混合变形中的增量值</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">from</span> dnacalib <span class=\"keyword\">import</span> (    </span><br><span class=\"line\">    DNACalibDNAReader,</span><br><span class=\"line\">    SetBlendShapeTargetDeltasCommand,</span><br><span class=\"line\">    PruneBlendShapeTargetsCommand,</span><br><span class=\"line\">    VectorOperation_Interpolate</span><br><span class=\"line\">)</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#blend_shape_target_deltas=[[x1,y1,z1],[x2,y2,z2],...,[xn,yn,zn]]表示目标增量</span></span><br><span class=\"line\"><span class=\"comment\">#mask=[w1,w2,...,wn]表示叠加增量的权重,w=0表示保持顶点原始位置</span></span><br><span class=\"line\"><span class=\"comment\">#但函数中没有输入顶点索引,如何设置修改哪些顶点???</span></span><br><span class=\"line\">command =  SetBlendShapeTargetDeltasCommand(</span><br><span class=\"line\">        mesh_index</span><br><span class=\"line\">        blend_shape_target_index</span><br><span class=\"line\">        blend_shape_target_deltas,</span><br><span class=\"line\">        masks,</span><br><span class=\"line\">        VectorOperation_Interpolate,</span><br><span class=\"line\">    )</span><br><span class=\"line\">command.run(calibrated)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">#设置混合变形增量的阈值,当增量绝对值超过阈值时设置为阈值</span></span><br><span class=\"line\">command=PruneBlendShapeTargetsCommand(threshold)</span><br><span class=\"line\">command.run(calibrated)</span><br></pre></td></tr></table></figure>\n<p><strong>所有的命令可以放在一个命令序列中，最终执行一次</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">commands = CommandSequence()</span><br><span class=\"line\">com1=SetLODsCommand(lods)</span><br><span class=\"line\">commands.add(com1)</span><br><span class=\"line\">com2=CalculateMeshLowerLODsCommand(mesh_index)</span><br><span class=\"line\">commands.add(com2)</span><br><span class=\"line\">commands.run(calibrated)</span><br></pre></td></tr></table></figure>\n<p>修改后的 DNA 文件不能通过图 4 的方法来更新 Maya 场景，需要使用图 7 所示 DNAViewer 来新建场景。<br>\n<strong>（未验证，不一定对）</strong> 若要将修改后的 DNA 文件导入 UE，首先需要按图 7 方法新建 Maya 场景，并将骨骼和网格体导出至 UE, 修改后的 DNA 文件拖入 UE，选择对应骨骼。</p>\n<div align=\"center\"> <img data-src=\"/2022/12/02/DNAimg/img8.png\"> </div>\n<center>图8</center>\n<p>打开 Skeletal mesh，Animation Rig 沿用 Metahuman 通用资源即可。</p>\n<div align=\"center\"> <img data-src=\"/2022/12/02/DNAimg/img9.png\"> </div>\n<center>图9</center>\n",
            "tags": []
        }
    ]
}